<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for lib/active_support/cache/mem_cache_store.rb</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">All files</a> / <a href="index.html">lib/active_support/cache</a> mem_cache_store.rb
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">34.92% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>44/126</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.16% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>5/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">11.11% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">44.21% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>42/95</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-yes">30x</span>
<span class="cline-any cline-yes">6x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"># frozen_string_literal: true
&nbsp;
begin
  require "dalli"
rescue <span class="cstat-no" title="statement not covered" >LoadError</span> =&gt; <span class="cstat-no" title="statement not covered" >e</span>
<span class="cstat-no" title="statement not covered" >  $stderr.puts "You don't have dalli installed in your application. Please add it to your Gemfile and run bundle install"</span>
<span class="cstat-no" title="statement not covered" >  raise <span class="cstat-no" title="statement not covered" >e</span></span>
end
&nbsp;
require "digest/md5"
require "active_support/core_ext/marshal"
require "active_support/core_ext/array/extract_options"
&nbsp;
module ActiveSupport
  module Cache
    # A cache store implementation which stores data in Memcached:
    # https://memcached.org
    #
    # This is currently the most popular cache store for production websites.
    #
    # Special features:
    # - Clustering and load balancing. One can specify multiple memcached servers,
    #   and MemCacheStore will load balance between all available servers. If a
    #   server goes down, then MemCacheStore will ignore it until it comes back up.
    #
    # MemCacheStore implements the Strategy::LocalCache strategy which implements
    # an in-memory cache inside of a block.
    class MemCacheStore &lt; Store
      # Provide support for raw values in the local cache strategy.
      module LocalCacheWithRaw # :nodoc:
        private
<span class="fstat-no" title="function not covered" >          def read_entry(key, options)</span>
<span class="cstat-no" title="statement not covered" >            entry = super</span>
<span class="cstat-no" title="statement not covered" >            if options[:raw] &amp;&amp; local_cache &amp;&amp; entry</span>
<span class="cstat-no" title="statement not covered" >              entry = deserialize_entry(entry.value)</span>
            end
<span class="cstat-no" title="statement not covered" >            entry</span>
          end
&nbsp;
<span class="fstat-no" title="function not covered" >          def write_entry(key, entry, options)</span>
<span class="cstat-no" title="statement not covered" >            if options[:raw] &amp;&amp; local_cache</span>
<span class="cstat-no" title="statement not covered" >              raw_entry = Entry.new(entry.value.to_s)</span>
<span class="cstat-no" title="statement not covered" >              raw_entry.expires_at = entry.expires_at</span>
<span class="cstat-no" title="statement not covered" >              super(key, raw_entry, options)</span>
            else
<span class="cstat-no" title="statement not covered" >              super</span>
            end
          end
      end
&nbsp;
      prepend Strategy::LocalCache
      prepend LocalCacheWithRaw
&nbsp;
      ESCAPE_KEY_CHARS = /[\x00-\x20%\x7F-\xFF]/n
&nbsp;
      # Creates a new Dalli::Client instance with specified addresses and options.
      # By default address is equal localhost:11211.
      #
      #   ActiveSupport::Cache::MemCacheStore.build_mem_cache
      #     # =&gt; #&lt;Dalli::Client:0x007f98a47d2028 @servers=["localhost:11211"], @options={}, @ring=nil&gt;
      #   ActiveSupport::Cache::MemCacheStore.build_mem_cache('localhost:10290')
      #     # =&gt; #&lt;Dalli::Client:0x007f98a47b3a60 @servers=["localhost:10290"], @options={}, @ring=nil&gt;
      def self.build_mem_cache(*addresses) # :nodoc:
        addresses = addresses.flatten
        options = addresses.extract_options!
<span class="cstat-no" title="statement not covered" >        <span class="missing-if-branch" title="if path not taken" >I</span>addresses = ["localhost:11211"]</span> if addresses.empty?
        Dalli::Client.new(addresses, options)
      end
&nbsp;
      # Creates a new MemCacheStore object, with the given memcached server
      # addresses. Each address is either a host name, or a host-with-port string
      # in the form of "host_name:port". For example:
      #
      #   ActiveSupport::Cache::MemCacheStore.new("localhost", "server-downstairs.localnetwork:8229")
      #
      # If no addresses are specified, then MemCacheStore will connect to
      # localhost port 11211 (the default memcached port).
      def initialize(*addresses)
        addresses = addresses.flatten
        options = addresses.extract_options!
        super(options)
&nbsp;
        unless [String, Dalli::Client, NilClass].include?(addresses.first.class)
          raise ArgumentError, "First argument must be an empty array, an array of hosts or a Dalli::Client instance."
        end
        if addresses.first.is_a?(Dalli::Client)
          @data = addresses.first
        else
          mem_cache_options = options.dup
          UNIVERSAL_OPTIONS.each { |name| mem_cache_options.delete(name) }
          @data = self.class.build_mem_cache(*(addresses + [mem_cache_options]))
        end
      end
&nbsp;
      # Reads multiple values from the cache using a single call to the
      # servers for all keys. Options can be passed in the last argument.
<span class="fstat-no" title="function not covered" >      def read_multi(*names)</span>
<span class="cstat-no" title="statement not covered" >        options = names.extract_options!</span>
<span class="cstat-no" title="statement not covered" >        options = merged_options(options)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        keys_to_names = Hash[names.map <span class="fstat-no" title="function not covered" >{ |name|</span> <span class="cstat-no" title="statement not covered" >[normalize_key(name, options), name]</span> }]</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        raw_values = @data.get_multi(keys_to_names.keys)</span>
<span class="cstat-no" title="statement not covered" >        values = {}</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        raw_values.each <span class="fstat-no" title="function not covered" >do |key, value|</span></span>
<span class="cstat-no" title="statement not covered" >          entry = deserialize_entry(value)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          unless entry.expired? || entry.mismatched?(normalize_version(keys_to_names[key], options))</span>
<span class="cstat-no" title="statement not covered" >            values[keys_to_names[key]] = entry.value</span>
          end
        end
&nbsp;
<span class="cstat-no" title="statement not covered" >        values</span>
      end
&nbsp;
      # Increment a cached value. This method uses the memcached incr atomic
      # operator and can only be used on values written with the :raw option.
      # Calling it on a value not stored with :raw will initialize that value
      # to zero.
<span class="fstat-no" title="function not covered" >      def increment(name, amount = <span class="cstat-no" title="statement not covered" >1</span>, options = <span class="cstat-no" title="statement not covered" >nil</span>)</span>
<span class="cstat-no" title="statement not covered" >        options = merged_options(options)</span>
<span class="cstat-no" title="statement not covered" >        instrument(:increment, name, amount: amount) <span class="fstat-no" title="function not covered" >do</span></span>
<span class="cstat-no" title="statement not covered" >          rescue_error_with nil <span class="fstat-no" title="function not covered" >do</span></span>
<span class="cstat-no" title="statement not covered" >            @data.incr(normalize_key(name, options), amount)</span>
          end
        end
      end
&nbsp;
      # Decrement a cached value. This method uses the memcached decr atomic
      # operator and can only be used on values written with the :raw option.
      # Calling it on a value not stored with :raw will initialize that value
      # to zero.
<span class="fstat-no" title="function not covered" >      def decrement(name, amount = <span class="cstat-no" title="statement not covered" >1</span>, options = <span class="cstat-no" title="statement not covered" >nil</span>)</span>
<span class="cstat-no" title="statement not covered" >        options = merged_options(options)</span>
<span class="cstat-no" title="statement not covered" >        instrument(:decrement, name, amount: amount) <span class="fstat-no" title="function not covered" >do</span></span>
<span class="cstat-no" title="statement not covered" >          rescue_error_with nil <span class="fstat-no" title="function not covered" >do</span></span>
<span class="cstat-no" title="statement not covered" >            @data.decr(normalize_key(name, options), amount)</span>
          end
        end
      end
&nbsp;
      # Clear the entire cache on all memcached servers. This method should
      # be used with care when shared cache is being used.
<span class="fstat-no" title="function not covered" >      def clear(options = <span class="cstat-no" title="statement not covered" >nil</span>)</span>
<span class="cstat-no" title="statement not covered" >        rescue_error_with(nil) <span class="fstat-no" title="function not covered" >{</span> <span class="cstat-no" title="statement not covered" >@data.flush_all</span> }</span>
      end
&nbsp;
      # Get the statistics from the memcached servers.
<span class="fstat-no" title="function not covered" >      def stats</span>
<span class="cstat-no" title="statement not covered" >        @data.stats</span>
      end
&nbsp;
      private
        # Read an entry from the cache.
<span class="fstat-no" title="function not covered" >        def read_entry(key, options)</span>
<span class="cstat-no" title="statement not covered" >          rescue_error_with(nil) <span class="fstat-no" title="function not covered" >{</span> <span class="cstat-no" title="statement not covered" >deserialize_entry(@data.get(key, options))</span> }</span>
        end
&nbsp;
        # Write an entry to the cache.
<span class="fstat-no" title="function not covered" >        def write_entry(key, entry, options)</span>
<span class="cstat-no" title="statement not covered" >          method = options &amp;&amp; options[:unless_exist] ? <span class="cstat-no" title="statement not covered" >:add</span> : <span class="cstat-no" title="statement not covered" >:set</span></span>
<span class="cstat-no" title="statement not covered" >          value = options[:raw] ? <span class="cstat-no" title="statement not covered" >entry.value.to_s</span> : <span class="cstat-no" title="statement not covered" >entry</span></span>
<span class="cstat-no" title="statement not covered" >          expires_in = options[:expires_in].to_i</span>
<span class="cstat-no" title="statement not covered" >          if expires_in &gt; 0 &amp;&amp; !options[:raw]</span>
            # Set the memcache expire a few minutes in the future to support race condition ttls on read
<span class="cstat-no" title="statement not covered" >            expires_in += 5.minutes</span>
          end
<span class="cstat-no" title="statement not covered" >          rescue_error_with false <span class="fstat-no" title="function not covered" >do</span></span>
<span class="cstat-no" title="statement not covered" >            @data.send(method, key, value, expires_in, options)</span>
          end
        end
&nbsp;
        # Delete an entry from the cache.
<span class="fstat-no" title="function not covered" >        def delete_entry(key, options)</span>
<span class="cstat-no" title="statement not covered" >          rescue_error_with(false) <span class="fstat-no" title="function not covered" >{</span> <span class="cstat-no" title="statement not covered" >@data.delete(key)</span> }</span>
        end
&nbsp;
        # Memcache keys are binaries. So we need to force their encoding to binary
        # before applying the regular expression to ensure we are escaping all
        # characters properly.
<span class="fstat-no" title="function not covered" >        def normalize_key(key, options)</span>
<span class="cstat-no" title="statement not covered" >          key = super.dup</span>
<span class="cstat-no" title="statement not covered" >          key = key.force_encoding(Encoding::ASCII_8BIT)</span>
<span class="cstat-no" title="statement not covered" >          key = key.gsub(ESCAPE_KEY_CHARS) <span class="fstat-no" title="function not covered" >{ |match|</span> <span class="cstat-no" title="statement not covered" >"%#{<span class="cstat-no" title="statement not covered" >match.getbyte(0).to_s(16).upcase</span>}"</span> }</span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" >          key = "#{<span class="cstat-no" title="statement not covered" >key[0, 213]</span>}:md5:#{<span class="cstat-no" title="statement not covered" >Digest::MD5.hexdigest(key)</span>}"</span> if key.size &gt; 250</span>
<span class="cstat-no" title="statement not covered" >          key</span>
        end
&nbsp;
<span class="fstat-no" title="function not covered" >        def deserialize_entry(raw_value)</span>
<span class="cstat-no" title="statement not covered" >          if raw_value</span>
<span class="cstat-no" title="statement not covered" >            entry = <span class="cstat-no" title="statement not covered" >Marshal.load(raw_value)</span> rescue <span class="cstat-no" title="statement not covered" >raw_value</span></span>
<span class="cstat-no" title="statement not covered" >            entry.is_a?(Entry) ? <span class="cstat-no" title="statement not covered" >entry</span> : <span class="cstat-no" title="statement not covered" >Entry.new(entry)</span></span>
          end
        end
&nbsp;
<span class="fstat-no" title="function not covered" >        def rescue_error_with(fallback)</span>
<span class="cstat-no" title="statement not covered" >          yield</span>
        rescue <span class="cstat-no" title="statement not covered" >Dalli::DalliError</span> =&gt; <span class="cstat-no" title="statement not covered" >e</span>
<span class="cstat-no" title="statement not covered" ><span class="cstat-no" title="statement not covered" >          logger.error("DalliError (#{<span class="cstat-no" title="statement not covered" >e</span>}): #{<span class="cstat-no" title="statement not covered" >e.message</span>}")</span> if logger</span>
<span class="cstat-no" title="statement not covered" >          fallback</span>
        end
    end
  end
end
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Thu Nov 02 2017 15:49:54 GMT-0400 (EDT)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
