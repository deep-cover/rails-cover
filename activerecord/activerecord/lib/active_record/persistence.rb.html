<!DOCTYPE html>
<html>
  <head>
    <base href="../../.."/>
    <script src="assets/jquery-3.2.1.min.js"></script>
    <script src="https://use.fontawesome.com/81e98abb93.js"></script>
    <link rel="stylesheet" href="assets/deep_cover.css" type="text/css"/>
  </head>
  <body class="source">
    <div class="overlay">
      <div class="center">
        <div class="stats"><table><tr><th class="node">Nodes</th><th class="per_char">Chars</th><th class="branch">Branches</th></tr><tr><td class="node"><span class="executed" title="executed">790</span>  / <span class="potentially_executable" title="potentially_executable">813</span></td><td class="per_char"><span class="executed" title="executed">6398</span>  / <span class="potentially_executable" title="potentially_executable">6623</span></td><td class="branch"><span class="executed" title="executed">37</span>  / <span class="potentially_executable" title="potentially_executable">40</span></td></tr></table></div>
      </div>
    </div>
    <header>
      <div class="content">
        <div class="info"><span class="deep-cover"><span class="deep">Deep</span>Cover</span>
          <span class="version">v0.1.16</span>
        </div>
        <div class="nav">
          <a href="index.html" aria-label="Home"><i class="fa fa-home" aria-hidden="true"></i></a>
          <span class="path">activerecord/lib/active_record/persistence.rb<span>
        </div>
      </div>
    </header>
    <main class="source"><table class="source"><tr><td id="L1" class="nb">1</td><td># frozen_string_literal: true</td></tr><tr><td id="L2" class="nb">2</td><td></td></tr><tr><td id="L3" class="nb">3</td><td><span class="node-module kind-keyword run" title="11x">module</span> <span class="node-const kind-name run" title="11x">ActiveRecord</span></td></tr><tr><td id="L4" class="nb">4</td><td>  # = Active Record \Persistence</td></tr><tr><td id="L5" class="nb">5</td><td>  <span class="node-module kind-keyword run" title="11x">module</span> <span class="node-const kind-name run" title="11x">Persistence</span></td></tr><tr><td id="L6" class="nb">6</td><td>    <span class="node-send kind-selector_begin run" title="11x">extend</span> <span class="node-const kind-name run" title="11x">ActiveSupport</span><span class="node-const kind-double_colon run" title="11x">::</span><span class="node-const kind-name run" title="11x">Concern</span></td></tr><tr><td id="L7" class="nb">7</td><td></td></tr><tr><td id="L8" class="nb">8</td><td>    <span class="node-module kind-keyword run" title="11x">module</span> <span class="node-const kind-name run" title="11x">ClassMethods</span></td></tr><tr><td id="L9" class="nb">9</td><td>      # Creates an object (or multiple objects) and saves it to the database, if validations pass.</td></tr><tr><td id="L10" class="nb">10</td><td>      # The resulting object is returned whether the object was saved successfully to the database or not.</td></tr><tr><td id="L11" class="nb">11</td><td>      #</td></tr><tr><td id="L12" class="nb">12</td><td>      # The +attributes+ parameter can be either a Hash or an Array of Hashes. These Hashes describe the</td></tr><tr><td id="L13" class="nb">13</td><td>      # attributes on the objects that are to be created.</td></tr><tr><td id="L14" class="nb">14</td><td>      #</td></tr><tr><td id="L15" class="nb">15</td><td>      # ==== Examples</td></tr><tr><td id="L16" class="nb">16</td><td>      #   # Create a single new object</td></tr><tr><td id="L17" class="nb">17</td><td>      #   User.create(first_name: 'Jamie')</td></tr><tr><td id="L18" class="nb">18</td><td>      #</td></tr><tr><td id="L19" class="nb">19</td><td>      #   # Create an Array of new objects</td></tr><tr><td id="L20" class="nb">20</td><td>      #   User.create([{ first_name: 'Jamie' }, { first_name: 'Jeremy' }])</td></tr><tr><td id="L21" class="nb">21</td><td>      #</td></tr><tr><td id="L22" class="nb">22</td><td>      #   # Create a single object and pass it into a block to set other attributes.</td></tr><tr><td id="L23" class="nb">23</td><td>      #   User.create(first_name: 'Jamie') do |u|</td></tr><tr><td id="L24" class="nb">24</td><td>      #     u.is_admin = false</td></tr><tr><td id="L25" class="nb">25</td><td>      #   end</td></tr><tr><td id="L26" class="nb">26</td><td>      #</td></tr><tr><td id="L27" class="nb">27</td><td>      #   # Creating an Array of new objects using a block, where the block is executed for each object:</td></tr><tr><td id="L28" class="nb">28</td><td>      #   User.create([{ first_name: 'Jamie' }, { first_name: 'Jeremy' }]) do |u|</td></tr><tr><td id="L29" class="nb">29</td><td>      #     u.is_admin = false</td></tr><tr><td id="L30" class="nb">30</td><td>      #   end</td></tr><tr><td id="L31" class="nb">31</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">create</span>(attributes = <span class="node-nil kind-expression run" title="503x">nil</span>, &amp;block)</td></tr><tr><td id="L32" class="nb">32</td><td>        <span class="fork fork-whole fork-run " data-fork-id="0"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="6255x"></i><span class="node-if kind-keyword run" title="6255x">if</span> <span class="node-lvar kind-name run" title="6255x">attributes</span><span class="node-send kind-dot run" title="6255x">.</span><span class="node-send kind-selector_begin run" title="6255x">is_a?</span>(<span class="node-const kind-name run" title="6255x">Array</span>)</span></td></tr><tr><td id="L33" class="nb">33</td><td>          <span class="fork fork-branch fork-run " data-fork-id="0"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="31x"></i><span class="node-lvar kind-name run" title="31x">attributes</span><span class="node-send kind-dot run" title="31x">.</span><span class="node-send kind-selector_begin run" title="31x">collect</span> { |attr| <span class="node-send kind-selector_begin run" title="62x">create</span>(<span class="node-lvar kind-name run" title="62x">attr</span>, <span class="node-block_pass kind-operator run" title="62x">&amp;</span><span class="node-lvar kind-name run" title="62x">block</span>) }</span></td></tr><tr><td id="L34" class="nb">34</td><td>        <span class="node-begin kind-else run" title="6224x">else</span></td></tr><tr><td id="L35" class="nb">35</td><td>          <span class="fork fork-branch fork-run " data-fork-id="0"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="6224x"></i><span class="node-lvasgn kind-name run" title="6217x">object</span> <span class="node-lvasgn kind-operator run" title="6217x">=</span> <span class="node-send kind-selector_begin run" title="6224x">new</span>(<span class="node-lvar kind-name run" title="6224x">attributes</span>, <span class="node-block_pass kind-operator run" title="6224x">&amp;</span><span class="node-lvar kind-name run" title="6224x">block</span>)</span></td></tr><tr><td id="L36" class="nb">36</td><td>          <span class="node-lvar kind-name run" title="6217x">object</span><span class="node-send kind-dot run" title="6217x">.</span><span class="node-send kind-selector_begin run" title="6217x">save</span></td></tr><tr><td id="L37" class="nb">37</td><td>          <span class="node-lvar kind-name run" title="6179x">object</span></td></tr><tr><td id="L38" class="nb">38</td><td>        end</td></tr><tr><td id="L39" class="nb">39</td><td>      end</td></tr><tr><td id="L40" class="nb">40</td><td></td></tr><tr><td id="L41" class="nb">41</td><td>      # Creates an object (or multiple objects) and saves it to the database,</td></tr><tr><td id="L42" class="nb">42</td><td>      # if validations pass. Raises a RecordInvalid error if validations fail,</td></tr><tr><td id="L43" class="nb">43</td><td>      # unlike Base#create.</td></tr><tr><td id="L44" class="nb">44</td><td>      #</td></tr><tr><td id="L45" class="nb">45</td><td>      # The +attributes+ parameter can be either a Hash or an Array of Hashes.</td></tr><tr><td id="L46" class="nb">46</td><td>      # These describe which attributes to be created on the object, or</td></tr><tr><td id="L47" class="nb">47</td><td>      # multiple objects when given an Array of Hashes.</td></tr><tr><td id="L48" class="nb">48</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">create!</span>(attributes = <span class="node-nil kind-expression run" title="2456x">nil</span>, &amp;block)</td></tr><tr><td id="L49" class="nb">49</td><td>        <span class="fork fork-whole fork-run " data-fork-id="1"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="8059x"></i><span class="node-if kind-keyword run" title="8059x">if</span> <span class="node-lvar kind-name run" title="8059x">attributes</span><span class="node-send kind-dot run" title="8059x">.</span><span class="node-send kind-selector_begin run" title="8059x">is_a?</span>(<span class="node-const kind-name run" title="8059x">Array</span>)</span></td></tr><tr><td id="L50" class="nb">50</td><td>          <span class="fork fork-branch fork-run " data-fork-id="1"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="5x"></i><span class="node-lvar kind-name run" title="24x">attributes</span><span class="node-send kind-dot run" title="24x">.</span><span class="node-send kind-selector_begin run" title="24x">collect</span> { |attr| <span class="node-send kind-selector_begin run" title="34x">create!</span>(<span class="node-lvar kind-name run" title="34x">attr</span>, <span class="node-block_pass kind-operator run" title="34x">&amp;</span><span class="node-lvar kind-name run" title="34x">block</span>) }</span></td></tr><tr><td id="L51" class="nb">51</td><td>        <span class="node-begin kind-else run" title="8035x">else</span></td></tr><tr><td id="L52" class="nb">52</td><td>          <span class="fork fork-branch fork-run " data-fork-id="1"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="8035x"></i><span class="node-lvasgn kind-name run" title="8035x">object</span> <span class="node-lvasgn kind-operator run" title="8035x">=</span> <span class="node-send kind-selector_begin run" title="8035x">new</span>(<span class="node-lvar kind-name run" title="8035x">attributes</span>, <span class="node-block_pass kind-operator run" title="8035x">&amp;</span><span class="node-lvar kind-name run" title="8035x">block</span>)</span></td></tr><tr><td id="L53" class="nb">53</td><td>          <span class="node-lvar kind-name run" title="8035x">object</span><span class="node-send kind-dot run" title="8035x">.</span><span class="node-send kind-selector_begin run" title="8035x">save!</span></td></tr><tr><td id="L54" class="nb">54</td><td>          <span class="node-lvar kind-name run" title="7931x">object</span></td></tr><tr><td id="L55" class="nb">55</td><td>        end</td></tr><tr><td id="L56" class="nb">56</td><td>      end</td></tr><tr><td id="L57" class="nb">57</td><td></td></tr><tr><td id="L58" class="nb">58</td><td>      # Given an attributes hash, +instantiate+ returns a new instance of</td></tr><tr><td id="L59" class="nb">59</td><td>      # the appropriate class. Accepts only keys as strings.</td></tr><tr><td id="L60" class="nb">60</td><td>      #</td></tr><tr><td id="L61" class="nb">61</td><td>      # For example, +Post.all+ may return Comments, Messages, and Emails</td></tr><tr><td id="L62" class="nb">62</td><td>      # by storing the record's subclass in a +type+ attribute. By calling</td></tr><tr><td id="L63" class="nb">63</td><td>      # +instantiate+ instead of +new+, finder methods ensure they get new</td></tr><tr><td id="L64" class="nb">64</td><td>      # instances of the appropriate class for each record.</td></tr><tr><td id="L65" class="nb">65</td><td>      #</td></tr><tr><td id="L66" class="nb">66</td><td>      # See &lt;tt&gt;ActiveRecord::Inheritance#discriminate_class_for_record&lt;/tt&gt; to see</td></tr><tr><td id="L67" class="nb">67</td><td>      # how this "single-table" inheritance mapping is implemented.</td></tr><tr><td id="L68" class="nb">68</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">instantiate</span>(attributes, column_types = <span class="node-hash kind-begin run" title="5990x">{</span><span class="node-hash kind-end run" title="5990x">}</span>, &amp;block)</td></tr><tr><td id="L69" class="nb">69</td><td>        <span class="node-lvasgn kind-name run" title="117999x">klass</span> <span class="node-lvasgn kind-operator run" title="117999x">=</span> <span class="node-send kind-selector_begin run" title="118020x">discriminate_class_for_record</span>(<span class="node-lvar kind-name run" title="118020x">attributes</span>)</td></tr><tr><td id="L70" class="nb">70</td><td>        <span class="node-lvasgn kind-name run" title="117999x">attributes</span> <span class="node-lvasgn kind-operator run" title="117999x">=</span> <span class="node-lvar kind-name run" title="117999x">klass</span><span class="node-send kind-dot run" title="117999x">.</span><span class="node-send kind-selector_begin run" title="117999x">attributes_builder</span><span class="node-send kind-dot run" title="117999x">.</span><span class="node-send kind-selector_begin run" title="117999x">build_from_database</span>(<span class="node-lvar kind-name run" title="117999x">attributes</span>, <span class="node-lvar kind-name run" title="117999x">column_types</span>)</td></tr><tr><td id="L71" class="nb">71</td><td>        <span class="node-lvar kind-name run" title="117999x">klass</span><span class="node-send kind-dot run" title="117999x">.</span><span class="node-send kind-selector_begin run" title="117999x">allocate</span><span class="node-send kind-dot run" title="117999x">.</span><span class="node-send kind-selector_begin run" title="117999x">init_with</span>(<span class="node-str kind-expression run" title="117999x">"attributes"</span> <span class="node-pair kind-operator run" title="117999x">=&gt;</span> <span class="node-lvar kind-name run" title="117999x">attributes</span>, <span class="node-str kind-expression run" title="117999x">"new_record"</span> <span class="node-pair kind-operator run" title="117999x">=&gt;</span> <span class="node-false kind-expression run" title="117999x">false</span>, <span class="node-block_pass kind-operator run" title="117999x">&amp;</span><span class="node-lvar kind-name run" title="117999x">block</span>)</td></tr><tr><td id="L72" class="nb">72</td><td>      end</td></tr><tr><td id="L73" class="nb">73</td><td></td></tr><tr><td id="L74" class="nb">74</td><td>      # Updates an object (or multiple objects) and saves it to the database, if validations pass.</td></tr><tr><td id="L75" class="nb">75</td><td>      # The resulting object is returned whether the object was saved successfully to the database or not.</td></tr><tr><td id="L76" class="nb">76</td><td>      #</td></tr><tr><td id="L77" class="nb">77</td><td>      # ==== Parameters</td></tr><tr><td id="L78" class="nb">78</td><td>      #</td></tr><tr><td id="L79" class="nb">79</td><td>      # * +id+ - This should be the id or an array of ids to be updated.</td></tr><tr><td id="L80" class="nb">80</td><td>      # * +attributes+ - This should be a hash of attributes or an array of hashes.</td></tr><tr><td id="L81" class="nb">81</td><td>      #</td></tr><tr><td id="L82" class="nb">82</td><td>      # ==== Examples</td></tr><tr><td id="L83" class="nb">83</td><td>      #</td></tr><tr><td id="L84" class="nb">84</td><td>      #   # Updates one record</td></tr><tr><td id="L85" class="nb">85</td><td>      #   Person.update(15, user_name: "Samuel", group: "expert")</td></tr><tr><td id="L86" class="nb">86</td><td>      #</td></tr><tr><td id="L87" class="nb">87</td><td>      #   # Updates multiple records</td></tr><tr><td id="L88" class="nb">88</td><td>      #   people = { 1 =&gt; { "first_name" =&gt; "David" }, 2 =&gt; { "first_name" =&gt; "Jeremy" } }</td></tr><tr><td id="L89" class="nb">89</td><td>      #   Person.update(people.keys, people.values)</td></tr><tr><td id="L90" class="nb">90</td><td>      #</td></tr><tr><td id="L91" class="nb">91</td><td>      #   # Updates multiple records from the result of a relation</td></tr><tr><td id="L92" class="nb">92</td><td>      #   people = Person.where(group: "expert")</td></tr><tr><td id="L93" class="nb">93</td><td>      #   people.update(group: "masters")</td></tr><tr><td id="L94" class="nb">94</td><td>      #</td></tr><tr><td id="L95" class="nb">95</td><td>      # Note: Updating a large number of records will run an UPDATE</td></tr><tr><td id="L96" class="nb">96</td><td>      # query for each record, which may cause a performance issue.</td></tr><tr><td id="L97" class="nb">97</td><td>      # When running callbacks is not needed for each record update,</td></tr><tr><td id="L98" class="nb">98</td><td>      # it is preferred to use {update_all}[rdoc-ref:Relation#update_all]</td></tr><tr><td id="L99" class="nb">99</td><td>      # for updating all records in a single query.</td></tr><tr><td id="L100" class="nb">100</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update</span>(id = <span class="node-sym kind-expression run" title="5x">:all</span>, attributes)</td></tr><tr><td id="L101" class="nb">101</td><td>        <span class="fork fork-whole fork-run " data-fork-id="2"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="55x"></i><span class="node-if kind-keyword run" title="55x">if</span> <span class="node-lvar kind-name run" title="55x">id</span><span class="node-send kind-dot run" title="55x">.</span><span class="node-send kind-selector_begin run" title="55x">is_a?</span>(<span class="node-const kind-name run" title="55x">Array</span>)</span></td></tr><tr><td id="L102" class="nb">102</td><td>          <span class="fork fork-branch fork-run " data-fork-id="2"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="18x"></i><span class="node-lvar kind-name run" title="36x">id</span><span class="node-send kind-dot run" title="36x">.</span><span class="node-send kind-selector_begin run" title="36x">map</span> { |one_id| <span class="node-send kind-selector_begin run" title="81x">find</span>(<span class="node-lvar kind-name run" title="81x">one_id</span>) }<span class="node-send kind-dot run" title="18x">.</span><span class="node-send kind-selector_begin run" title="18x">each_with_index</span> { |object, idx|</span></td></tr><tr><td id="L103" class="nb">103</td><td>            <span class="node-lvar kind-name run" title="45x">object</span><span class="node-send kind-dot run" title="45x">.</span><span class="node-send kind-selector_begin run" title="45x">update</span>(<span class="node-lvar kind-name run" title="45x">attributes</span><span class="node-send kind-selector_begin run" title="45x">[</span><span class="node-lvar kind-name run" title="45x">idx</span><span class="node-send kind-selector_end run" title="45x">]</span>)</td></tr><tr><td id="L104" class="nb">104</td><td>          }</td></tr><tr><td id="L105" class="nb">105</td><td>        <span class="fork fork-whole fork-run " data-fork-id="3"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="19x"></i><span class="fork fork-branch fork-run " data-fork-id="2"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="19x"></i><span class="node-if kind-else run" title="19x"><span class="node-if kind-keyword run" title="19x">elsif</span></span> <span class="node-lvar kind-name run" title="19x">id</span> <span class="node-send kind-selector_begin run" title="19x">==</span> <span class="node-sym kind-expression run" title="19x">:all</span></span></span></td></tr><tr><td id="L106" class="nb">106</td><td>          <span class="fork fork-branch fork-run " data-fork-id="3"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="5x"></i><span class="node-send kind-selector_begin run" title="5x">all</span><span class="node-send kind-dot run" title="5x">.</span><span class="node-send kind-selector_begin run" title="5x">each</span> { |record| <span class="node-lvar kind-name run" title="10x">record</span><span class="node-send kind-dot run" title="10x">.</span><span class="node-send kind-selector_begin run" title="10x">update</span>(<span class="node-lvar kind-name run" title="10x">attributes</span>) }</span></td></tr><tr><td id="L107" class="nb">107</td><td>        <span class="node-begin kind-else run" title="14x">else</span></td></tr><tr><td id="L108" class="nb">108</td><td>          <span class="fork fork-whole fork-run " data-fork-id="4"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="14x"></i><span class="fork fork-branch fork-run " data-fork-id="3"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="14x"></i><span class="node-if kind-keyword run" title="14x">if</span> <span class="node-const kind-name run" title="14x">ActiveRecord</span><span class="node-const kind-double_colon run" title="14x">::</span><span class="node-const kind-name run" title="14x">Base</span> <span class="node-send kind-selector_begin run" title="14x">===</span> <span class="node-lvar kind-name run" title="14x">id</span></span></span></td></tr><tr><td id="L109" class="nb">109</td><td>            <span class="fork fork-branch fork-run " data-fork-id="4"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="5x"></i><span class="node-send kind-selector_begin run" title="5x">raise</span> <span class="node-const kind-name run" title="5x">ArgumentError</span>,</span></td></tr><tr><td id="L110" class="nb">110</td><td>              <span class="node-str kind-expression run" title="5x">"You are passing an instance of ActiveRecord::Base to `update`. "</span> \</td></tr><tr><td id="L111" class="nb">111</td><td>              <span class="node-str kind-expression run" title="5x">"Please pass the id of the object by calling `.id`."</span></td></tr><tr><td id="L112" class="nb">112</td><td>          end</td></tr><tr><td id="L113" class="nb">113</td><td>          <span class="node-lvasgn kind-name not-run" title="never run">object</span> <span class="node-lvasgn kind-operator not-run" title="never run">=</span> <span class="node-send kind-selector_begin run" title="9x">find</span>(<span class="node-lvar kind-name run" title="9x">id</span>)</td></tr><tr><td id="L114" class="nb">114</td><td>          <span class="node-lvar kind-name not-run" title="never run">object</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">update</span>(<span class="node-lvar kind-name not-run" title="never run">attributes</span>)</td></tr><tr><td id="L115" class="nb">115</td><td>          <span class="node-lvar kind-name not-run" title="never run">object</span></td></tr><tr><td id="L116" class="nb">116</td><td>        end</td></tr><tr><td id="L117" class="nb">117</td><td>      end</td></tr><tr><td id="L118" class="nb">118</td><td></td></tr><tr><td id="L119" class="nb">119</td><td>      # Destroy an object (or multiple objects) that has the given id. The object is instantiated first,</td></tr><tr><td id="L120" class="nb">120</td><td>      # therefore all callbacks and filters are fired off before the object is deleted. This method is</td></tr><tr><td id="L121" class="nb">121</td><td>      # less efficient than #delete but allows cleanup methods and other actions to be run.</td></tr><tr><td id="L122" class="nb">122</td><td>      #</td></tr><tr><td id="L123" class="nb">123</td><td>      # This essentially finds the object (or multiple objects) with the given id, creates a new object</td></tr><tr><td id="L124" class="nb">124</td><td>      # from the attributes, and then calls destroy on it.</td></tr><tr><td id="L125" class="nb">125</td><td>      #</td></tr><tr><td id="L126" class="nb">126</td><td>      # ==== Parameters</td></tr><tr><td id="L127" class="nb">127</td><td>      #</td></tr><tr><td id="L128" class="nb">128</td><td>      # * +id+ - This should be the id or an array of ids to be destroyed.</td></tr><tr><td id="L129" class="nb">129</td><td>      #</td></tr><tr><td id="L130" class="nb">130</td><td>      # ==== Examples</td></tr><tr><td id="L131" class="nb">131</td><td>      #</td></tr><tr><td id="L132" class="nb">132</td><td>      #   # Destroy a single object</td></tr><tr><td id="L133" class="nb">133</td><td>      #   Todo.destroy(1)</td></tr><tr><td id="L134" class="nb">134</td><td>      #</td></tr><tr><td id="L135" class="nb">135</td><td>      #   # Destroy multiple objects</td></tr><tr><td id="L136" class="nb">136</td><td>      #   todos = [1,2,3]</td></tr><tr><td id="L137" class="nb">137</td><td>      #   Todo.destroy(todos)</td></tr><tr><td id="L138" class="nb">138</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroy</span>(id)</td></tr><tr><td id="L139" class="nb">139</td><td>        <span class="fork fork-whole fork-run " data-fork-id="5"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="55x"></i><span class="node-if kind-keyword run" title="55x">if</span> <span class="node-lvar kind-name run" title="55x">id</span><span class="node-send kind-dot run" title="55x">.</span><span class="node-send kind-selector_begin run" title="55x">is_a?</span>(<span class="node-const kind-name run" title="55x">Array</span>)</span></td></tr><tr><td id="L140" class="nb">140</td><td>          <span class="fork fork-branch fork-run " data-fork-id="5"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="9x"></i><span class="node-send kind-selector_begin run" title="18x">find</span>(<span class="node-lvar kind-name run" title="18x">id</span>)<span class="node-send kind-dot run" title="9x">.</span><span class="node-send kind-selector_begin run" title="9x">each</span>(<span class="node-block_pass kind-operator run" title="9x">&amp;</span><span class="node-sym kind-expression run" title="9x">:destroy</span>)</span></td></tr><tr><td id="L141" class="nb">141</td><td>        <span class="node-send kind-else run" title="19x">else</span></td></tr><tr><td id="L142" class="nb">142</td><td>          <span class="fork fork-branch fork-run " data-fork-id="5"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="19x"></i><span class="node-send kind-selector_begin run" title="37x">find</span>(<span class="node-lvar kind-name run" title="37x">id</span>)<span class="node-send kind-dot run" title="19x">.</span><span class="node-send kind-selector_begin run" title="19x">destroy</span></span></td></tr><tr><td id="L143" class="nb">143</td><td>        end</td></tr><tr><td id="L144" class="nb">144</td><td>      end</td></tr><tr><td id="L145" class="nb">145</td><td></td></tr><tr><td id="L146" class="nb">146</td><td>      # Deletes the row with a primary key matching the +id+ argument, using a</td></tr><tr><td id="L147" class="nb">147</td><td>      # SQL +DELETE+ statement, and returns the number of rows deleted. Active</td></tr><tr><td id="L148" class="nb">148</td><td>      # Record objects are not instantiated, so the object's callbacks are not</td></tr><tr><td id="L149" class="nb">149</td><td>      # executed, including any &lt;tt&gt;:dependent&lt;/tt&gt; association options.</td></tr><tr><td id="L150" class="nb">150</td><td>      #</td></tr><tr><td id="L151" class="nb">151</td><td>      # You can delete multiple rows at once by passing an Array of &lt;tt&gt;id&lt;/tt&gt;s.</td></tr><tr><td id="L152" class="nb">152</td><td>      #</td></tr><tr><td id="L153" class="nb">153</td><td>      # Note: Although it is often much faster than the alternative, #destroy,</td></tr><tr><td id="L154" class="nb">154</td><td>      # skipping callbacks might bypass business logic in your application</td></tr><tr><td id="L155" class="nb">155</td><td>      # that ensures referential integrity or performs other essential jobs.</td></tr><tr><td id="L156" class="nb">156</td><td>      #</td></tr><tr><td id="L157" class="nb">157</td><td>      # ==== Examples</td></tr><tr><td id="L158" class="nb">158</td><td>      #</td></tr><tr><td id="L159" class="nb">159</td><td>      #   # Delete a single row</td></tr><tr><td id="L160" class="nb">160</td><td>      #   Todo.delete(1)</td></tr><tr><td id="L161" class="nb">161</td><td>      #</td></tr><tr><td id="L162" class="nb">162</td><td>      #   # Delete multiple rows</td></tr><tr><td id="L163" class="nb">163</td><td>      #   Todo.delete([2,3,4])</td></tr><tr><td id="L164" class="nb">164</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">delete</span>(id_or_array)</td></tr><tr><td id="L165" class="nb">165</td><td>        <span class="node-send kind-selector_begin run" title="40x">where</span>(<span class="node-send kind-selector_begin run" title="40x">primary_key</span> <span class="node-pair kind-operator run" title="40x">=&gt;</span> <span class="node-lvar kind-name run" title="40x">id_or_array</span>)<span class="node-send kind-dot run" title="40x">.</span><span class="node-send kind-selector_begin run" title="40x">delete_all</span></td></tr><tr><td id="L166" class="nb">166</td><td>      end</td></tr><tr><td id="L167" class="nb">167</td><td></td></tr><tr><td id="L168" class="nb">168</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_insert_record</span>(values) # :nodoc:</td></tr><tr><td id="L169" class="nb">169</td><td>        <span class="node-lvasgn kind-name run" title="25862x">primary_key_value</span> <span class="node-lvasgn kind-operator run" title="25862x">=</span> <span class="node-nil kind-expression run" title="25862x">nil</span></td></tr><tr><td id="L170" class="nb">170</td><td></td></tr><tr><td id="L171" class="nb">171</td><td>        <span class="fork fork-whole fork-run " data-fork-id="6"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25862x"></i><span class="node-if kind-keyword run" title="25862x">if</span> <span class="fork fork-whole fork-run " data-fork-id="7"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25862x"></i><span class="node-send kind-selector_begin run" title="25862x">primary_key</span> <span class="node-and kind-operator run" title="25862x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="7"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23977x"></i><span class="node-const kind-name run" title="23977x">Hash</span> <span class="node-send kind-selector_begin run" title="23977x">===</span> <span class="node-lvar kind-name run" title="23977x">values</span></span></span></span></td></tr><tr><td id="L172" class="nb">172</td><td>          <span class="fork fork-branch fork-run " data-fork-id="6"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23977x"></i><span class="node-lvasgn kind-name run" title="23977x">arel_primary_key</span> <span class="node-lvasgn kind-operator run" title="23977x">=</span> <span class="node-send kind-selector_begin run" title="23977x">arel_attribute</span>(<span class="node-send kind-selector_begin run" title="23977x">primary_key</span>)</span></td></tr><tr><td id="L173" class="nb">173</td><td>          <span class="node-lvasgn kind-name run" title="23977x">primary_key_value</span> <span class="node-lvasgn kind-operator run" title="23977x">=</span> <span class="node-lvar kind-name run" title="23977x">values</span><span class="node-send kind-selector_begin run" title="23977x">[</span><span class="node-lvar kind-name run" title="23977x">arel_primary_key</span><span class="node-send kind-selector_end run" title="23977x">]</span></td></tr><tr><td id="L174" class="nb">174</td><td></td></tr><tr><td id="L175" class="nb">175</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="8"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy branch not covered"></i><span class="node-if kind-keyword run" title="23977x">if</span> <span class="fork fork-whole fork-run " data-fork-id="9"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23977x"></i><span class="node-send kind-selector_begin run" title="23977x">!</span><span class="node-lvar kind-name run" title="23977x">primary_key_value</span> <span class="node-and kind-operator run" title="23977x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="9"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23342x"></i><span class="node-send kind-selector_begin run" title="23342x">prefetch_primary_key?</span></span></span></span></td></tr><tr><td id="L176" class="nb">176</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="8"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-lvasgn kind-name not-run" title="never run">primary_key_value</span> <span class="node-lvasgn kind-operator not-run" title="never run">=</span> <span class="node-send kind-selector_begin not-run" title="never run">next_sequence_value</span></span></td></tr><tr><td id="L177" class="nb">177</td><td>            <span class="node-lvar kind-name not-run" title="never run">values</span><span class="node-send kind-selector_begin not-run" title="never run">[</span><span class="node-lvar kind-name not-run" title="never run">arel_primary_key</span><span class="node-send kind-selector_end not-run" title="never run">]</span> <span class="node-send kind-operator not-run" title="never run">=</span> <span class="node-lvar kind-name not-run" title="never run">primary_key_value</span></td></tr><tr><td id="L178" class="nb">178</td><td>          end</td></tr><tr><td id="L179" class="nb">179</td><td>        end</td></tr><tr><td id="L180" class="nb">180</td><td></td></tr><tr><td id="L181" class="nb">181</td><td>        <span class="fork fork-whole fork-run " data-fork-id="10"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25862x"></i><span class="node-if kind-keyword run" title="25862x">if</span> <span class="node-lvar kind-name run" title="25862x">values</span><span class="node-send kind-dot run" title="25862x">.</span><span class="node-send kind-selector_begin run" title="25862x">empty?</span></span></td></tr><tr><td id="L182" class="nb">182</td><td>          <span class="fork fork-branch fork-run " data-fork-id="10"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2496x"></i><span class="node-lvasgn kind-name run" title="2496x">im</span> <span class="node-lvasgn kind-operator run" title="2496x">=</span> <span class="node-send kind-selector_begin run" title="2496x">arel_table</span><span class="node-send kind-dot run" title="2496x">.</span><span class="node-send kind-selector_begin run" title="2496x">compile_insert</span>(<span class="node-send kind-selector_begin run" title="2496x">connection</span><span class="node-send kind-dot run" title="2496x">.</span><span class="node-send kind-selector_begin run" title="2496x">empty_insert_statement_value</span>)</span></td></tr><tr><td id="L183" class="nb">183</td><td>          <span class="node-lvar kind-name run" title="2496x">im</span><span class="node-send kind-dot run" title="2496x">.</span><span class="node-send kind-selector_begin run" title="2496x">into</span> <span class="node-send kind-selector_begin run" title="2496x">arel_table</span></td></tr><tr><td id="L184" class="nb">184</td><td>        <span class="node-lvasgn kind-else run" title="23366x">else</span></td></tr><tr><td id="L185" class="nb">185</td><td>          <span class="fork fork-branch fork-run " data-fork-id="10"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23366x"></i><span class="node-lvasgn kind-name run" title="23366x">im</span> <span class="node-lvasgn kind-operator run" title="23366x">=</span> <span class="node-send kind-selector_begin run" title="23366x">arel_table</span><span class="node-send kind-dot run" title="23366x">.</span><span class="node-send kind-selector_begin run" title="23366x">compile_insert</span>(<span class="node-send kind-selector_begin run" title="23366x">_substitute_values</span>(<span class="node-lvar kind-name run" title="23366x">values</span>))</span></td></tr><tr><td id="L186" class="nb">186</td><td>        end</td></tr><tr><td id="L187" class="nb">187</td><td></td></tr><tr><td id="L188" class="nb">188</td><td>        <span class="node-send kind-selector_begin run" title="25862x">connection</span><span class="node-send kind-dot run" title="25862x">.</span><span class="node-send kind-selector_begin run" title="25862x">insert</span>(<span class="node-lvar kind-name run" title="25862x">im</span>, <span class="node-dstr kind-begin run" title="25862x">"</span><span class="node-begin kind-begin run" title="25862x">#{</span><span class="node-self kind-expression run" title="25862x">self</span><span class="node-begin kind-end run" title="25862x">}</span><span class="node-str kind-expression run" title="25862x"> Create</span><span class="node-dstr kind-end run" title="25862x">"</span>, <span class="fork fork-whole fork-run " data-fork-id="11"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25862x"></i><span class="node-send kind-selector_begin run" title="25862x">primary_key</span> <span class="node-or kind-operator run" title="25862x">||</span> <span class="fork fork-branch fork-run " data-fork-id="11"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1885x"></i><span class="node-false kind-expression run" title="1885x">false</span></span></span>, <span class="node-lvar kind-name run" title="25862x">primary_key_value</span>)</td></tr><tr><td id="L189" class="nb">189</td><td>      end</td></tr><tr><td id="L190" class="nb">190</td><td></td></tr><tr><td id="L191" class="nb">191</td><td>      <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_update_record</span>(values, id, id_was) # :nodoc:</td></tr><tr><td id="L192" class="nb">192</td><td>        <span class="node-lvasgn kind-name run" title="3897x">bind</span> <span class="node-lvasgn kind-operator run" title="3897x">=</span> <span class="node-send kind-selector_begin run" title="3897x">predicate_builder</span><span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">build_bind_attribute</span>(<span class="node-send kind-selector_begin run" title="3897x">primary_key</span>, <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="left-hand side not covered"></i><span class="node-lvar kind-name run" title="3897x">id_was</span> <span class="node-or kind-operator run" title="3897x">||</span> <span class="fork fork-branch fork-not-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-lvar kind-name not-run" title="never run">id</span></span></span>)</td></tr><tr><td id="L193" class="nb">193</td><td>        <span class="node-lvasgn kind-name run" title="3897x">um</span> <span class="node-lvasgn kind-operator run" title="3897x">=</span> <span class="node-send kind-selector_begin run" title="3897x">arel_table</span><span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">where</span>(</td></tr><tr><td id="L194" class="nb">194</td><td>          <span class="node-send kind-selector_begin run" title="3897x">arel_attribute</span>(<span class="node-send kind-selector_begin run" title="3897x">primary_key</span>)<span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">eq</span>(<span class="node-lvar kind-name run" title="3897x">bind</span>)</td></tr><tr><td id="L195" class="nb">195</td><td>        )<span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">compile_update</span>(<span class="node-send kind-selector_begin run" title="3897x">_substitute_values</span>(<span class="node-lvar kind-name run" title="3897x">values</span>), <span class="node-send kind-selector_begin run" title="3897x">primary_key</span>)</td></tr><tr><td id="L196" class="nb">196</td><td></td></tr><tr><td id="L197" class="nb">197</td><td>        <span class="node-send kind-selector_begin run" title="3897x">connection</span><span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">update</span>(<span class="node-lvar kind-name run" title="3897x">um</span>, <span class="node-dstr kind-begin run" title="3897x">"</span><span class="node-begin kind-begin run" title="3897x">#{</span><span class="node-self kind-expression run" title="3897x">self</span><span class="node-begin kind-end run" title="3897x">}</span><span class="node-str kind-expression run" title="3897x"> Update</span><span class="node-dstr kind-end run" title="3897x">"</span>)</td></tr><tr><td id="L198" class="nb">198</td><td>      end</td></tr><tr><td id="L199" class="nb">199</td><td></td></tr><tr><td id="L200" class="nb">200</td><td>      <span class="node-send kind-selector_begin run" title="11x">private</span></td></tr><tr><td id="L201" class="nb">201</td><td>        # Called by +instantiate+ to decide which class to use for a new</td></tr><tr><td id="L202" class="nb">202</td><td>        # record instance.</td></tr><tr><td id="L203" class="nb">203</td><td>        #</td></tr><tr><td id="L204" class="nb">204</td><td>        # See +ActiveRecord::Inheritance#discriminate_class_for_record+ for</td></tr><tr><td id="L205" class="nb">205</td><td>        # the single-table inheritance discriminator.</td></tr><tr><td id="L206" class="nb">206</td><td>        <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">discriminate_class_for_record</span>(record)</td></tr><tr><td id="L207" class="nb">207</td><td>          <span class="node-self kind-expression run" title="69703x">self</span></td></tr><tr><td id="L208" class="nb">208</td><td>        end</td></tr><tr><td id="L209" class="nb">209</td><td></td></tr><tr><td id="L210" class="nb">210</td><td>        <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_substitute_values</span>(values)</td></tr><tr><td id="L211" class="nb">211</td><td>          <span class="node-lvar kind-name run" title="27263x">values</span><span class="node-send kind-dot run" title="27263x">.</span><span class="node-send kind-selector_begin run" title="27263x">map</span> do |attr, value|</td></tr><tr><td id="L212" class="nb">212</td><td>            <span class="node-lvasgn kind-name run" title="71940x">bind</span> <span class="node-lvasgn kind-operator run" title="71940x">=</span> <span class="node-send kind-selector_begin run" title="71940x">predicate_builder</span><span class="node-send kind-dot run" title="71940x">.</span><span class="node-send kind-selector_begin run" title="71940x">build_bind_attribute</span>(<span class="node-lvar kind-name run" title="71940x">attr</span><span class="node-send kind-dot run" title="71940x">.</span><span class="node-send kind-selector_begin run" title="71940x">name</span>, <span class="node-lvar kind-name run" title="71940x">value</span>)</td></tr><tr><td id="L213" class="nb">213</td><td>            <span class="node-array kind-begin run" title="71940x">[</span><span class="node-lvar kind-name run" title="71940x">attr</span>, <span class="node-lvar kind-name run" title="71940x">bind</span><span class="node-array kind-end run" title="71940x">]</span></td></tr><tr><td id="L214" class="nb">214</td><td>          end</td></tr><tr><td id="L215" class="nb">215</td><td>        end</td></tr><tr><td id="L216" class="nb">216</td><td>    end</td></tr><tr><td id="L217" class="nb">217</td><td></td></tr><tr><td id="L218" class="nb">218</td><td>    # Returns true if this object hasn't been saved yet -- that is, a record</td></tr><tr><td id="L219" class="nb">219</td><td>    # for the object doesn't exist in the database yet; otherwise, returns false.</td></tr><tr><td id="L220" class="nb">220</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">new_record?</span></td></tr><tr><td id="L221" class="nb">221</td><td>      <span class="node-send kind-selector_begin run" title="184614x">sync_with_transaction_state</span></td></tr><tr><td id="L222" class="nb">222</td><td>      <span class="node-ivar kind-name run" title="184614x">@new_record</span></td></tr><tr><td id="L223" class="nb">223</td><td>    end</td></tr><tr><td id="L224" class="nb">224</td><td></td></tr><tr><td id="L225" class="nb">225</td><td>    # Returns true if this object has been destroyed, otherwise returns false.</td></tr><tr><td id="L226" class="nb">226</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroyed?</span></td></tr><tr><td id="L227" class="nb">227</td><td>      <span class="node-send kind-selector_begin run" title="26598x">sync_with_transaction_state</span></td></tr><tr><td id="L228" class="nb">228</td><td>      <span class="node-ivar kind-name run" title="26598x">@destroyed</span></td></tr><tr><td id="L229" class="nb">229</td><td>    end</td></tr><tr><td id="L230" class="nb">230</td><td></td></tr><tr><td id="L231" class="nb">231</td><td>    # Returns true if the record is persisted, i.e. it's not a new record and it was</td></tr><tr><td id="L232" class="nb">232</td><td>    # not destroyed, otherwise returns false.</td></tr><tr><td id="L233" class="nb">233</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">persisted?</span></td></tr><tr><td id="L234" class="nb">234</td><td>      <span class="node-send kind-selector_begin run" title="43380x">sync_with_transaction_state</span></td></tr><tr><td id="L235" class="nb">235</td><td>      <span class="node-send kind-selector_begin run" title="43380x">!</span>(<span class="fork fork-whole fork-run " data-fork-id="13"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="43380x"></i><span class="node-ivar kind-name run" title="43380x">@new_record</span> <span class="node-or kind-operator run" title="43380x">||</span> <span class="fork fork-branch fork-run " data-fork-id="13"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="37508x"></i><span class="node-ivar kind-name run" title="37508x">@destroyed</span></span></span>)</td></tr><tr><td id="L236" class="nb">236</td><td>    end</td></tr><tr><td id="L237" class="nb">237</td><td></td></tr><tr><td id="L238" class="nb">238</td><td>    ##</td></tr><tr><td id="L239" class="nb">239</td><td>    # :call-seq:</td></tr><tr><td id="L240" class="nb">240</td><td>    #   save(*args)</td></tr><tr><td id="L241" class="nb">241</td><td>    #</td></tr><tr><td id="L242" class="nb">242</td><td>    # Saves the model.</td></tr><tr><td id="L243" class="nb">243</td><td>    #</td></tr><tr><td id="L244" class="nb">244</td><td>    # If the model is new, a record gets created in the database, otherwise</td></tr><tr><td id="L245" class="nb">245</td><td>    # the existing record gets updated.</td></tr><tr><td id="L246" class="nb">246</td><td>    #</td></tr><tr><td id="L247" class="nb">247</td><td>    # By default, save always runs validations. If any of them fail the action</td></tr><tr><td id="L248" class="nb">248</td><td>    # is cancelled and #save returns +false+, and the record won't be saved. However, if you supply</td></tr><tr><td id="L249" class="nb">249</td><td>    # &lt;tt&gt;validate: false&lt;/tt&gt;, validations are bypassed altogether. See</td></tr><tr><td id="L250" class="nb">250</td><td>    # ActiveRecord::Validations for more information.</td></tr><tr><td id="L251" class="nb">251</td><td>    #</td></tr><tr><td id="L252" class="nb">252</td><td>    # By default, #save also sets the +updated_at+/+updated_on+ attributes to</td></tr><tr><td id="L253" class="nb">253</td><td>    # the current time. However, if you supply &lt;tt&gt;touch: false&lt;/tt&gt;, these</td></tr><tr><td id="L254" class="nb">254</td><td>    # timestamps will not be updated.</td></tr><tr><td id="L255" class="nb">255</td><td>    #</td></tr><tr><td id="L256" class="nb">256</td><td>    # There's a series of callbacks associated with #save. If any of the</td></tr><tr><td id="L257" class="nb">257</td><td>    # &lt;tt&gt;before_*&lt;/tt&gt; callbacks throws +:abort+ the action is cancelled and</td></tr><tr><td id="L258" class="nb">258</td><td>    # #save returns +false+. See ActiveRecord::Callbacks for further</td></tr><tr><td id="L259" class="nb">259</td><td>    # details.</td></tr><tr><td id="L260" class="nb">260</td><td>    #</td></tr><tr><td id="L261" class="nb">261</td><td>    # Attributes marked as readonly are silently ignored if the record is</td></tr><tr><td id="L262" class="nb">262</td><td>    # being updated.</td></tr><tr><td id="L263" class="nb">263</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">save</span>(*args, &amp;block)</td></tr><tr><td id="L264" class="nb">264</td><td>      <span class="node-send kind-selector_begin run" title="18361x">create_or_update</span>(<span class="node-splat kind-operator run" title="18361x">*</span><span class="node-lvar kind-name run" title="18361x">args</span>, <span class="node-block_pass kind-operator run" title="18361x">&amp;</span><span class="node-lvar kind-name run" title="18361x">block</span>)</td></tr><tr><td id="L265" class="nb">265</td><td>    <span class="node-resbody kind-keyword run" title="14x">rescue</span> <span class="node-const kind-name run" title="371x">ActiveRecord</span><span class="node-const kind-double_colon run" title="371x">::</span><span class="node-const kind-name run" title="371x">RecordInvalid</span></td></tr><tr><td id="L266" class="nb">266</td><td>      <span class="node-false kind-expression run" title="14x">false</span></td></tr><tr><td id="L267" class="nb">267</td><td>    end</td></tr><tr><td id="L268" class="nb">268</td><td></td></tr><tr><td id="L269" class="nb">269</td><td>    ##</td></tr><tr><td id="L270" class="nb">270</td><td>    # :call-seq:</td></tr><tr><td id="L271" class="nb">271</td><td>    #   save!(*args)</td></tr><tr><td id="L272" class="nb">272</td><td>    #</td></tr><tr><td id="L273" class="nb">273</td><td>    # Saves the model.</td></tr><tr><td id="L274" class="nb">274</td><td>    #</td></tr><tr><td id="L275" class="nb">275</td><td>    # If the model is new, a record gets created in the database, otherwise</td></tr><tr><td id="L276" class="nb">276</td><td>    # the existing record gets updated.</td></tr><tr><td id="L277" class="nb">277</td><td>    #</td></tr><tr><td id="L278" class="nb">278</td><td>    # By default, #save! always runs validations. If any of them fail</td></tr><tr><td id="L279" class="nb">279</td><td>    # ActiveRecord::RecordInvalid gets raised, and the record won't be saved. However, if you supply</td></tr><tr><td id="L280" class="nb">280</td><td>    # &lt;tt&gt;validate: false&lt;/tt&gt;, validations are bypassed altogether. See</td></tr><tr><td id="L281" class="nb">281</td><td>    # ActiveRecord::Validations for more information.</td></tr><tr><td id="L282" class="nb">282</td><td>    #</td></tr><tr><td id="L283" class="nb">283</td><td>    # By default, #save! also sets the +updated_at+/+updated_on+ attributes to</td></tr><tr><td id="L284" class="nb">284</td><td>    # the current time. However, if you supply &lt;tt&gt;touch: false&lt;/tt&gt;, these</td></tr><tr><td id="L285" class="nb">285</td><td>    # timestamps will not be updated.</td></tr><tr><td id="L286" class="nb">286</td><td>    #</td></tr><tr><td id="L287" class="nb">287</td><td>    # There's a series of callbacks associated with #save!. If any of</td></tr><tr><td id="L288" class="nb">288</td><td>    # the &lt;tt&gt;before_*&lt;/tt&gt; callbacks throws +:abort+ the action is cancelled</td></tr><tr><td id="L289" class="nb">289</td><td>    # and #save! raises ActiveRecord::RecordNotSaved. See</td></tr><tr><td id="L290" class="nb">290</td><td>    # ActiveRecord::Callbacks for further details.</td></tr><tr><td id="L291" class="nb">291</td><td>    #</td></tr><tr><td id="L292" class="nb">292</td><td>    # Attributes marked as readonly are silently ignored if the record is</td></tr><tr><td id="L293" class="nb">293</td><td>    # being updated.</td></tr><tr><td id="L294" class="nb">294</td><td>    #</td></tr><tr><td id="L295" class="nb">295</td><td>    # Unless an error is raised, returns true.</td></tr><tr><td id="L296" class="nb">296</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">save!</span>(*args, &amp;block)</td></tr><tr><td id="L297" class="nb">297</td><td>      <span class="fork fork-whole fork-run " data-fork-id="14"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="15427x"></i><span class="node-send kind-selector_begin run" title="15427x">create_or_update</span>(<span class="node-splat kind-operator run" title="15427x">*</span><span class="node-lvar kind-name run" title="15427x">args</span>, <span class="node-block_pass kind-operator run" title="15427x">&amp;</span><span class="node-lvar kind-name run" title="15427x">block</span>) <span class="node-or kind-operator run" title="15427x">||</span> <span class="fork fork-branch fork-run " data-fork-id="14"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23x"></i><span class="node-send kind-selector_begin run" title="23x">raise</span>(<span class="node-const kind-name run" title="23x">RecordNotSaved</span><span class="node-send kind-dot run" title="23x">.</span><span class="node-send kind-selector_begin run" title="23x">new</span>(<span class="node-str kind-expression run" title="23x">"Failed to save the record"</span>, <span class="node-self kind-expression run" title="23x">self</span>))</span></span></td></tr><tr><td id="L298" class="nb">298</td><td>    end</td></tr><tr><td id="L299" class="nb">299</td><td></td></tr><tr><td id="L300" class="nb">300</td><td>    # Deletes the record in the database and freezes this instance to</td></tr><tr><td id="L301" class="nb">301</td><td>    # reflect that no changes should be made (since they can't be</td></tr><tr><td id="L302" class="nb">302</td><td>    # persisted). Returns the frozen instance.</td></tr><tr><td id="L303" class="nb">303</td><td>    #</td></tr><tr><td id="L304" class="nb">304</td><td>    # The row is simply removed with an SQL +DELETE+ statement on the</td></tr><tr><td id="L305" class="nb">305</td><td>    # record's primary key, and no callbacks are executed.</td></tr><tr><td id="L306" class="nb">306</td><td>    #</td></tr><tr><td id="L307" class="nb">307</td><td>    # Note that this will also delete records marked as {#readonly?}[rdoc-ref:Core#readonly?].</td></tr><tr><td id="L308" class="nb">308</td><td>    #</td></tr><tr><td id="L309" class="nb">309</td><td>    # To enforce the object's +before_destroy+ and +after_destroy+</td></tr><tr><td id="L310" class="nb">310</td><td>    # callbacks or any &lt;tt&gt;:dependent&lt;/tt&gt; association</td></tr><tr><td id="L311" class="nb">311</td><td>    # options, use &lt;tt&gt;#destroy&lt;/tt&gt;.</td></tr><tr><td id="L312" class="nb">312</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">delete</span></td></tr><tr><td id="L313" class="nb">313</td><td>      <span class="fork fork-whole fork-run " data-fork-id="15"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="735x"></i><span class="fork fork-branch fork-run " data-fork-id="15"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="678x"></i><span class="node-send kind-selector_begin run" title="678x">_relation_for_itself</span><span class="node-send kind-dot run" title="678x">.</span><span class="node-send kind-selector_begin run" title="678x">delete_all</span></span> <span class="node-if kind-keyword run" title="735x">if</span> <span class="node-send kind-selector_begin run" title="735x">persisted?</span></span></td></tr><tr><td id="L314" class="nb">314</td><td>      <span class="node-ivasgn kind-name run" title="735x">@destroyed</span> <span class="node-ivasgn kind-operator run" title="735x">=</span> <span class="node-true kind-expression run" title="735x">true</span></td></tr><tr><td id="L315" class="nb">315</td><td>      <span class="node-send kind-selector_begin run" title="735x">freeze</span></td></tr><tr><td id="L316" class="nb">316</td><td>    end</td></tr><tr><td id="L317" class="nb">317</td><td></td></tr><tr><td id="L318" class="nb">318</td><td>    # Deletes the record in the database and freezes this instance to reflect</td></tr><tr><td id="L319" class="nb">319</td><td>    # that no changes should be made (since they can't be persisted).</td></tr><tr><td id="L320" class="nb">320</td><td>    #</td></tr><tr><td id="L321" class="nb">321</td><td>    # There's a series of callbacks associated with #destroy. If the</td></tr><tr><td id="L322" class="nb">322</td><td>    # &lt;tt&gt;before_destroy&lt;/tt&gt; callback throws +:abort+ the action is cancelled</td></tr><tr><td id="L323" class="nb">323</td><td>    # and #destroy returns +false+.</td></tr><tr><td id="L324" class="nb">324</td><td>    # See ActiveRecord::Callbacks for further details.</td></tr><tr><td id="L325" class="nb">325</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroy</span></td></tr><tr><td id="L326" class="nb">326</td><td>      <span class="fork fork-whole fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2321x"></i><span class="fork fork-branch fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="6x"></i><span class="node-send kind-selector_begin run" title="6x">_raise_readonly_record_error</span></span> <span class="node-if kind-keyword run" title="2321x">if</span> <span class="node-send kind-selector_begin run" title="2321x">readonly?</span></span></td></tr><tr><td id="L327" class="nb">327</td><td>      <span class="node-send kind-selector_begin run" title="2315x">destroy_associations</span></td></tr><tr><td id="L328" class="nb">328</td><td>      <span class="node-self kind-expression run" title="2315x">self</span><span class="node-send kind-dot run" title="2315x">.</span><span class="node-send kind-selector_begin run" title="2315x">class</span><span class="node-send kind-dot run" title="2315x">.</span><span class="node-send kind-selector_begin run" title="2315x">connection</span><span class="node-send kind-dot run" title="2315x">.</span><span class="node-send kind-selector_begin run" title="2315x">add_transaction_record</span>(<span class="node-self kind-expression run" title="2315x">self</span>)</td></tr><tr><td id="L329" class="nb">329</td><td>      <span class="node-ivasgn kind-name run" title="2298x">@_trigger_destroy_callback</span> <span class="node-ivasgn kind-operator run" title="2298x">=</span> <span class="fork fork-whole fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2315x"></i><span class="node-if kind-keyword run" title="2315x">if</span> <span class="node-send kind-selector_begin run" title="2315x">persisted?</span></span></td></tr><tr><td id="L330" class="nb">330</td><td>        <span class="fork fork-branch fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2267x"></i><span class="node-send kind-selector_begin run" title="2284x">destroy_row</span> <span class="node-send kind-selector_begin run" title="2267x">&gt;</span> <span class="node-int kind-expression run" title="2267x">0</span></span></td></tr><tr><td id="L331" class="nb">331</td><td>      <span class="node-true kind-else run" title="31x">else</span></td></tr><tr><td id="L332" class="nb">332</td><td>        <span class="fork fork-branch fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="31x"></i><span class="node-true kind-expression run" title="31x">true</span></span></td></tr><tr><td id="L333" class="nb">333</td><td>      end</td></tr><tr><td id="L334" class="nb">334</td><td>      <span class="node-ivasgn kind-name run" title="2298x">@destroyed</span> <span class="node-ivasgn kind-operator run" title="2298x">=</span> <span class="node-true kind-expression run" title="2298x">true</span></td></tr><tr><td id="L335" class="nb">335</td><td>      <span class="node-send kind-selector_begin run" title="2298x">freeze</span></td></tr><tr><td id="L336" class="nb">336</td><td>    end</td></tr><tr><td id="L337" class="nb">337</td><td></td></tr><tr><td id="L338" class="nb">338</td><td>    # Deletes the record in the database and freezes this instance to reflect</td></tr><tr><td id="L339" class="nb">339</td><td>    # that no changes should be made (since they can't be persisted).</td></tr><tr><td id="L340" class="nb">340</td><td>    #</td></tr><tr><td id="L341" class="nb">341</td><td>    # There's a series of callbacks associated with #destroy!. If the</td></tr><tr><td id="L342" class="nb">342</td><td>    # &lt;tt&gt;before_destroy&lt;/tt&gt; callback throws +:abort+ the action is cancelled</td></tr><tr><td id="L343" class="nb">343</td><td>    # and #destroy! raises ActiveRecord::RecordNotDestroyed.</td></tr><tr><td id="L344" class="nb">344</td><td>    # See ActiveRecord::Callbacks for further details.</td></tr><tr><td id="L345" class="nb">345</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroy!</span></td></tr><tr><td id="L346" class="nb">346</td><td>      <span class="fork fork-whole fork-run " data-fork-id="18"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="758x"></i><span class="node-send kind-selector_begin run" title="758x">destroy</span> <span class="node-or kind-operator run" title="758x">||</span> <span class="fork fork-branch fork-run " data-fork-id="18"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="54x"></i><span class="node-send kind-selector_begin run" title="54x">_raise_record_not_destroyed</span></span></span></td></tr><tr><td id="L347" class="nb">347</td><td>    end</td></tr><tr><td id="L348" class="nb">348</td><td></td></tr><tr><td id="L349" class="nb">349</td><td>    # Returns an instance of the specified +klass+ with the attributes of the</td></tr><tr><td id="L350" class="nb">350</td><td>    # current record. This is mostly useful in relation to single-table</td></tr><tr><td id="L351" class="nb">351</td><td>    # inheritance structures where you want a subclass to appear as the</td></tr><tr><td id="L352" class="nb">352</td><td>    # superclass. This can be used along with record identification in</td></tr><tr><td id="L353" class="nb">353</td><td>    # Action Pack to allow, say, &lt;tt&gt;Client &lt; Company&lt;/tt&gt; to do something</td></tr><tr><td id="L354" class="nb">354</td><td>    # like render &lt;tt&gt;partial: @client.becomes(Company)&lt;/tt&gt; to render that</td></tr><tr><td id="L355" class="nb">355</td><td>    # instance using the companies/company partial instead of clients/client.</td></tr><tr><td id="L356" class="nb">356</td><td>    #</td></tr><tr><td id="L357" class="nb">357</td><td>    # Note: The new instance will share a link to the same attributes as the original class.</td></tr><tr><td id="L358" class="nb">358</td><td>    # Therefore the sti column value will still be the same.</td></tr><tr><td id="L359" class="nb">359</td><td>    # Any change to the attributes on either instance will affect both instances.</td></tr><tr><td id="L360" class="nb">360</td><td>    # If you want to change the sti column as well, use #becomes! instead.</td></tr><tr><td id="L361" class="nb">361</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">becomes</span>(klass)</td></tr><tr><td id="L362" class="nb">362</td><td>      <span class="node-lvasgn kind-name run" title="229x">became</span> <span class="node-lvasgn kind-operator run" title="229x">=</span> <span class="node-lvar kind-name run" title="229x">klass</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">new</span></td></tr><tr><td id="L363" class="nb">363</td><td>      <span class="node-lvar kind-name run" title="229x">became</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">instance_variable_set</span>(<span class="node-str kind-expression run" title="229x">"@attributes"</span>, <span class="node-ivar kind-name run" title="229x">@attributes</span>)</td></tr><tr><td id="L364" class="nb">364</td><td>      <span class="fork fork-whole fork-run " data-fork-id="19"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="229x"></i><span class="fork fork-branch fork-run " data-fork-id="19"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="35x"></i><span class="node-lvar kind-name run" title="35x">became</span><span class="node-send kind-dot run" title="35x">.</span><span class="node-send kind-selector_begin run" title="35x">instance_variable_set</span>(<span class="node-str kind-expression run" title="35x">"@mutations_from_database"</span>, <span class="node-ivar kind-name run" title="35x">@mutations_from_database</span>)</span> <span class="node-if kind-keyword run" title="229x">if</span> <span class="node-defined? kind-keyword run" title="229x">defined?</span><span class="node-defined? kind-begin run" title="229x">(</span>@mutations_from_database<span class="node-defined? kind-end run" title="229x">)</span></span></td></tr><tr><td id="L365" class="nb">365</td><td>      <span class="node-lvar kind-name run" title="229x">became</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">instance_variable_set</span>(<span class="node-str kind-expression run" title="229x">"@changed_attributes"</span>, <span class="node-send kind-selector_begin run" title="229x">attributes_changed_by_setter</span>)</td></tr><tr><td id="L366" class="nb">366</td><td>      <span class="node-lvar kind-name run" title="229x">became</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">instance_variable_set</span>(<span class="node-str kind-expression run" title="229x">"@new_record"</span>, <span class="node-send kind-selector_begin run" title="229x">new_record?</span>)</td></tr><tr><td id="L367" class="nb">367</td><td>      <span class="node-lvar kind-name run" title="229x">became</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">instance_variable_set</span>(<span class="node-str kind-expression run" title="229x">"@destroyed"</span>, <span class="node-send kind-selector_begin run" title="229x">destroyed?</span>)</td></tr><tr><td id="L368" class="nb">368</td><td>      <span class="node-lvar kind-name run" title="229x">became</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">errors</span><span class="node-send kind-dot run" title="229x">.</span><span class="node-send kind-selector_begin run" title="229x">copy!</span>(<span class="node-send kind-selector_begin run" title="229x">errors</span>)</td></tr><tr><td id="L369" class="nb">369</td><td>      <span class="node-lvar kind-name run" title="229x">became</span></td></tr><tr><td id="L370" class="nb">370</td><td>    end</td></tr><tr><td id="L371" class="nb">371</td><td></td></tr><tr><td id="L372" class="nb">372</td><td>    # Wrapper around #becomes that also changes the instance's sti column value.</td></tr><tr><td id="L373" class="nb">373</td><td>    # This is especially useful if you want to persist the changed class in your</td></tr><tr><td id="L374" class="nb">374</td><td>    # database.</td></tr><tr><td id="L375" class="nb">375</td><td>    #</td></tr><tr><td id="L376" class="nb">376</td><td>    # Note: The old instance's sti column value will be changed too, as both objects</td></tr><tr><td id="L377" class="nb">377</td><td>    # share the same set of attributes.</td></tr><tr><td id="L378" class="nb">378</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">becomes!</span>(klass)</td></tr><tr><td id="L379" class="nb">379</td><td>      <span class="node-lvasgn kind-name run" title="61x">became</span> <span class="node-lvasgn kind-operator run" title="61x">=</span> <span class="node-send kind-selector_begin run" title="61x">becomes</span>(<span class="node-lvar kind-name run" title="61x">klass</span>)</td></tr><tr><td id="L380" class="nb">380</td><td>      <span class="node-lvasgn kind-name run" title="61x">sti_type</span> <span class="node-lvasgn kind-operator run" title="61x">=</span> <span class="node-nil kind-expression run" title="61x">nil</span></td></tr><tr><td id="L381" class="nb">381</td><td>      <span class="fork fork-whole fork-run " data-fork-id="20"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="61x"></i><span class="node-if kind-keyword run" title="61x">if</span> <span class="node-send kind-selector_begin run" title="61x">!</span><span class="node-lvar kind-name run" title="61x">klass</span><span class="node-send kind-dot run" title="61x">.</span><span class="node-send kind-selector_begin run" title="61x">descends_from_active_record?</span></span></td></tr><tr><td id="L382" class="nb">382</td><td>        <span class="fork fork-branch fork-run " data-fork-id="20"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="41x"></i><span class="node-lvasgn kind-name run" title="41x">sti_type</span> <span class="node-lvasgn kind-operator run" title="41x">=</span> <span class="node-lvar kind-name run" title="41x">klass</span><span class="node-send kind-dot run" title="41x">.</span><span class="node-send kind-selector_begin run" title="41x">sti_name</span></span></td></tr><tr><td id="L383" class="nb">383</td><td>      end</td></tr><tr><td id="L384" class="nb">384</td><td>      <span class="node-lvar kind-name run" title="61x">became</span><span class="node-send kind-dot run" title="61x">.</span><span class="node-send kind-selector_begin run" title="61x">public_send</span>(<span class="node-dstr kind-begin run" title="61x">"</span><span class="node-begin kind-begin run" title="61x">#{</span><span class="node-lvar kind-name run" title="61x">klass</span><span class="node-send kind-dot run" title="61x">.</span><span class="node-send kind-selector_begin run" title="61x">inheritance_column</span><span class="node-begin kind-end run" title="61x">}</span><span class="node-str kind-expression run" title="61x">=</span><span class="node-dstr kind-end run" title="61x">"</span>, <span class="node-lvar kind-name run" title="61x">sti_type</span>)</td></tr><tr><td id="L385" class="nb">385</td><td>      <span class="node-lvar kind-name run" title="61x">became</span></td></tr><tr><td id="L386" class="nb">386</td><td>    end</td></tr><tr><td id="L387" class="nb">387</td><td></td></tr><tr><td id="L388" class="nb">388</td><td>    # Updates a single attribute and saves the record.</td></tr><tr><td id="L389" class="nb">389</td><td>    # This is especially useful for boolean flags on existing records. Also note that</td></tr><tr><td id="L390" class="nb">390</td><td>    #</td></tr><tr><td id="L391" class="nb">391</td><td>    # * Validation is skipped.</td></tr><tr><td id="L392" class="nb">392</td><td>    # * \Callbacks are invoked.</td></tr><tr><td id="L393" class="nb">393</td><td>    # * updated_at/updated_on column is updated if that column is available.</td></tr><tr><td id="L394" class="nb">394</td><td>    # * Updates all the attributes that are dirty in this object.</td></tr><tr><td id="L395" class="nb">395</td><td>    #</td></tr><tr><td id="L396" class="nb">396</td><td>    # This method raises an ActiveRecord::ActiveRecordError  if the</td></tr><tr><td id="L397" class="nb">397</td><td>    # attribute is marked as readonly.</td></tr><tr><td id="L398" class="nb">398</td><td>    #</td></tr><tr><td id="L399" class="nb">399</td><td>    # Also see #update_column.</td></tr><tr><td id="L400" class="nb">400</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update_attribute</span>(name, value)</td></tr><tr><td id="L401" class="nb">401</td><td>      <span class="node-lvasgn kind-name run" title="125x">name</span> <span class="node-lvasgn kind-operator run" title="125x">=</span> <span class="node-lvar kind-name run" title="125x">name</span><span class="node-send kind-dot run" title="125x">.</span><span class="node-send kind-selector_begin run" title="125x">to_s</span></td></tr><tr><td id="L402" class="nb">402</td><td>      <span class="node-send kind-selector_begin run" title="125x">verify_readonly_attribute</span>(<span class="node-lvar kind-name run" title="125x">name</span>)</td></tr><tr><td id="L403" class="nb">403</td><td>      <span class="node-send kind-selector_begin run" title="116x">public_send</span>(<span class="node-dstr kind-begin run" title="116x">"</span><span class="node-begin kind-begin run" title="116x">#{</span><span class="node-lvar kind-name run" title="116x">name</span><span class="node-begin kind-end run" title="116x">}</span><span class="node-str kind-expression run" title="116x">=</span><span class="node-dstr kind-end run" title="116x">"</span>, <span class="node-lvar kind-name run" title="116x">value</span>)</td></tr><tr><td id="L404" class="nb">404</td><td></td></tr><tr><td id="L405" class="nb">405</td><td>      <span class="fork fork-whole fork-run " data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="116x"></i><span class="node-if kind-keyword run" title="116x">if</span> <span class="node-send kind-selector_begin run" title="116x">has_changes_to_save?</span></span></td></tr><tr><td id="L406" class="nb">406</td><td>        <span class="fork fork-branch fork-run " data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="107x"></i><span class="node-send kind-selector_begin run" title="107x">save</span>(<span class="node-sym kind-expression run" title="107x">validate</span><span class="node-pair kind-operator run" title="107x">:</span> <span class="node-false kind-expression run" title="107x">false</span>)</span></td></tr><tr><td id="L407" class="nb">407</td><td>      <span class="node-true kind-else run" title="9x">else</span></td></tr><tr><td id="L408" class="nb">408</td><td>        <span class="fork fork-branch fork-run " data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="9x"></i><span class="node-true kind-expression run" title="9x">true</span></span></td></tr><tr><td id="L409" class="nb">409</td><td>      end</td></tr><tr><td id="L410" class="nb">410</td><td>    end</td></tr><tr><td id="L411" class="nb">411</td><td></td></tr><tr><td id="L412" class="nb">412</td><td>    # Updates the attributes of the model from the passed-in hash and saves the</td></tr><tr><td id="L413" class="nb">413</td><td>    # record, all wrapped in a transaction. If the object is invalid, the saving</td></tr><tr><td id="L414" class="nb">414</td><td>    # will fail and false will be returned.</td></tr><tr><td id="L415" class="nb">415</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update</span>(attributes)</td></tr><tr><td id="L416" class="nb">416</td><td>      # The following transaction covers any possible database side-effects of the</td></tr><tr><td id="L417" class="nb">417</td><td>      # attributes assignment. For example, setting the IDs of a child collection.</td></tr><tr><td id="L418" class="nb">418</td><td>      <span class="node-send kind-selector_begin run" title="928x">with_transaction_returning_status</span> do</td></tr><tr><td id="L419" class="nb">419</td><td>        <span class="node-send kind-selector_begin run" title="928x">assign_attributes</span>(<span class="node-lvar kind-name run" title="928x">attributes</span>)</td></tr><tr><td id="L420" class="nb">420</td><td>        <span class="node-send kind-selector_begin run" title="919x">save</span></td></tr><tr><td id="L421" class="nb">421</td><td>      end</td></tr><tr><td id="L422" class="nb">422</td><td>    end</td></tr><tr><td id="L423" class="nb">423</td><td></td></tr><tr><td id="L424" class="nb">424</td><td>    <span class="node-alias kind-keyword run" title="11x">alias</span> <span class="node-sym kind-expression run" title="11x">update_attributes</span> <span class="node-sym kind-expression run" title="11x">update</span></td></tr><tr><td id="L425" class="nb">425</td><td></td></tr><tr><td id="L426" class="nb">426</td><td>    # Updates its receiver just like #update but calls #save! instead</td></tr><tr><td id="L427" class="nb">427</td><td>    # of +save+, so an exception is raised if the record is invalid and saving will fail.</td></tr><tr><td id="L428" class="nb">428</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update!</span>(attributes)</td></tr><tr><td id="L429" class="nb">429</td><td>      # The following transaction covers any possible database side-effects of the</td></tr><tr><td id="L430" class="nb">430</td><td>      # attributes assignment. For example, setting the IDs of a child collection.</td></tr><tr><td id="L431" class="nb">431</td><td>      <span class="node-send kind-selector_begin run" title="575x">with_transaction_returning_status</span> do</td></tr><tr><td id="L432" class="nb">432</td><td>        <span class="node-send kind-selector_begin run" title="575x">assign_attributes</span>(<span class="node-lvar kind-name run" title="575x">attributes</span>)</td></tr><tr><td id="L433" class="nb">433</td><td>        <span class="node-send kind-selector_begin run" title="575x">save!</span></td></tr><tr><td id="L434" class="nb">434</td><td>      end</td></tr><tr><td id="L435" class="nb">435</td><td>    end</td></tr><tr><td id="L436" class="nb">436</td><td></td></tr><tr><td id="L437" class="nb">437</td><td>    <span class="node-alias kind-keyword run" title="11x">alias</span> <span class="node-sym kind-expression run" title="11x">update_attributes!</span> <span class="node-sym kind-expression run" title="11x">update!</span></td></tr><tr><td id="L438" class="nb">438</td><td></td></tr><tr><td id="L439" class="nb">439</td><td>    # Equivalent to &lt;code&gt;update_columns(name =&gt; value)&lt;/code&gt;.</td></tr><tr><td id="L440" class="nb">440</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update_column</span>(name, value)</td></tr><tr><td id="L441" class="nb">441</td><td>      <span class="node-send kind-selector_begin run" title="134x">update_columns</span>(<span class="node-lvar kind-name run" title="134x">name</span> <span class="node-pair kind-operator run" title="134x">=&gt;</span> <span class="node-lvar kind-name run" title="134x">value</span>)</td></tr><tr><td id="L442" class="nb">442</td><td>    end</td></tr><tr><td id="L443" class="nb">443</td><td></td></tr><tr><td id="L444" class="nb">444</td><td>    # Updates the attributes directly in the database issuing an UPDATE SQL</td></tr><tr><td id="L445" class="nb">445</td><td>    # statement and sets them in the receiver:</td></tr><tr><td id="L446" class="nb">446</td><td>    #</td></tr><tr><td id="L447" class="nb">447</td><td>    #   user.update_columns(last_request_at: Time.current)</td></tr><tr><td id="L448" class="nb">448</td><td>    #</td></tr><tr><td id="L449" class="nb">449</td><td>    # This is the fastest way to update attributes because it goes straight to</td></tr><tr><td id="L450" class="nb">450</td><td>    # the database, but take into account that in consequence the regular update</td></tr><tr><td id="L451" class="nb">451</td><td>    # procedures are totally bypassed. In particular:</td></tr><tr><td id="L452" class="nb">452</td><td>    #</td></tr><tr><td id="L453" class="nb">453</td><td>    # * \Validations are skipped.</td></tr><tr><td id="L454" class="nb">454</td><td>    # * \Callbacks are skipped.</td></tr><tr><td id="L455" class="nb">455</td><td>    # * +updated_at+/+updated_on+ are not updated.</td></tr><tr><td id="L456" class="nb">456</td><td>    # * However, attributes are serialized with the same rules as ActiveRecord::Relation#update_all</td></tr><tr><td id="L457" class="nb">457</td><td>    #</td></tr><tr><td id="L458" class="nb">458</td><td>    # This method raises an ActiveRecord::ActiveRecordError when called on new</td></tr><tr><td id="L459" class="nb">459</td><td>    # objects, or when at least one of the attributes is marked as readonly.</td></tr><tr><td id="L460" class="nb">460</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">update_columns</span>(attributes)</td></tr><tr><td id="L461" class="nb">461</td><td>      <span class="fork fork-whole fork-run " data-fork-id="22"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="686x"></i><span class="fork fork-branch fork-run " data-fork-id="22"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="18x"></i><span class="node-send kind-selector_begin run" title="18x">raise</span> <span class="node-const kind-name run" title="18x">ActiveRecordError</span>, <span class="node-str kind-expression run" title="18x">"cannot update a new record"</span></span> <span class="node-if kind-keyword run" title="686x">if</span> <span class="node-send kind-selector_begin run" title="686x">new_record?</span></span></td></tr><tr><td id="L462" class="nb">462</td><td>      <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="23"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy branch not covered"></i><span class="fork fork-branch fork-not-run " data-fork-id="23"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-send kind-selector_begin not-run" title="never run">raise</span> <span class="node-const kind-name not-run" title="never run">ActiveRecordError</span>, <span class="node-str kind-expression not-run" title="never run">"cannot update a destroyed record"</span></span> <span class="node-if kind-keyword run" title="668x">if</span> <span class="node-send kind-selector_begin run" title="668x">destroyed?</span></span></td></tr><tr><td id="L463" class="nb">463</td><td></td></tr><tr><td id="L464" class="nb">464</td><td>      <span class="node-lvar kind-name run" title="668x">attributes</span><span class="node-send kind-dot run" title="668x">.</span><span class="node-send kind-selector_begin run" title="668x">each_key</span> do |key|</td></tr><tr><td id="L465" class="nb">465</td><td>        <span class="node-send kind-selector_begin run" title="728x">verify_readonly_attribute</span>(<span class="node-lvar kind-name run" title="728x">key</span><span class="node-send kind-dot run" title="728x">.</span><span class="node-send kind-selector_begin run" title="728x">to_s</span>)</td></tr><tr><td id="L466" class="nb">466</td><td>      end</td></tr><tr><td id="L467" class="nb">467</td><td></td></tr><tr><td id="L468" class="nb">468</td><td>      <span class="node-lvasgn kind-name run" title="650x">updated_count</span> <span class="node-lvasgn kind-operator run" title="650x">=</span> <span class="node-send kind-selector_begin run" title="650x">_relation_for_itself</span><span class="node-send kind-dot run" title="650x">.</span><span class="node-send kind-selector_begin run" title="650x">update_all</span>(<span class="node-lvar kind-name run" title="650x">attributes</span>)</td></tr><tr><td id="L469" class="nb">469</td><td></td></tr><tr><td id="L470" class="nb">470</td><td>      <span class="node-lvar kind-name run" title="650x">attributes</span><span class="node-send kind-dot run" title="650x">.</span><span class="node-send kind-selector_begin run" title="650x">each</span> do |k, v|</td></tr><tr><td id="L471" class="nb">471</td><td>        <span class="node-send kind-selector_begin run" title="701x">write_attribute_without_type_cast</span>(<span class="node-lvar kind-name run" title="701x">k</span>, <span class="node-lvar kind-name run" title="701x">v</span>)</td></tr><tr><td id="L472" class="nb">472</td><td>      end</td></tr><tr><td id="L473" class="nb">473</td><td></td></tr><tr><td id="L474" class="nb">474</td><td>      <span class="node-lvar kind-name run" title="650x">updated_count</span> <span class="node-send kind-selector_begin run" title="650x">==</span> <span class="node-int kind-expression run" title="650x">1</span></td></tr><tr><td id="L475" class="nb">475</td><td>    end</td></tr><tr><td id="L476" class="nb">476</td><td></td></tr><tr><td id="L477" class="nb">477</td><td>    # Initializes +attribute+ to zero if +nil+ and adds the value passed as +by+ (default is 1).</td></tr><tr><td id="L478" class="nb">478</td><td>    # The increment is performed directly on the underlying attribute, no setter is invoked.</td></tr><tr><td id="L479" class="nb">479</td><td>    # Only makes sense for number-based attributes. Returns +self+.</td></tr><tr><td id="L480" class="nb">480</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">increment</span>(attribute, by = <span class="node-int kind-expression run" title="9x">1</span>)</td></tr><tr><td id="L481" class="nb">481</td><td>      <span class="node-self kind-expression run" title="1797x">self</span><span class="node-send kind-selector_begin run" title="1797x">[</span><span class="node-lvar kind-name run" title="1797x">attribute</span><span class="node-send kind-selector_end run" title="1797x">]</span> <span class="node-or_asgn kind-operator run" title="1797x">||=</span> <span class="node-int kind-expression run" title="57x">0</span></td></tr><tr><td id="L482" class="nb">482</td><td>      <span class="node-self kind-expression run" title="1797x">self</span><span class="node-send kind-selector_begin run" title="1797x">[</span><span class="node-lvar kind-name run" title="1797x">attribute</span><span class="node-send kind-selector_end run" title="1797x">]</span> <span class="node-op_asgn kind-operator run" title="1797x">+=</span> <span class="node-lvar kind-name run" title="1797x">by</span></td></tr><tr><td id="L483" class="nb">483</td><td>      <span class="node-self kind-expression run" title="1797x">self</span></td></tr><tr><td id="L484" class="nb">484</td><td>    end</td></tr><tr><td id="L485" class="nb">485</td><td></td></tr><tr><td id="L486" class="nb">486</td><td>    # Wrapper around #increment that writes the update to the database.</td></tr><tr><td id="L487" class="nb">487</td><td>    # Only +attribute+ is updated; the record itself is not saved.</td></tr><tr><td id="L488" class="nb">488</td><td>    # This means that any other modified attributes will still be dirty.</td></tr><tr><td id="L489" class="nb">489</td><td>    # Validations and callbacks are skipped. Supports the +touch+ option from</td></tr><tr><td id="L490" class="nb">490</td><td>    # +update_counters+, see that for more.</td></tr><tr><td id="L491" class="nb">491</td><td>    # Returns +self+.</td></tr><tr><td id="L492" class="nb">492</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">increment!</span>(attribute, by = <span class="node-int kind-expression run" title="118x">1</span>, touch: <span class="node-nil kind-expression run" title="1302x">nil</span>)</td></tr><tr><td id="L493" class="nb">493</td><td>      <span class="node-send kind-selector_begin run" title="1356x">increment</span>(<span class="node-lvar kind-name run" title="1356x">attribute</span>, <span class="node-lvar kind-name run" title="1356x">by</span>)</td></tr><tr><td id="L494" class="nb">494</td><td>      <span class="node-lvasgn kind-name run" title="1356x">change</span> <span class="node-lvasgn kind-operator run" title="1356x">=</span> <span class="node-send kind-selector_begin run" title="1356x">public_send</span>(<span class="node-lvar kind-name run" title="1356x">attribute</span>) <span class="node-send kind-selector_begin run" title="1356x">-</span> (<span class="fork fork-whole fork-run " data-fork-id="24"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1356x"></i><span class="node-send kind-selector_begin run" title="1356x">attribute_in_database</span>(<span class="node-lvar kind-name run" title="1356x">attribute</span><span class="node-send kind-dot run" title="1356x">.</span><span class="node-send kind-selector_begin run" title="1356x">to_s</span>) <span class="node-or kind-operator run" title="1356x">||</span> <span class="fork fork-branch fork-run " data-fork-id="24"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="57x"></i><span class="node-int kind-expression run" title="57x">0</span></span></span>)</td></tr><tr><td id="L495" class="nb">495</td><td>      <span class="node-self kind-expression run" title="1356x">self</span><span class="node-send kind-dot run" title="1356x">.</span><span class="node-send kind-selector_begin run" title="1356x">class</span><span class="node-send kind-dot run" title="1356x">.</span><span class="node-send kind-selector_begin run" title="1356x">update_counters</span>(<span class="node-send kind-selector_begin run" title="1356x">id</span>, <span class="node-lvar kind-name run" title="1356x">attribute</span> <span class="node-pair kind-operator run" title="1356x">=&gt;</span> <span class="node-lvar kind-name run" title="1356x">change</span>, <span class="node-sym kind-expression run" title="1356x">touch</span><span class="node-pair kind-operator run" title="1356x">:</span> <span class="node-lvar kind-name run" title="1356x">touch</span>)</td></tr><tr><td id="L496" class="nb">496</td><td>      <span class="node-send kind-selector_begin run" title="1356x">clear_attribute_change</span>(<span class="node-lvar kind-name run" title="1356x">attribute</span>) # eww</td></tr><tr><td id="L497" class="nb">497</td><td>      <span class="node-self kind-expression run" title="1356x">self</span></td></tr><tr><td id="L498" class="nb">498</td><td>    end</td></tr><tr><td id="L499" class="nb">499</td><td></td></tr><tr><td id="L500" class="nb">500</td><td>    # Initializes +attribute+ to zero if +nil+ and subtracts the value passed as +by+ (default is 1).</td></tr><tr><td id="L501" class="nb">501</td><td>    # The decrement is performed directly on the underlying attribute, no setter is invoked.</td></tr><tr><td id="L502" class="nb">502</td><td>    # Only makes sense for number-based attributes. Returns +self+.</td></tr><tr><td id="L503" class="nb">503</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">decrement</span>(attribute, by = <span class="node-int kind-expression run" title="9x">1</span>)</td></tr><tr><td id="L504" class="nb">504</td><td>      <span class="node-send kind-selector_begin run" title="18x">increment</span>(<span class="node-lvar kind-name run" title="18x">attribute</span>, <span class="node-send kind-selector_begin run" title="18x">-</span><span class="node-lvar kind-name run" title="18x">by</span>)</td></tr><tr><td id="L505" class="nb">505</td><td>    end</td></tr><tr><td id="L506" class="nb">506</td><td></td></tr><tr><td id="L507" class="nb">507</td><td>    # Wrapper around #decrement that writes the update to the database.</td></tr><tr><td id="L508" class="nb">508</td><td>    # Only +attribute+ is updated; the record itself is not saved.</td></tr><tr><td id="L509" class="nb">509</td><td>    # This means that any other modified attributes will still be dirty.</td></tr><tr><td id="L510" class="nb">510</td><td>    # Validations and callbacks are skipped. Supports the +touch+ option from</td></tr><tr><td id="L511" class="nb">511</td><td>    # +update_counters+, see that for more.</td></tr><tr><td id="L512" class="nb">512</td><td>    # Returns +self+.</td></tr><tr><td id="L513" class="nb">513</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">decrement!</span>(attribute, by = <span class="node-int kind-expression run" title="27x">1</span>, touch: <span class="node-nil kind-expression run" title="36x">nil</span>)</td></tr><tr><td id="L514" class="nb">514</td><td>      <span class="node-send kind-selector_begin run" title="45x">increment!</span>(<span class="node-lvar kind-name run" title="45x">attribute</span>, <span class="node-send kind-selector_begin run" title="45x">-</span><span class="node-lvar kind-name run" title="45x">by</span>, <span class="node-sym kind-expression run" title="45x">touch</span><span class="node-pair kind-operator run" title="45x">:</span> <span class="node-lvar kind-name run" title="45x">touch</span>)</td></tr><tr><td id="L515" class="nb">515</td><td>    end</td></tr><tr><td id="L516" class="nb">516</td><td></td></tr><tr><td id="L517" class="nb">517</td><td>    # Assigns to +attribute+ the boolean opposite of &lt;tt&gt;attribute?&lt;/tt&gt;. So</td></tr><tr><td id="L518" class="nb">518</td><td>    # if the predicate returns +true+ the attribute will become +false+. This</td></tr><tr><td id="L519" class="nb">519</td><td>    # method toggles directly the underlying value without calling any setter.</td></tr><tr><td id="L520" class="nb">520</td><td>    # Returns +self+.</td></tr><tr><td id="L521" class="nb">521</td><td>    #</td></tr><tr><td id="L522" class="nb">522</td><td>    # Example:</td></tr><tr><td id="L523" class="nb">523</td><td>    #</td></tr><tr><td id="L524" class="nb">524</td><td>    #   user = User.first</td></tr><tr><td id="L525" class="nb">525</td><td>    #   user.banned? # =&gt; false</td></tr><tr><td id="L526" class="nb">526</td><td>    #   user.toggle(:banned)</td></tr><tr><td id="L527" class="nb">527</td><td>    #   user.banned? # =&gt; true</td></tr><tr><td id="L528" class="nb">528</td><td>    #</td></tr><tr><td id="L529" class="nb">529</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">toggle</span>(attribute)</td></tr><tr><td id="L530" class="nb">530</td><td>      <span class="node-self kind-expression run" title="16x">self</span><span class="node-send kind-selector_begin run" title="16x">[</span><span class="node-lvar kind-name run" title="16x">attribute</span><span class="node-send kind-selector_end run" title="16x">]</span> <span class="node-send kind-operator run" title="16x">=</span> <span class="node-send kind-selector_begin run" title="16x">!</span><span class="node-send kind-selector_begin run" title="16x">public_send</span>(<span class="node-dstr kind-begin run" title="16x">"</span><span class="node-begin kind-begin run" title="16x">#{</span><span class="node-lvar kind-name run" title="16x">attribute</span><span class="node-begin kind-end run" title="16x">}</span><span class="node-str kind-expression run" title="16x">?</span><span class="node-dstr kind-end run" title="16x">"</span>)</td></tr><tr><td id="L531" class="nb">531</td><td>      <span class="node-self kind-expression run" title="16x">self</span></td></tr><tr><td id="L532" class="nb">532</td><td>    end</td></tr><tr><td id="L533" class="nb">533</td><td></td></tr><tr><td id="L534" class="nb">534</td><td>    # Wrapper around #toggle that saves the record. This method differs from</td></tr><tr><td id="L535" class="nb">535</td><td>    # its non-bang version in the sense that it passes through the attribute setter.</td></tr><tr><td id="L536" class="nb">536</td><td>    # Saving is not subjected to validation checks. Returns +true+ if the</td></tr><tr><td id="L537" class="nb">537</td><td>    # record could be saved.</td></tr><tr><td id="L538" class="nb">538</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">toggle!</span>(attribute)</td></tr><tr><td id="L539" class="nb">539</td><td>      <span class="node-send kind-selector_begin run" title="8x">toggle</span>(<span class="node-lvar kind-name run" title="8x">attribute</span>)<span class="node-send kind-dot run" title="8x">.</span><span class="node-send kind-selector_begin run" title="8x">update_attribute</span>(<span class="node-lvar kind-name run" title="8x">attribute</span>, <span class="node-self kind-expression run" title="8x">self</span><span class="node-send kind-selector_begin run" title="8x">[</span><span class="node-lvar kind-name run" title="8x">attribute</span><span class="node-send kind-selector_end run" title="8x">]</span>)</td></tr><tr><td id="L540" class="nb">540</td><td>    end</td></tr><tr><td id="L541" class="nb">541</td><td></td></tr><tr><td id="L542" class="nb">542</td><td>    # Reloads the record from the database.</td></tr><tr><td id="L543" class="nb">543</td><td>    #</td></tr><tr><td id="L544" class="nb">544</td><td>    # This method finds the record by its primary key (which could be assigned</td></tr><tr><td id="L545" class="nb">545</td><td>    # manually) and modifies the receiver in-place:</td></tr><tr><td id="L546" class="nb">546</td><td>    #</td></tr><tr><td id="L547" class="nb">547</td><td>    #   account = Account.new</td></tr><tr><td id="L548" class="nb">548</td><td>    #   # =&gt; #&lt;Account id: nil, email: nil&gt;</td></tr><tr><td id="L549" class="nb">549</td><td>    #   account.id = 1</td></tr><tr><td id="L550" class="nb">550</td><td>    #   account.reload</td></tr><tr><td id="L551" class="nb">551</td><td>    #   # Account Load (1.2ms)  SELECT "accounts".* FROM "accounts" WHERE "accounts"."id" = $1 LIMIT 1  [["id", 1]]</td></tr><tr><td id="L552" class="nb">552</td><td>    #   # =&gt; #&lt;Account id: 1, email: 'account@example.com'&gt;</td></tr><tr><td id="L553" class="nb">553</td><td>    #</td></tr><tr><td id="L554" class="nb">554</td><td>    # Attributes are reloaded from the database, and caches busted, in</td></tr><tr><td id="L555" class="nb">555</td><td>    # particular the associations cache and the QueryCache.</td></tr><tr><td id="L556" class="nb">556</td><td>    #</td></tr><tr><td id="L557" class="nb">557</td><td>    # If the record no longer exists in the database ActiveRecord::RecordNotFound</td></tr><tr><td id="L558" class="nb">558</td><td>    # is raised. Otherwise, in addition to the in-place modification the method</td></tr><tr><td id="L559" class="nb">559</td><td>    # returns +self+ for convenience.</td></tr><tr><td id="L560" class="nb">560</td><td>    #</td></tr><tr><td id="L561" class="nb">561</td><td>    # The optional &lt;tt&gt;:lock&lt;/tt&gt; flag option allows you to lock the reloaded record:</td></tr><tr><td id="L562" class="nb">562</td><td>    #</td></tr><tr><td id="L563" class="nb">563</td><td>    #   reload(lock: true) # reload with pessimistic locking</td></tr><tr><td id="L564" class="nb">564</td><td>    #</td></tr><tr><td id="L565" class="nb">565</td><td>    # Reloading is commonly used in test suites to test something is actually</td></tr><tr><td id="L566" class="nb">566</td><td>    # written to the database, or when some action modifies the corresponding</td></tr><tr><td id="L567" class="nb">567</td><td>    # row in the database but not the object in memory:</td></tr><tr><td id="L568" class="nb">568</td><td>    #</td></tr><tr><td id="L569" class="nb">569</td><td>    #   assert account.deposit!(25)</td></tr><tr><td id="L570" class="nb">570</td><td>    #   assert_equal 25, account.credit        # check it is updated in memory</td></tr><tr><td id="L571" class="nb">571</td><td>    #   assert_equal 25, account.reload.credit # check it is also persisted</td></tr><tr><td id="L572" class="nb">572</td><td>    #</td></tr><tr><td id="L573" class="nb">573</td><td>    # Another common use case is optimistic locking handling:</td></tr><tr><td id="L574" class="nb">574</td><td>    #</td></tr><tr><td id="L575" class="nb">575</td><td>    #   def with_optimistic_retry</td></tr><tr><td id="L576" class="nb">576</td><td>    #     begin</td></tr><tr><td id="L577" class="nb">577</td><td>    #       yield</td></tr><tr><td id="L578" class="nb">578</td><td>    #     rescue ActiveRecord::StaleObjectError</td></tr><tr><td id="L579" class="nb">579</td><td>    #       begin</td></tr><tr><td id="L580" class="nb">580</td><td>    #         # Reload lock_version in particular.</td></tr><tr><td id="L581" class="nb">581</td><td>    #         reload</td></tr><tr><td id="L582" class="nb">582</td><td>    #       rescue ActiveRecord::RecordNotFound</td></tr><tr><td id="L583" class="nb">583</td><td>    #         # If the record is gone there is nothing to do.</td></tr><tr><td id="L584" class="nb">584</td><td>    #       else</td></tr><tr><td id="L585" class="nb">585</td><td>    #         retry</td></tr><tr><td id="L586" class="nb">586</td><td>    #       end</td></tr><tr><td id="L587" class="nb">587</td><td>    #     end</td></tr><tr><td id="L588" class="nb">588</td><td>    #   end</td></tr><tr><td id="L589" class="nb">589</td><td>    #</td></tr><tr><td id="L590" class="nb">590</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">reload</span>(options = <span class="node-nil kind-expression not-run" title="never run">nil</span>)</td></tr><tr><td id="L591" class="nb">591</td><td>      <span class="node-self kind-expression run" title="4821x">self</span><span class="node-send kind-dot run" title="4821x">.</span><span class="node-send kind-selector_begin run" title="4821x">class</span><span class="node-send kind-dot run" title="4821x">.</span><span class="node-send kind-selector_begin run" title="4821x">connection</span><span class="node-send kind-dot run" title="4821x">.</span><span class="node-send kind-selector_begin run" title="4821x">clear_query_cache</span></td></tr><tr><td id="L592" class="nb">592</td><td></td></tr><tr><td id="L593" class="nb">593</td><td>      <span class="node-lvasgn kind-name run" title="4768x">fresh_object</span> <span class="node-lvasgn kind-operator run" title="4768x">=</span></td></tr><tr><td id="L594" class="nb">594</td><td>        <span class="fork fork-whole fork-run " data-fork-id="25"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4821x"></i><span class="node-if kind-keyword run" title="4821x">if</span> <span class="fork fork-whole fork-run " data-fork-id="26"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4821x"></i><span class="node-lvar kind-name run" title="4821x">options</span> <span class="node-and kind-operator run" title="4821x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="26"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="54x"></i><span class="node-lvar kind-name run" title="54x">options</span><span class="node-send kind-selector_begin run" title="54x">[</span><span class="node-sym kind-expression run" title="54x">:lock</span><span class="node-send kind-selector_end run" title="54x">]</span></span></span></span></td></tr><tr><td id="L595" class="nb">595</td><td>          <span class="fork fork-branch fork-run " data-fork-id="25"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="54x"></i><span class="node-self kind-expression run" title="54x">self</span><span class="node-send kind-dot run" title="54x">.</span><span class="node-send kind-selector_begin run" title="54x">class</span><span class="node-send kind-dot run" title="54x">.</span><span class="node-send kind-selector_begin run" title="54x">unscoped</span> { <span class="node-self kind-expression run" title="54x">self</span><span class="node-send kind-dot run" title="54x">.</span><span class="node-send kind-selector_begin run" title="54x">class</span><span class="node-send kind-dot run" title="54x">.</span><span class="node-send kind-selector_begin run" title="54x">lock</span>(<span class="node-lvar kind-name run" title="54x">options</span><span class="node-send kind-selector_begin run" title="54x">[</span><span class="node-sym kind-expression run" title="54x">:lock</span><span class="node-send kind-selector_end run" title="54x">]</span>)<span class="node-send kind-dot run" title="54x">.</span><span class="node-send kind-selector_begin run" title="54x">find</span>(<span class="node-send kind-selector_begin run" title="54x">id</span>) }</span></td></tr><tr><td id="L596" class="nb">596</td><td>        <span class="node-block kind-else run" title="4714x">else</span></td></tr><tr><td id="L597" class="nb">597</td><td>          <span class="fork fork-branch fork-run " data-fork-id="25"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4714x"></i><span class="node-self kind-expression run" title="4767x">self</span><span class="node-send kind-dot run" title="4767x">.</span><span class="node-send kind-selector_begin run" title="4767x">class</span><span class="node-send kind-dot run" title="4767x">.</span><span class="node-send kind-selector_begin run" title="4767x">unscoped</span> { <span class="node-self kind-expression run" title="4767x">self</span><span class="node-send kind-dot run" title="4767x">.</span><span class="node-send kind-selector_begin run" title="4767x">class</span><span class="node-send kind-dot run" title="4767x">.</span><span class="node-send kind-selector_begin run" title="4767x">find</span>(<span class="node-send kind-selector_begin run" title="4767x">id</span>) }</span></td></tr><tr><td id="L598" class="nb">598</td><td>        end</td></tr><tr><td id="L599" class="nb">599</td><td></td></tr><tr><td id="L600" class="nb">600</td><td>      <span class="node-ivasgn kind-name run" title="4768x">@attributes</span> <span class="node-ivasgn kind-operator run" title="4768x">=</span> <span class="node-lvar kind-name run" title="4768x">fresh_object</span><span class="node-send kind-dot run" title="4768x">.</span><span class="node-send kind-selector_begin run" title="4768x">instance_variable_get</span>(<span class="node-str kind-expression run" title="4768x">"@attributes"</span>)</td></tr><tr><td id="L601" class="nb">601</td><td>      <span class="node-ivasgn kind-name run" title="4768x">@new_record</span> <span class="node-ivasgn kind-operator run" title="4768x">=</span> <span class="node-false kind-expression run" title="4768x">false</span></td></tr><tr><td id="L602" class="nb">602</td><td>      <span class="node-self kind-expression run" title="4768x">self</span></td></tr><tr><td id="L603" class="nb">603</td><td>    end</td></tr><tr><td id="L604" class="nb">604</td><td></td></tr><tr><td id="L605" class="nb">605</td><td>    # Saves the record with the updated_at/on attributes set to the current time</td></tr><tr><td id="L606" class="nb">606</td><td>    # or the time specified.</td></tr><tr><td id="L607" class="nb">607</td><td>    # Please note that no validation is performed and only the +after_touch+,</td></tr><tr><td id="L608" class="nb">608</td><td>    # +after_commit+ and +after_rollback+ callbacks are executed.</td></tr><tr><td id="L609" class="nb">609</td><td>    #</td></tr><tr><td id="L610" class="nb">610</td><td>    # This method can be passed attribute names and an optional time argument.</td></tr><tr><td id="L611" class="nb">611</td><td>    # If attribute names are passed, they are updated along with updated_at/on</td></tr><tr><td id="L612" class="nb">612</td><td>    # attributes. If no time argument is passed, the current time is used as default.</td></tr><tr><td id="L613" class="nb">613</td><td>    #</td></tr><tr><td id="L614" class="nb">614</td><td>    #   product.touch                         # updates updated_at/on with current time</td></tr><tr><td id="L615" class="nb">615</td><td>    #   product.touch(time: Time.new(2015, 2, 16, 0, 0, 0)) # updates updated_at/on with specified time</td></tr><tr><td id="L616" class="nb">616</td><td>    #   product.touch(:designed_at)           # updates the designed_at attribute and updated_at/on</td></tr><tr><td id="L617" class="nb">617</td><td>    #   product.touch(:started_at, :ended_at) # updates started_at, ended_at and updated_at/on attributes</td></tr><tr><td id="L618" class="nb">618</td><td>    #</td></tr><tr><td id="L619" class="nb">619</td><td>    # If used along with {belongs_to}[rdoc-ref:Associations::ClassMethods#belongs_to]</td></tr><tr><td id="L620" class="nb">620</td><td>    # then +touch+ will invoke +touch+ method on associated object.</td></tr><tr><td id="L621" class="nb">621</td><td>    #</td></tr><tr><td id="L622" class="nb">622</td><td>    #   class Brake &lt; ActiveRecord::Base</td></tr><tr><td id="L623" class="nb">623</td><td>    #     belongs_to :car, touch: true</td></tr><tr><td id="L624" class="nb">624</td><td>    #   end</td></tr><tr><td id="L625" class="nb">625</td><td>    #</td></tr><tr><td id="L626" class="nb">626</td><td>    #   class Car &lt; ActiveRecord::Base</td></tr><tr><td id="L627" class="nb">627</td><td>    #     belongs_to :corporation, touch: true</td></tr><tr><td id="L628" class="nb">628</td><td>    #   end</td></tr><tr><td id="L629" class="nb">629</td><td>    #</td></tr><tr><td id="L630" class="nb">630</td><td>    #   # triggers @brake.car.touch and @brake.car.corporation.touch</td></tr><tr><td id="L631" class="nb">631</td><td>    #   @brake.touch</td></tr><tr><td id="L632" class="nb">632</td><td>    #</td></tr><tr><td id="L633" class="nb">633</td><td>    # Note that +touch+ must be used on a persisted object, or else an</td></tr><tr><td id="L634" class="nb">634</td><td>    # ActiveRecordError will be thrown. For example:</td></tr><tr><td id="L635" class="nb">635</td><td>    #</td></tr><tr><td id="L636" class="nb">636</td><td>    #   ball = Ball.new</td></tr><tr><td id="L637" class="nb">637</td><td>    #   ball.touch(:updated_at)   # =&gt; raises ActiveRecordError</td></tr><tr><td id="L638" class="nb">638</td><td>    #</td></tr><tr><td id="L639" class="nb">639</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">touch</span>(*names, time: <span class="node-nil kind-expression not-run" title="never run">nil</span>)</td></tr><tr><td id="L640" class="nb">640</td><td>      <span class="fork fork-whole fork-run " data-fork-id="27"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="997x"></i><span class="node-if kind-keyword run" title="997x">unless</span> <span class="node-send kind-selector_begin run" title="997x">persisted?</span></span></td></tr><tr><td id="L641" class="nb">641</td><td>        <span class="fork fork-branch fork-run " data-fork-id="27"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="7x"></i><span class="node-send kind-selector_begin run" title="7x">raise</span> <span class="node-const kind-name run" title="7x">ActiveRecordError</span>, <span class="node-dstr kind-expression run" title="7x">&lt;&lt;-MSG</span><span class="node-send kind-dot run" title="7x">.</span><span class="node-send kind-selector_begin run" title="7x">squish</span></span></td></tr><tr><td id="L642" class="nb">642</td><td><span class="node-str kind-expression run" title="7x">          cannot touch on a new or destroyed record object. Consider using</span></td></tr><tr><td id="L643" class="nb">643</td><td><span class="node-str kind-expression run" title="7x">          persisted?, new_record?, or destroyed? before touching</span></td></tr><tr><td id="L644" class="nb">644</td><td><span class="node-dstr kind-heredoc_end run" title="7x">        MSG</span></td></tr><tr><td id="L645" class="nb">645</td><td>      end</td></tr><tr><td id="L646" class="nb">646</td><td></td></tr><tr><td id="L647" class="nb">647</td><td>      <span class="node-lvasgn kind-name run" title="990x">time</span> <span class="node-or_asgn kind-operator run" title="990x">||=</span> <span class="node-send kind-selector_begin run" title="223x">current_time_from_proper_timezone</span></td></tr><tr><td id="L648" class="nb">648</td><td>      <span class="node-lvasgn kind-name run" title="990x">attributes</span> <span class="node-lvasgn kind-operator run" title="990x">=</span> <span class="node-send kind-selector_begin run" title="990x">timestamp_attributes_for_update_in_model</span></td></tr><tr><td id="L649" class="nb">649</td><td>      <span class="node-lvar kind-name run" title="990x">attributes</span><span class="node-send kind-dot run" title="990x">.</span><span class="node-send kind-selector_begin run" title="990x">concat</span>(<span class="node-lvar kind-name run" title="990x">names</span>)</td></tr><tr><td id="L650" class="nb">650</td><td></td></tr><tr><td id="L651" class="nb">651</td><td>      <span class="fork fork-whole fork-run " data-fork-id="28"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="990x"></i><span class="node-if kind-keyword run" title="990x">unless</span> <span class="node-lvar kind-name run" title="990x">attributes</span><span class="node-send kind-dot run" title="990x">.</span><span class="node-send kind-selector_begin run" title="990x">empty?</span></span></td></tr><tr><td id="L652" class="nb">652</td><td>        <span class="fork fork-branch fork-run " data-fork-id="28"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="922x"></i><span class="node-lvasgn kind-name run" title="922x">changes</span> <span class="node-lvasgn kind-operator run" title="922x">=</span> <span class="node-hash kind-begin run" title="922x">{</span><span class="node-hash kind-end run" title="922x">}</span></span></td></tr><tr><td id="L653" class="nb">653</td><td></td></tr><tr><td id="L654" class="nb">654</td><td>        <span class="node-lvar kind-name run" title="922x">attributes</span><span class="node-send kind-dot run" title="922x">.</span><span class="node-send kind-selector_begin run" title="922x">each</span> do |column|</td></tr><tr><td id="L655" class="nb">655</td><td>          <span class="node-lvasgn kind-name run" title="1797x">column</span> <span class="node-lvasgn kind-operator run" title="1797x">=</span> <span class="node-lvar kind-name run" title="1797x">column</span><span class="node-send kind-dot run" title="1797x">.</span><span class="node-send kind-selector_begin run" title="1797x">to_s</span></td></tr><tr><td id="L656" class="nb">656</td><td>          <span class="node-lvar kind-name run" title="1797x">changes</span><span class="node-send kind-selector_begin run" title="1797x">[</span><span class="node-lvar kind-name run" title="1797x">column</span><span class="node-send kind-selector_end run" title="1797x">]</span> <span class="node-send kind-operator run" title="1797x">=</span> <span class="node-send kind-selector_begin run" title="1797x">write_attribute</span>(<span class="node-lvar kind-name run" title="1797x">column</span>, <span class="node-lvar kind-name run" title="1797x">time</span>)</td></tr><tr><td id="L657" class="nb">657</td><td>        end</td></tr><tr><td id="L658" class="nb">658</td><td></td></tr><tr><td id="L659" class="nb">659</td><td>        <span class="node-lvasgn kind-name run" title="922x">scope</span> <span class="node-lvasgn kind-operator run" title="922x">=</span> <span class="node-send kind-selector_begin run" title="922x">_relation_for_itself</span></td></tr><tr><td id="L660" class="nb">660</td><td></td></tr><tr><td id="L661" class="nb">661</td><td>        <span class="fork fork-whole fork-run " data-fork-id="29"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="922x"></i><span class="node-if kind-keyword run" title="922x">if</span> <span class="node-send kind-selector_begin run" title="922x">locking_enabled?</span></span></td></tr><tr><td id="L662" class="nb">662</td><td>          <span class="fork fork-branch fork-run " data-fork-id="29"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="410x"></i><span class="node-lvasgn kind-name run" title="410x">locking_column</span> <span class="node-lvasgn kind-operator run" title="410x">=</span> <span class="node-self kind-expression run" title="410x">self</span><span class="node-send kind-dot run" title="410x">.</span><span class="node-send kind-selector_begin run" title="410x">class</span><span class="node-send kind-dot run" title="410x">.</span><span class="node-send kind-selector_begin run" title="410x">locking_column</span></span></td></tr><tr><td id="L663" class="nb">663</td><td>          <span class="node-lvasgn kind-name run" title="410x">scope</span> <span class="node-lvasgn kind-operator run" title="410x">=</span> <span class="node-lvar kind-name run" title="410x">scope</span><span class="node-send kind-dot run" title="410x">.</span><span class="node-send kind-selector_begin run" title="410x">where</span>(<span class="node-lvar kind-name run" title="410x">locking_column</span> <span class="node-pair kind-operator run" title="410x">=&gt;</span> <span class="node-send kind-selector_begin run" title="410x">read_attribute_before_type_cast</span>(<span class="node-lvar kind-name run" title="410x">locking_column</span>))</td></tr><tr><td id="L664" class="nb">664</td><td>          <span class="node-lvar kind-name run" title="410x">changes</span><span class="node-send kind-selector_begin run" title="410x">[</span><span class="node-lvar kind-name run" title="410x">locking_column</span><span class="node-send kind-selector_end run" title="410x">]</span> <span class="node-send kind-operator run" title="410x">=</span> <span class="node-send kind-selector_begin run" title="410x">increment_lock</span></td></tr><tr><td id="L665" class="nb">665</td><td>        end</td></tr><tr><td id="L666" class="nb">666</td><td></td></tr><tr><td id="L667" class="nb">667</td><td>        <span class="node-send kind-selector_begin run" title="922x">clear_attribute_changes</span>(<span class="node-lvar kind-name run" title="922x">changes</span><span class="node-send kind-dot run" title="922x">.</span><span class="node-send kind-selector_begin run" title="922x">keys</span>)</td></tr><tr><td id="L668" class="nb">668</td><td>        <span class="node-lvasgn kind-name run" title="922x">result</span> <span class="node-lvasgn kind-operator run" title="922x">=</span> <span class="node-lvar kind-name run" title="922x">scope</span><span class="node-send kind-dot run" title="922x">.</span><span class="node-send kind-selector_begin run" title="922x">update_all</span>(<span class="node-lvar kind-name run" title="922x">changes</span>) <span class="node-send kind-selector_begin run" title="922x">==</span> <span class="node-int kind-expression run" title="922x">1</span></td></tr><tr><td id="L669" class="nb">669</td><td></td></tr><tr><td id="L670" class="nb">670</td><td>        <span class="fork fork-whole fork-run " data-fork-id="30"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="922x"></i><span class="node-if kind-keyword run" title="922x">if</span> <span class="fork fork-whole fork-run " data-fork-id="31"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="922x"></i><span class="node-send kind-selector_begin run" title="922x">!</span><span class="node-lvar kind-name run" title="922x">result</span> <span class="node-and kind-operator run" title="922x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="31"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="8x"></i><span class="node-send kind-selector_begin run" title="8x">locking_enabled?</span></span></span></span></td></tr><tr><td id="L671" class="nb">671</td><td>          <span class="fork fork-branch fork-run " data-fork-id="30"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="8x"></i><span class="node-send kind-selector_begin run" title="8x">raise</span> <span class="node-const kind-name run" title="8x">ActiveRecord</span><span class="node-const kind-double_colon run" title="8x">::</span><span class="node-const kind-name run" title="8x">StaleObjectError</span><span class="node-send kind-dot run" title="8x">.</span><span class="node-send kind-selector_begin run" title="8x">new</span>(<span class="node-self kind-expression run" title="8x">self</span>, <span class="node-str kind-expression run" title="8x">"touch"</span>)</span></td></tr><tr><td id="L672" class="nb">672</td><td>        end</td></tr><tr><td id="L673" class="nb">673</td><td></td></tr><tr><td id="L674" class="nb">674</td><td>        <span class="node-ivasgn kind-name run" title="914x">@_trigger_update_callback</span> <span class="node-ivasgn kind-operator run" title="914x">=</span> <span class="node-lvar kind-name run" title="914x">result</span></td></tr><tr><td id="L675" class="nb">675</td><td>        <span class="node-lvar kind-name run" title="914x">result</span></td></tr><tr><td id="L676" class="nb">676</td><td>      <span class="node-true kind-else run" title="68x">else</span></td></tr><tr><td id="L677" class="nb">677</td><td>        <span class="fork fork-branch fork-run " data-fork-id="28"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="68x"></i><span class="node-true kind-expression run" title="68x">true</span></span></td></tr><tr><td id="L678" class="nb">678</td><td>      end</td></tr><tr><td id="L679" class="nb">679</td><td>    end</td></tr><tr><td id="L680" class="nb">680</td><td></td></tr><tr><td id="L681" class="nb">681</td><td>  <span class="node-send kind-selector_begin run" title="11x">private</span></td></tr><tr><td id="L682" class="nb">682</td><td></td></tr><tr><td id="L683" class="nb">683</td><td>    # A hook to be overridden by association modules.</td></tr><tr><td id="L684" class="nb">684</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroy_associations</span></td></tr><tr><td id="L685" class="nb">685</td><td>    end</td></tr><tr><td id="L686" class="nb">686</td><td></td></tr><tr><td id="L687" class="nb">687</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">destroy_row</span></td></tr><tr><td id="L688" class="nb">688</td><td>      <span class="node-send kind-selector_begin run" title="2284x">relation_for_destroy</span><span class="node-send kind-dot run" title="2284x">.</span><span class="node-send kind-selector_begin run" title="2284x">delete_all</span></td></tr><tr><td id="L689" class="nb">689</td><td>    end</td></tr><tr><td id="L690" class="nb">690</td><td></td></tr><tr><td id="L691" class="nb">691</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">relation_for_destroy</span></td></tr><tr><td id="L692" class="nb">692</td><td>      <span class="node-send kind-selector_begin run" title="2284x">_relation_for_itself</span></td></tr><tr><td id="L693" class="nb">693</td><td>    end</td></tr><tr><td id="L694" class="nb">694</td><td></td></tr><tr><td id="L695" class="nb">695</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_relation_for_itself</span></td></tr><tr><td id="L696" class="nb">696</td><td>      <span class="node-self kind-expression run" title="4534x">self</span><span class="node-send kind-dot run" title="4534x">.</span><span class="node-send kind-selector_begin run" title="4534x">class</span><span class="node-send kind-dot run" title="4534x">.</span><span class="node-send kind-selector_begin run" title="4534x">unscoped</span><span class="node-send kind-dot run" title="4534x">.</span><span class="node-send kind-selector_begin run" title="4534x">where</span>(<span class="node-self kind-expression run" title="4534x">self</span><span class="node-send kind-dot run" title="4534x">.</span><span class="node-send kind-selector_begin run" title="4534x">class</span><span class="node-send kind-dot run" title="4534x">.</span><span class="node-send kind-selector_begin run" title="4534x">primary_key</span> <span class="node-pair kind-operator run" title="4534x">=&gt;</span> <span class="node-send kind-selector_begin run" title="4534x">id</span>)</td></tr><tr><td id="L697" class="nb">697</td><td>    end</td></tr><tr><td id="L698" class="nb">698</td><td></td></tr><tr><td id="L699" class="nb">699</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">create_or_update</span>(*args, &amp;block)</td></tr><tr><td id="L700" class="nb">700</td><td>      <span class="fork fork-whole fork-run " data-fork-id="32"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="33581x"></i><span class="fork fork-branch fork-run " data-fork-id="32"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="131x"></i><span class="node-send kind-selector_begin run" title="131x">_raise_readonly_record_error</span></span> <span class="node-if kind-keyword run" title="33581x">if</span> <span class="node-send kind-selector_begin run" title="33581x">readonly?</span></span></td></tr><tr><td id="L701" class="nb">701</td><td>      <span class="node-lvasgn kind-name run" title="33095x">result</span> <span class="node-lvasgn kind-operator run" title="33095x">=</span> <span class="fork fork-whole fork-run " data-fork-id="33"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="33450x"></i><span class="node-send kind-selector_begin run" title="33450x">new_record?</span> <span class="node-if kind-question run" title="33450x">?</span> <span class="fork fork-branch fork-run " data-fork-id="33"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25906x"></i><span class="node-send kind-selector_begin run" title="25906x">_create_record</span>(<span class="node-block_pass kind-operator run" title="25906x">&amp;</span><span class="node-lvar kind-name run" title="25906x">block</span>)</span> <span class="node-send kind-colon run" title="7544x">:</span> <span class="fork fork-branch fork-run " data-fork-id="33"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="7544x"></i><span class="node-send kind-selector_begin run" title="7544x">_update_record</span>(<span class="node-splat kind-operator run" title="7544x">*</span><span class="node-lvar kind-name run" title="7544x">args</span>, <span class="node-block_pass kind-operator run" title="7544x">&amp;</span><span class="node-lvar kind-name run" title="7544x">block</span>)</span></span></td></tr><tr><td id="L702" class="nb">702</td><td>      <span class="node-lvar kind-name run" title="33095x">result</span> <span class="node-send kind-selector_begin run" title="33095x">!=</span> <span class="node-false kind-expression run" title="33095x">false</span></td></tr><tr><td id="L703" class="nb">703</td><td>    end</td></tr><tr><td id="L704" class="nb">704</td><td></td></tr><tr><td id="L705" class="nb">705</td><td>    # Updates the associated record with values matching those of the instance attributes.</td></tr><tr><td id="L706" class="nb">706</td><td>    # Returns the number of affected rows.</td></tr><tr><td id="L707" class="nb">707</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_update_record</span>(attribute_names = <span class="node-self kind-expression not-run" title="never run">self</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">attribute_names</span>)</td></tr><tr><td id="L708" class="nb">708</td><td>      <span class="node-lvasgn kind-name run" title="7290x">attributes_values</span> <span class="node-lvasgn kind-operator run" title="7290x">=</span> <span class="node-send kind-selector_begin run" title="7290x">arel_attributes_with_values_for_update</span>(<span class="node-lvar kind-name run" title="7290x">attribute_names</span>)</td></tr><tr><td id="L709" class="nb">709</td><td>      <span class="fork fork-whole fork-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="7290x"></i><span class="node-if kind-keyword run" title="7290x">if</span> <span class="node-lvar kind-name run" title="7290x">attributes_values</span><span class="node-send kind-dot run" title="7290x">.</span><span class="node-send kind-selector_begin run" title="7290x">empty?</span></span></td></tr><tr><td id="L710" class="nb">710</td><td>        <span class="fork fork-branch fork-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3393x"></i><span class="node-lvasgn kind-name run" title="3393x">rows_affected</span> <span class="node-lvasgn kind-operator run" title="3393x">=</span> <span class="node-int kind-expression run" title="3393x">0</span></span></td></tr><tr><td id="L711" class="nb">711</td><td>        <span class="node-ivasgn kind-name run" title="3393x">@_trigger_update_callback</span> <span class="node-ivasgn kind-operator run" title="3393x">=</span> <span class="node-true kind-expression run" title="3393x">true</span></td></tr><tr><td id="L712" class="nb">712</td><td>      <span class="node-begin kind-else run" title="3897x">else</span></td></tr><tr><td id="L713" class="nb">713</td><td>        <span class="fork fork-branch fork-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3897x"></i><span class="node-lvasgn kind-name run" title="3882x">rows_affected</span> <span class="node-lvasgn kind-operator run" title="3882x">=</span> <span class="node-self kind-expression run" title="3897x">self</span><span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">class</span><span class="node-send kind-dot run" title="3897x">.</span><span class="node-send kind-selector_begin run" title="3897x">_update_record</span>(<span class="node-lvar kind-name run" title="3897x">attributes_values</span>, <span class="node-send kind-selector_begin run" title="3897x">id</span>, <span class="node-send kind-selector_begin run" title="3897x">id_in_database</span>)</span></td></tr><tr><td id="L714" class="nb">714</td><td>        <span class="node-ivasgn kind-name run" title="3882x">@_trigger_update_callback</span> <span class="node-ivasgn kind-operator run" title="3882x">=</span> <span class="node-lvar kind-name run" title="3882x">rows_affected</span> <span class="node-send kind-selector_begin run" title="3882x">&gt;</span> <span class="node-int kind-expression run" title="3882x">0</span></td></tr><tr><td id="L715" class="nb">715</td><td>      end</td></tr><tr><td id="L716" class="nb">716</td><td></td></tr><tr><td id="L717" class="nb">717</td><td>      <span class="fork fork-whole fork-run " data-fork-id="35"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="7275x"></i><span class="fork fork-branch fork-run " data-fork-id="35"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="170x"></i><span class="node-yield kind-keyword run" title="170x">yield</span><span class="node-yield kind-begin run" title="170x">(</span><span class="node-self kind-expression run" title="170x">self</span><span class="node-yield kind-end run" title="170x">)</span></span> <span class="node-if kind-keyword run" title="7275x">if</span> <span class="node-send kind-selector_begin run" title="7275x">block_given?</span></span></td></tr><tr><td id="L718" class="nb">718</td><td></td></tr><tr><td id="L719" class="nb">719</td><td>      <span class="node-lvar kind-name run" title="7275x">rows_affected</span></td></tr><tr><td id="L720" class="nb">720</td><td>    end</td></tr><tr><td id="L721" class="nb">721</td><td></td></tr><tr><td id="L722" class="nb">722</td><td>    # Creates a record with values matching those of the instance attributes</td></tr><tr><td id="L723" class="nb">723</td><td>    # and returns its id.</td></tr><tr><td id="L724" class="nb">724</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_create_record</span>(attribute_names = <span class="node-self kind-expression not-run" title="never run">self</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">attribute_names</span>)</td></tr><tr><td id="L725" class="nb">725</td><td>      <span class="node-lvasgn kind-name run" title="25862x">attributes_values</span> <span class="node-lvasgn kind-operator run" title="25862x">=</span> <span class="node-send kind-selector_begin run" title="25862x">arel_attributes_with_values_for_create</span>(<span class="node-lvar kind-name run" title="25862x">attribute_names</span>)</td></tr><tr><td id="L726" class="nb">726</td><td></td></tr><tr><td id="L727" class="nb">727</td><td>      <span class="node-lvasgn kind-name run" title="25796x">new_id</span> <span class="node-lvasgn kind-operator run" title="25796x">=</span> <span class="node-self kind-expression run" title="25862x">self</span><span class="node-send kind-dot run" title="25862x">.</span><span class="node-send kind-selector_begin run" title="25862x">class</span><span class="node-send kind-dot run" title="25862x">.</span><span class="node-send kind-selector_begin run" title="25862x">_insert_record</span>(<span class="node-lvar kind-name run" title="25862x">attributes_values</span>)</td></tr><tr><td id="L728" class="nb">728</td><td>      <span class="fork fork-whole fork-run " data-fork-id="36"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25796x"></i><span class="fork fork-branch fork-run " data-fork-id="36"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="23911x"></i><span class="node-self kind-expression run" title="23911x">self</span><span class="node-send kind-dot run" title="23911x">.</span><span class="node-send kind-selector_begin run" title="23911x">id</span> <span class="node-or_asgn kind-operator run" title="23911x">||=</span> <span class="node-lvar kind-name run" title="23274x">new_id</span></span> <span class="node-if kind-keyword run" title="25796x">if</span> <span class="node-self kind-expression run" title="25796x">self</span><span class="node-send kind-dot run" title="25796x">.</span><span class="node-send kind-selector_begin run" title="25796x">class</span><span class="node-send kind-dot run" title="25796x">.</span><span class="node-send kind-selector_begin run" title="25796x">primary_key</span></span></td></tr><tr><td id="L729" class="nb">729</td><td></td></tr><tr><td id="L730" class="nb">730</td><td>      <span class="node-ivasgn kind-name run" title="25796x">@new_record</span> <span class="node-ivasgn kind-operator run" title="25796x">=</span> <span class="node-false kind-expression run" title="25796x">false</span></td></tr><tr><td id="L731" class="nb">731</td><td></td></tr><tr><td id="L732" class="nb">732</td><td>      <span class="fork fork-whole fork-run " data-fork-id="37"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="25796x"></i><span class="fork fork-branch fork-run " data-fork-id="37"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4081x"></i><span class="node-yield kind-keyword run" title="4081x">yield</span><span class="node-yield kind-begin run" title="4081x">(</span><span class="node-self kind-expression run" title="4081x">self</span><span class="node-yield kind-end run" title="4081x">)</span></span> <span class="node-if kind-keyword run" title="25796x">if</span> <span class="node-send kind-selector_begin run" title="25796x">block_given?</span></span></td></tr><tr><td id="L733" class="nb">733</td><td></td></tr><tr><td id="L734" class="nb">734</td><td>      <span class="node-send kind-selector_begin run" title="25796x">id</span></td></tr><tr><td id="L735" class="nb">735</td><td>    end</td></tr><tr><td id="L736" class="nb">736</td><td></td></tr><tr><td id="L737" class="nb">737</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">verify_readonly_attribute</span>(name)</td></tr><tr><td id="L738" class="nb">738</td><td>      <span class="fork fork-whole fork-run " data-fork-id="38"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="853x"></i><span class="fork fork-branch fork-run " data-fork-id="38"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="27x"></i><span class="node-send kind-selector_begin run" title="27x">raise</span> <span class="node-const kind-name run" title="27x">ActiveRecordError</span>, <span class="node-dstr kind-begin run" title="27x">"</span><span class="node-begin kind-begin run" title="27x">#{</span><span class="node-lvar kind-name run" title="27x">name</span><span class="node-begin kind-end run" title="27x">}</span><span class="node-str kind-expression run" title="27x"> is marked as readonly</span><span class="node-dstr kind-end run" title="27x">"</span></span> <span class="node-if kind-keyword run" title="853x">if</span> <span class="node-self kind-expression run" title="853x">self</span><span class="node-send kind-dot run" title="853x">.</span><span class="node-send kind-selector_begin run" title="853x">class</span><span class="node-send kind-dot run" title="853x">.</span><span class="node-send kind-selector_begin run" title="853x">readonly_attributes</span><span class="node-send kind-dot run" title="853x">.</span><span class="node-send kind-selector_begin run" title="853x">include?</span>(<span class="node-lvar kind-name run" title="853x">name</span>)</span></td></tr><tr><td id="L739" class="nb">739</td><td>    end</td></tr><tr><td id="L740" class="nb">740</td><td></td></tr><tr><td id="L741" class="nb">741</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_raise_record_not_destroyed</span></td></tr><tr><td id="L742" class="nb">742</td><td>      <span class="node-ivasgn kind-name run" title="54x">@_association_destroy_exception</span> <span class="node-or_asgn kind-operator run" title="54x">||=</span> <span class="node-nil kind-expression run" title="45x">nil</span></td></tr><tr><td id="L743" class="nb">743</td><td>      <span class="node-send kind-selector_begin run" title="54x">raise</span> <span class="fork fork-whole fork-run " data-fork-id="39"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="54x"></i><span class="node-ivar kind-name run" title="54x">@_association_destroy_exception</span> <span class="node-or kind-operator run" title="54x">||</span> <span class="fork fork-branch fork-run " data-fork-id="39"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="45x"></i><span class="node-const kind-name run" title="45x">RecordNotDestroyed</span><span class="node-send kind-dot run" title="45x">.</span><span class="node-send kind-selector_begin run" title="45x">new</span>(<span class="node-str kind-expression run" title="45x">"Failed to destroy the record"</span>, <span class="node-self kind-expression run" title="45x">self</span>)</span></span></td></tr><tr><td id="L744" class="nb">744</td><td>    <span class="node-ensure kind-keyword run" title="54x">ensure</span></td></tr><tr><td id="L745" class="nb">745</td><td>      <span class="node-ivasgn kind-name run" title="54x">@_association_destroy_exception</span> <span class="node-ivasgn kind-operator run" title="54x">=</span> <span class="node-nil kind-expression run" title="54x">nil</span></td></tr><tr><td id="L746" class="nb">746</td><td>    end</td></tr><tr><td id="L747" class="nb">747</td><td></td></tr><tr><td id="L748" class="nb">748</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">belongs_to_touch_method</span></td></tr><tr><td id="L749" class="nb">749</td><td>      <span class="node-sym kind-expression not-run" title="never run">:touch</span></td></tr><tr><td id="L750" class="nb">750</td><td>    end</td></tr><tr><td id="L751" class="nb">751</td><td></td></tr><tr><td id="L752" class="nb">752</td><td>    <span class="node-def kind-keyword run" title="11x">def</span> <span class="node-def kind-name run" title="11x">_raise_readonly_record_error</span></td></tr><tr><td id="L753" class="nb">753</td><td>      <span class="node-send kind-selector_begin run" title="137x">raise</span> <span class="node-const kind-name run" title="137x">ReadOnlyRecord</span>, <span class="node-dstr kind-begin run" title="137x">"</span><span class="node-begin kind-begin run" title="137x">#{</span><span class="node-self kind-expression run" title="137x">self</span><span class="node-send kind-dot run" title="137x">.</span><span class="node-send kind-selector_begin run" title="137x">class</span><span class="node-begin kind-end run" title="137x">}</span><span class="node-str kind-expression run" title="137x"> is marked as readonly</span><span class="node-dstr kind-end run" title="137x">"</span></td></tr><tr><td id="L754" class="nb">754</td><td>    end</td></tr><tr><td id="L755" class="nb">755</td><td>  end</td></tr><tr><td id="L756" class="nb">756</td><td>end</td></tr></table></main>
    <script>
      $(function() {
        $('.stats .branch').click(function() {
          $('body').toggleClass('show-forks')
        });
      });
    </script>
  </body>
</html>
