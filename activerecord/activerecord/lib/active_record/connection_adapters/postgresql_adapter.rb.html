<!DOCTYPE html>
<html>
  <head>
    <base href="../../../.."/>
    <script src="assets/jquery-3.2.1.min.js"></script>
    <script src="https://use.fontawesome.com/81e98abb93.js"></script>
    <link rel="stylesheet" href="assets/deep_cover.css" type="text/css"/>
  </head>
  <body class="source">
    <div class="overlay">
      <div class="center">
        <div class="stats"><table><tr><th class="node">Nodes</th><th class="per_char">Chars</th><th class="branch">Branches</th></tr><tr><td class="node"><span class="executed" title="executed">1906</span>  / <span class="potentially_executable" title="potentially_executable">1964</span></td><td class="per_char"><span class="executed" title="executed">15754</span>  / <span class="potentially_executable" title="potentially_executable">16441</span></td><td class="branch"><span class="executed" title="executed">23</span>  / <span class="potentially_executable" title="potentially_executable">41</span></td></tr></table></div>
      </div>
    </div>
    <header>
      <div class="content">
        <div class="info"><span class="deep-cover"><span class="deep">Deep</span>Cover</span>
          <span class="version">v0.1.16</span>
        </div>
        <div class="nav">
          <a href="index.html" aria-label="Home"><i class="fa fa-home" aria-hidden="true"></i></a>
          <span class="path">activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb<span>
        </div>
      </div>
    </header>
    <main class="source"><table class="source"><tr><td id="L1" class="nb">1</td><td># frozen_string_literal: true</td></tr><tr><td id="L2" class="nb">2</td><td></td></tr><tr><td id="L3" class="nb">3</td><td># Make sure we're using pg high enough for type casts and Ruby 2.2+ compatibility</td></tr><tr><td id="L4" class="nb">4</td><td><span class="node-send kind-selector_begin run" title="3x">gem</span> <span class="node-str kind-expression run" title="3x">"pg"</span>, <span class="node-str kind-expression run" title="3x">"~&gt; 0.18"</span></td></tr><tr><td id="L5" class="nb">5</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"pg"</span></td></tr><tr><td id="L6" class="nb">6</td><td></td></tr><tr><td id="L7" class="nb">7</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/abstract_adapter"</span></td></tr><tr><td id="L8" class="nb">8</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/statement_pool"</span></td></tr><tr><td id="L9" class="nb">9</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/column"</span></td></tr><tr><td id="L10" class="nb">10</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/database_statements"</span></td></tr><tr><td id="L11" class="nb">11</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/explain_pretty_printer"</span></td></tr><tr><td id="L12" class="nb">12</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/oid"</span></td></tr><tr><td id="L13" class="nb">13</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/quoting"</span></td></tr><tr><td id="L14" class="nb">14</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/referential_integrity"</span></td></tr><tr><td id="L15" class="nb">15</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/schema_creation"</span></td></tr><tr><td id="L16" class="nb">16</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/schema_definitions"</span></td></tr><tr><td id="L17" class="nb">17</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/schema_dumper"</span></td></tr><tr><td id="L18" class="nb">18</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/schema_statements"</span></td></tr><tr><td id="L19" class="nb">19</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/type_metadata"</span></td></tr><tr><td id="L20" class="nb">20</td><td><span class="node-send kind-selector_begin run" title="3x">require</span> <span class="node-str kind-expression run" title="3x">"active_record/connection_adapters/postgresql/utils"</span></td></tr><tr><td id="L21" class="nb">21</td><td></td></tr><tr><td id="L22" class="nb">22</td><td><span class="node-module kind-keyword run" title="3x">module</span> <span class="node-const kind-name run" title="3x">ActiveRecord</span></td></tr><tr><td id="L23" class="nb">23</td><td>  <span class="node-module kind-keyword run" title="3x">module</span> <span class="node-const kind-name run" title="3x">ConnectionHandling</span> # :nodoc:</td></tr><tr><td id="L24" class="nb">24</td><td>    # Establishes a connection to the database that's used by all Active Record objects</td></tr><tr><td id="L25" class="nb">25</td><td>    <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">postgresql_connection</span>(config)</td></tr><tr><td id="L26" class="nb">26</td><td>      <span class="node-lvasgn kind-name run" title="581x">conn_params</span> <span class="node-lvasgn kind-operator run" title="581x">=</span> <span class="node-lvar kind-name run" title="581x">config</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">symbolize_keys</span></td></tr><tr><td id="L27" class="nb">27</td><td></td></tr><tr><td id="L28" class="nb">28</td><td>      <span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">delete_if</span> { |_, v| <span class="node-lvar kind-name run" title="1814x">v</span><span class="node-send kind-dot run" title="1814x">.</span><span class="node-send kind-selector_begin run" title="1814x">nil?</span> }</td></tr><tr><td id="L29" class="nb">29</td><td></td></tr><tr><td id="L30" class="nb">30</td><td>      # Map ActiveRecords param names to PGs.</td></tr><tr><td id="L31" class="nb">31</td><td>      <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="0"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy branch not covered"></i><span class="fork fork-branch fork-not-run " data-fork-id="0"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-lvar kind-name not-run" title="never run">conn_params</span><span class="node-send kind-selector_begin not-run" title="never run">[</span><span class="node-sym kind-expression not-run" title="never run">:user</span><span class="node-send kind-selector_end not-run" title="never run">]</span> <span class="node-send kind-operator not-run" title="never run">=</span> <span class="node-lvar kind-name not-run" title="never run">conn_params</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">delete</span>(<span class="node-sym kind-expression not-run" title="never run">:username</span>)</span> <span class="node-if kind-keyword run" title="581x">if</span> <span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-selector_begin run" title="581x">[</span><span class="node-sym kind-expression run" title="581x">:username</span><span class="node-send kind-selector_end run" title="581x">]</span></span></td></tr><tr><td id="L32" class="nb">32</td><td>      <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="1"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="implicit falsy branch not covered"></i><span class="fork fork-branch fork-run " data-fork-id="1"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="581x"></i><span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-selector_begin run" title="581x">[</span><span class="node-sym kind-expression run" title="581x">:dbname</span><span class="node-send kind-selector_end run" title="581x">]</span> <span class="node-send kind-operator run" title="581x">=</span> <span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">delete</span>(<span class="node-sym kind-expression run" title="581x">:database</span>)</span> <span class="node-if kind-keyword run" title="581x">if</span> <span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-selector_begin run" title="581x">[</span><span class="node-sym kind-expression run" title="581x">:database</span><span class="node-send kind-selector_end run" title="581x">]</span></span></td></tr><tr><td id="L33" class="nb">33</td><td></td></tr><tr><td id="L34" class="nb">34</td><td>      # Forward only valid config params to PG::Connection.connect.</td></tr><tr><td id="L35" class="nb">35</td><td>      <span class="node-lvasgn kind-name run" title="581x">valid_conn_param_keys</span> <span class="node-lvasgn kind-operator run" title="581x">=</span> <span class="node-const kind-name run" title="581x">PG</span><span class="node-const kind-double_colon run" title="581x">::</span><span class="node-const kind-name run" title="581x">Connection</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">conndefaults_hash</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">keys</span> <span class="node-send kind-selector_begin run" title="581x">+</span> <span class="node-array kind-begin run" title="581x">[</span><span class="node-sym kind-expression run" title="581x">:requiressl</span><span class="node-array kind-end run" title="581x">]</span></td></tr><tr><td id="L36" class="nb">36</td><td>      <span class="node-lvar kind-name run" title="581x">conn_params</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">slice!</span>(<span class="node-splat kind-operator run" title="581x">*</span><span class="node-lvar kind-name run" title="581x">valid_conn_param_keys</span>)</td></tr><tr><td id="L37" class="nb">37</td><td></td></tr><tr><td id="L38" class="nb">38</td><td>      # The postgres drivers don't allow the creation of an unconnected PG::Connection object,</td></tr><tr><td id="L39" class="nb">39</td><td>      # so just pass a nil connection object for the time being.</td></tr><tr><td id="L40" class="nb">40</td><td>      <span class="node-const kind-name run" title="581x">ConnectionAdapters</span><span class="node-const kind-double_colon run" title="581x">::</span><span class="node-const kind-name run" title="581x">PostgreSQLAdapter</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">new</span>(<span class="node-nil kind-expression run" title="581x">nil</span>, <span class="node-send kind-selector_begin run" title="581x">logger</span>, <span class="node-lvar kind-name run" title="581x">conn_params</span>, <span class="node-lvar kind-name run" title="581x">config</span>)</td></tr><tr><td id="L41" class="nb">41</td><td>    end</td></tr><tr><td id="L42" class="nb">42</td><td>  end</td></tr><tr><td id="L43" class="nb">43</td><td></td></tr><tr><td id="L44" class="nb">44</td><td>  <span class="node-module kind-keyword run" title="3x">module</span> <span class="node-const kind-name run" title="3x">ConnectionAdapters</span></td></tr><tr><td id="L45" class="nb">45</td><td>    # The PostgreSQL adapter works with the native C (https://bitbucket.org/ged/ruby-pg) driver.</td></tr><tr><td id="L46" class="nb">46</td><td>    #</td></tr><tr><td id="L47" class="nb">47</td><td>    # Options:</td></tr><tr><td id="L48" class="nb">48</td><td>    #</td></tr><tr><td id="L49" class="nb">49</td><td>    # * &lt;tt&gt;:host&lt;/tt&gt; - Defaults to a Unix-domain socket in /tmp. On machines without Unix-domain sockets,</td></tr><tr><td id="L50" class="nb">50</td><td>    #   the default is to connect to localhost.</td></tr><tr><td id="L51" class="nb">51</td><td>    # * &lt;tt&gt;:port&lt;/tt&gt; - Defaults to 5432.</td></tr><tr><td id="L52" class="nb">52</td><td>    # * &lt;tt&gt;:username&lt;/tt&gt; - Defaults to be the same as the operating system name of the user running the application.</td></tr><tr><td id="L53" class="nb">53</td><td>    # * &lt;tt&gt;:password&lt;/tt&gt; - Password to be used if the server demands password authentication.</td></tr><tr><td id="L54" class="nb">54</td><td>    # * &lt;tt&gt;:database&lt;/tt&gt; - Defaults to be the same as the user name.</td></tr><tr><td id="L55" class="nb">55</td><td>    # * &lt;tt&gt;:schema_search_path&lt;/tt&gt; - An optional schema search path for the connection given</td></tr><tr><td id="L56" class="nb">56</td><td>    #   as a string of comma-separated schema names. This is backward-compatible with the &lt;tt&gt;:schema_order&lt;/tt&gt; option.</td></tr><tr><td id="L57" class="nb">57</td><td>    # * &lt;tt&gt;:encoding&lt;/tt&gt; - An optional client encoding that is used in a &lt;tt&gt;SET client_encoding TO</td></tr><tr><td id="L58" class="nb">58</td><td>    #   &lt;encoding&gt;&lt;/tt&gt; call on the connection.</td></tr><tr><td id="L59" class="nb">59</td><td>    # * &lt;tt&gt;:min_messages&lt;/tt&gt; - An optional client min messages that is used in a</td></tr><tr><td id="L60" class="nb">60</td><td>    #   &lt;tt&gt;SET client_min_messages TO &lt;min_messages&gt;&lt;/tt&gt; call on the connection.</td></tr><tr><td id="L61" class="nb">61</td><td>    # * &lt;tt&gt;:variables&lt;/tt&gt; - An optional hash of additional parameters that</td></tr><tr><td id="L62" class="nb">62</td><td>    #   will be used in &lt;tt&gt;SET SESSION key = val&lt;/tt&gt; calls on the connection.</td></tr><tr><td id="L63" class="nb">63</td><td>    # * &lt;tt&gt;:insert_returning&lt;/tt&gt; - An optional boolean to control the use of &lt;tt&gt;RETURNING&lt;/tt&gt; for &lt;tt&gt;INSERT&lt;/tt&gt; statements</td></tr><tr><td id="L64" class="nb">64</td><td>    #   defaults to true.</td></tr><tr><td id="L65" class="nb">65</td><td>    #</td></tr><tr><td id="L66" class="nb">66</td><td>    # Any further options are used as connection parameters to libpq. See</td></tr><tr><td id="L67" class="nb">67</td><td>    # https://www.postgresql.org/docs/current/static/libpq-connect.html for the</td></tr><tr><td id="L68" class="nb">68</td><td>    # list of parameters.</td></tr><tr><td id="L69" class="nb">69</td><td>    #</td></tr><tr><td id="L70" class="nb">70</td><td>    # In addition, default connection parameters of libpq can be set per environment variables.</td></tr><tr><td id="L71" class="nb">71</td><td>    # See https://www.postgresql.org/docs/current/static/libpq-envars.html .</td></tr><tr><td id="L72" class="nb">72</td><td>    <span class="node-class kind-keyword run" title="3x">class</span> <span class="node-const kind-name run" title="3x">PostgreSQLAdapter</span> &lt; <span class="node-const kind-name run" title="3x">AbstractAdapter</span></td></tr><tr><td id="L73" class="nb">73</td><td>      <span class="node-casgn kind-name run" title="3x">ADAPTER_NAME</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"PostgreSQL"</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">freeze</span></td></tr><tr><td id="L74" class="nb">74</td><td></td></tr><tr><td id="L75" class="nb">75</td><td>      <span class="node-casgn kind-name run" title="3x">NATIVE_DATABASE_TYPES</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-hash kind-begin run" title="3x">{</span></td></tr><tr><td id="L76" class="nb">76</td><td>        <span class="node-sym kind-expression run" title="3x">primary_key</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"bigserial primary key"</span>,</td></tr><tr><td id="L77" class="nb">77</td><td>        <span class="node-sym kind-expression run" title="3x">string</span><span class="node-pair kind-operator run" title="3x">:</span>      <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"character varying"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L78" class="nb">78</td><td>        <span class="node-sym kind-expression run" title="3x">text</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"text"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L79" class="nb">79</td><td>        <span class="node-sym kind-expression run" title="3x">integer</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"integer"</span>, <span class="node-sym kind-expression run" title="3x">limit</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-int kind-expression run" title="3x">4</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L80" class="nb">80</td><td>        <span class="node-sym kind-expression run" title="3x">float</span><span class="node-pair kind-operator run" title="3x">:</span>       <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"float"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L81" class="nb">81</td><td>        <span class="node-sym kind-expression run" title="3x">decimal</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"decimal"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L82" class="nb">82</td><td>        <span class="node-sym kind-expression run" title="3x">datetime</span><span class="node-pair kind-operator run" title="3x">:</span>    <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"timestamp"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L83" class="nb">83</td><td>        <span class="node-sym kind-expression run" title="3x">time</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"time"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L84" class="nb">84</td><td>        <span class="node-sym kind-expression run" title="3x">date</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"date"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L85" class="nb">85</td><td>        <span class="node-sym kind-expression run" title="3x">daterange</span><span class="node-pair kind-operator run" title="3x">:</span>   <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"daterange"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L86" class="nb">86</td><td>        <span class="node-sym kind-expression run" title="3x">numrange</span><span class="node-pair kind-operator run" title="3x">:</span>    <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"numrange"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L87" class="nb">87</td><td>        <span class="node-sym kind-expression run" title="3x">tsrange</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"tsrange"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L88" class="nb">88</td><td>        <span class="node-sym kind-expression run" title="3x">tstzrange</span><span class="node-pair kind-operator run" title="3x">:</span>   <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"tstzrange"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L89" class="nb">89</td><td>        <span class="node-sym kind-expression run" title="3x">int4range</span><span class="node-pair kind-operator run" title="3x">:</span>   <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"int4range"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L90" class="nb">90</td><td>        <span class="node-sym kind-expression run" title="3x">int8range</span><span class="node-pair kind-operator run" title="3x">:</span>   <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"int8range"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L91" class="nb">91</td><td>        <span class="node-sym kind-expression run" title="3x">binary</span><span class="node-pair kind-operator run" title="3x">:</span>      <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"bytea"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L92" class="nb">92</td><td>        <span class="node-sym kind-expression run" title="3x">boolean</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"boolean"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L93" class="nb">93</td><td>        <span class="node-sym kind-expression run" title="3x">xml</span><span class="node-pair kind-operator run" title="3x">:</span>         <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"xml"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L94" class="nb">94</td><td>        <span class="node-sym kind-expression run" title="3x">tsvector</span><span class="node-pair kind-operator run" title="3x">:</span>    <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"tsvector"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L95" class="nb">95</td><td>        <span class="node-sym kind-expression run" title="3x">hstore</span><span class="node-pair kind-operator run" title="3x">:</span>      <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"hstore"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L96" class="nb">96</td><td>        <span class="node-sym kind-expression run" title="3x">inet</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"inet"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L97" class="nb">97</td><td>        <span class="node-sym kind-expression run" title="3x">cidr</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"cidr"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L98" class="nb">98</td><td>        <span class="node-sym kind-expression run" title="3x">macaddr</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"macaddr"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L99" class="nb">99</td><td>        <span class="node-sym kind-expression run" title="3x">uuid</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"uuid"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L100" class="nb">100</td><td>        <span class="node-sym kind-expression run" title="3x">json</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"json"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L101" class="nb">101</td><td>        <span class="node-sym kind-expression run" title="3x">jsonb</span><span class="node-pair kind-operator run" title="3x">:</span>       <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"jsonb"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L102" class="nb">102</td><td>        <span class="node-sym kind-expression run" title="3x">ltree</span><span class="node-pair kind-operator run" title="3x">:</span>       <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"ltree"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L103" class="nb">103</td><td>        <span class="node-sym kind-expression run" title="3x">citext</span><span class="node-pair kind-operator run" title="3x">:</span>      <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"citext"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L104" class="nb">104</td><td>        <span class="node-sym kind-expression run" title="3x">point</span><span class="node-pair kind-operator run" title="3x">:</span>       <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"point"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L105" class="nb">105</td><td>        <span class="node-sym kind-expression run" title="3x">line</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"line"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L106" class="nb">106</td><td>        <span class="node-sym kind-expression run" title="3x">lseg</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"lseg"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L107" class="nb">107</td><td>        <span class="node-sym kind-expression run" title="3x">box</span><span class="node-pair kind-operator run" title="3x">:</span>         <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"box"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L108" class="nb">108</td><td>        <span class="node-sym kind-expression run" title="3x">path</span><span class="node-pair kind-operator run" title="3x">:</span>        <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"path"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L109" class="nb">109</td><td>        <span class="node-sym kind-expression run" title="3x">polygon</span><span class="node-pair kind-operator run" title="3x">:</span>     <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"polygon"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L110" class="nb">110</td><td>        <span class="node-sym kind-expression run" title="3x">circle</span><span class="node-pair kind-operator run" title="3x">:</span>      <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"circle"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L111" class="nb">111</td><td>        <span class="node-sym kind-expression run" title="3x">bit</span><span class="node-pair kind-operator run" title="3x">:</span>         <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"bit"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L112" class="nb">112</td><td>        <span class="node-sym kind-expression run" title="3x">bit_varying</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"bit varying"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L113" class="nb">113</td><td>        <span class="node-sym kind-expression run" title="3x">money</span><span class="node-pair kind-operator run" title="3x">:</span>       <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"money"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L114" class="nb">114</td><td>        <span class="node-sym kind-expression run" title="3x">interval</span><span class="node-pair kind-operator run" title="3x">:</span>    <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"interval"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L115" class="nb">115</td><td>        <span class="node-sym kind-expression run" title="3x">oid</span><span class="node-pair kind-operator run" title="3x">:</span>         <span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">name</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-str kind-expression run" title="3x">"oid"</span> <span class="node-hash kind-end run" title="3x">}</span>,</td></tr><tr><td id="L116" class="nb">116</td><td>      <span class="node-hash kind-end run" title="3x">}</span></td></tr><tr><td id="L117" class="nb">117</td><td></td></tr><tr><td id="L118" class="nb">118</td><td>      <span class="node-casgn kind-name run" title="3x">OID</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-const kind-name run" title="3x">PostgreSQL</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">OID</span> #:nodoc:</td></tr><tr><td id="L119" class="nb">119</td><td></td></tr><tr><td id="L120" class="nb">120</td><td>      <span class="node-send kind-selector_begin run" title="3x">include</span> <span class="node-const kind-name run" title="3x">PostgreSQL</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Quoting</span></td></tr><tr><td id="L121" class="nb">121</td><td>      <span class="node-send kind-selector_begin run" title="3x">include</span> <span class="node-const kind-name run" title="3x">PostgreSQL</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">ReferentialIntegrity</span></td></tr><tr><td id="L122" class="nb">122</td><td>      <span class="node-send kind-selector_begin run" title="3x">include</span> <span class="node-const kind-name run" title="3x">PostgreSQL</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">SchemaStatements</span></td></tr><tr><td id="L123" class="nb">123</td><td>      <span class="node-send kind-selector_begin run" title="3x">include</span> <span class="node-const kind-name run" title="3x">PostgreSQL</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">DatabaseStatements</span></td></tr><tr><td id="L124" class="nb">124</td><td></td></tr><tr><td id="L125" class="nb">125</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_index_sort_order?</span></td></tr><tr><td id="L126" class="nb">126</td><td>        <span class="node-true kind-expression run" title="668x">true</span></td></tr><tr><td id="L127" class="nb">127</td><td>      end</td></tr><tr><td id="L128" class="nb">128</td><td></td></tr><tr><td id="L129" class="nb">129</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_partial_index?</span></td></tr><tr><td id="L130" class="nb">130</td><td>        <span class="node-true kind-expression run" title="682x">true</span></td></tr><tr><td id="L131" class="nb">131</td><td>      end</td></tr><tr><td id="L132" class="nb">132</td><td></td></tr><tr><td id="L133" class="nb">133</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_expression_index?</span></td></tr><tr><td id="L134" class="nb">134</td><td>        <span class="node-true kind-expression run" title="4x">true</span></td></tr><tr><td id="L135" class="nb">135</td><td>      end</td></tr><tr><td id="L136" class="nb">136</td><td></td></tr><tr><td id="L137" class="nb">137</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_transaction_isolation?</span></td></tr><tr><td id="L138" class="nb">138</td><td>        <span class="node-true kind-expression run" title="6x">true</span></td></tr><tr><td id="L139" class="nb">139</td><td>      end</td></tr><tr><td id="L140" class="nb">140</td><td></td></tr><tr><td id="L141" class="nb">141</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_foreign_keys?</span></td></tr><tr><td id="L142" class="nb">142</td><td>        <span class="node-true kind-expression run" title="2835x">true</span></td></tr><tr><td id="L143" class="nb">143</td><td>      end</td></tr><tr><td id="L144" class="nb">144</td><td></td></tr><tr><td id="L145" class="nb">145</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_validate_constraints?</span></td></tr><tr><td id="L146" class="nb">146</td><td>        <span class="node-true kind-expression run" title="23x">true</span></td></tr><tr><td id="L147" class="nb">147</td><td>      end</td></tr><tr><td id="L148" class="nb">148</td><td></td></tr><tr><td id="L149" class="nb">149</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_views?</span></td></tr><tr><td id="L150" class="nb">150</td><td>        <span class="node-true kind-expression run" title="3x">true</span></td></tr><tr><td id="L151" class="nb">151</td><td>      end</td></tr><tr><td id="L152" class="nb">152</td><td></td></tr><tr><td id="L153" class="nb">153</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_datetime_with_precision?</span></td></tr><tr><td id="L154" class="nb">154</td><td>        <span class="node-true kind-expression run" title="58x">true</span></td></tr><tr><td id="L155" class="nb">155</td><td>      end</td></tr><tr><td id="L156" class="nb">156</td><td></td></tr><tr><td id="L157" class="nb">157</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_json?</span></td></tr><tr><td id="L158" class="nb">158</td><td>        <span class="node-send kind-selector_begin not-run" title="never run">postgresql_version</span> <span class="node-send kind-selector_begin not-run" title="never run">&gt;=</span> <span class="node-int kind-expression not-run" title="never run">90200</span></td></tr><tr><td id="L159" class="nb">159</td><td>      end</td></tr><tr><td id="L160" class="nb">160</td><td></td></tr><tr><td id="L161" class="nb">161</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_comments?</span></td></tr><tr><td id="L162" class="nb">162</td><td>        <span class="node-true kind-expression run" title="2434x">true</span></td></tr><tr><td id="L163" class="nb">163</td><td>      end</td></tr><tr><td id="L164" class="nb">164</td><td></td></tr><tr><td id="L165" class="nb">165</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_savepoints?</span></td></tr><tr><td id="L166" class="nb">166</td><td>        <span class="node-true kind-expression run" title="63x">true</span></td></tr><tr><td id="L167" class="nb">167</td><td>      end</td></tr><tr><td id="L168" class="nb">168</td><td></td></tr><tr><td id="L169" class="nb">169</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">index_algorithms</span></td></tr><tr><td id="L170" class="nb">170</td><td>        <span class="node-hash kind-begin run" title="11x">{</span> <span class="node-sym kind-expression run" title="11x">concurrently</span><span class="node-pair kind-operator run" title="11x">:</span> <span class="node-str kind-expression run" title="11x">"CONCURRENTLY"</span> <span class="node-hash kind-end run" title="11x">}</span></td></tr><tr><td id="L171" class="nb">171</td><td>      end</td></tr><tr><td id="L172" class="nb">172</td><td></td></tr><tr><td id="L173" class="nb">173</td><td>      <span class="node-class kind-keyword run" title="3x">class</span> <span class="node-const kind-name run" title="3x">StatementPool</span> &lt; <span class="node-const kind-name run" title="3x">ConnectionAdapters</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">StatementPool</span> # :nodoc:</td></tr><tr><td id="L174" class="nb">174</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">initialize</span>(connection, max)</td></tr><tr><td id="L175" class="nb">175</td><td>          <span class="node-super kind-keyword run" title="580x">super</span><span class="node-super kind-begin run" title="580x">(</span><span class="node-lvar kind-name run" title="580x">max</span><span class="node-super kind-end run" title="580x">)</span></td></tr><tr><td id="L176" class="nb">176</td><td>          <span class="node-ivasgn kind-name run" title="580x">@connection</span> <span class="node-ivasgn kind-operator run" title="580x">=</span> <span class="node-lvar kind-name run" title="580x">connection</span></td></tr><tr><td id="L177" class="nb">177</td><td>          <span class="node-ivasgn kind-name run" title="580x">@counter</span> <span class="node-ivasgn kind-operator run" title="580x">=</span> <span class="node-int kind-expression run" title="580x">0</span></td></tr><tr><td id="L178" class="nb">178</td><td>        end</td></tr><tr><td id="L179" class="nb">179</td><td></td></tr><tr><td id="L180" class="nb">180</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">next_key</span></td></tr><tr><td id="L181" class="nb">181</td><td>          <span class="node-dstr kind-begin run" title="2846x">"</span><span class="node-str kind-expression run" title="2846x">a</span><span class="node-begin kind-begin run" title="2846x">#{</span><span class="node-ivar kind-name run" title="2846x">@counter</span> <span class="node-send kind-selector_begin run" title="2846x">+</span> <span class="node-int kind-expression run" title="2846x">1</span><span class="node-begin kind-end run" title="2846x">}</span><span class="node-dstr kind-end run" title="2846x">"</span></td></tr><tr><td id="L182" class="nb">182</td><td>        end</td></tr><tr><td id="L183" class="nb">183</td><td></td></tr><tr><td id="L184" class="nb">184</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">[]=</span>(sql, key)</td></tr><tr><td id="L185" class="nb">185</td><td>          <span class="node-zsuper kind-keyword run" title="2838x">super</span><span class="node-send kind-dot run" title="2838x">.</span><span class="node-send kind-selector_begin run" title="2838x">tap</span> { <span class="node-ivasgn kind-name run" title="2838x">@counter</span> <span class="node-op_asgn kind-operator run" title="2838x">+=</span> <span class="node-int kind-expression run" title="2838x">1</span> }</td></tr><tr><td id="L186" class="nb">186</td><td>        end</td></tr><tr><td id="L187" class="nb">187</td><td></td></tr><tr><td id="L188" class="nb">188</td><td>        <span class="node-send kind-selector_begin run" title="3x">private</span></td></tr><tr><td id="L189" class="nb">189</td><td>          <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">dealloc</span>(key)</td></tr><tr><td id="L190" class="nb">190</td><td>            <span class="fork fork-whole fork-run " data-fork-id="2"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2801x"></i><span class="fork fork-branch fork-run " data-fork-id="2"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2800x"></i><span class="node-ivar kind-name run" title="2800x">@connection</span><span class="node-send kind-dot run" title="2800x">.</span><span class="node-send kind-selector_begin run" title="2800x">query</span> <span class="node-dstr kind-begin run" title="2800x">"</span><span class="node-str kind-expression run" title="2800x">DEALLOCATE </span><span class="node-begin kind-begin run" title="2800x">#{</span><span class="node-lvar kind-name run" title="2800x">key</span><span class="node-begin kind-end run" title="2800x">}</span><span class="node-dstr kind-end run" title="2800x">"</span></span> <span class="node-if kind-keyword run" title="2801x">if</span> <span class="node-send kind-selector_begin run" title="2801x">connection_active?</span></span></td></tr><tr><td id="L191" class="nb">191</td><td>          <span class="node-resbody kind-keyword not-run" title="never run">rescue</span> <span class="node-const kind-name not-run" title="never run">PG</span><span class="node-const kind-double_colon not-run" title="never run">::</span><span class="node-const kind-name not-run" title="never run">Error</span></td></tr><tr><td id="L192" class="nb">192</td><td><span class="node-EmptyBody kind-empty not-run" title="never run"><i class="empty-icon fa fa-code" aria-hidden="true" title="empty node never run"></i></span>          end</td></tr><tr><td id="L193" class="nb">193</td><td></td></tr><tr><td id="L194" class="nb">194</td><td>          <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">connection_active?</span></td></tr><tr><td id="L195" class="nb">195</td><td>            <span class="node-ivar kind-name run" title="2801x">@connection</span><span class="node-send kind-dot run" title="2801x">.</span><span class="node-send kind-selector_begin run" title="2801x">status</span> <span class="node-send kind-selector_begin run" title="2801x">==</span> <span class="node-const kind-name run" title="2801x">PG</span><span class="node-const kind-double_colon run" title="2801x">::</span><span class="node-const kind-name run" title="2801x">CONNECTION_OK</span></td></tr><tr><td id="L196" class="nb">196</td><td>          <span class="node-resbody kind-keyword not-run" title="never run">rescue</span> <span class="node-const kind-name not-run" title="never run">PG</span><span class="node-const kind-double_colon not-run" title="never run">::</span><span class="node-const kind-name not-run" title="never run">Error</span></td></tr><tr><td id="L197" class="nb">197</td><td>            <span class="node-false kind-expression not-run" title="never run">false</span></td></tr><tr><td id="L198" class="nb">198</td><td>          end</td></tr><tr><td id="L199" class="nb">199</td><td>      end</td></tr><tr><td id="L200" class="nb">200</td><td></td></tr><tr><td id="L201" class="nb">201</td><td>      # Initializes and connects a PostgreSQL adapter.</td></tr><tr><td id="L202" class="nb">202</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">initialize</span>(connection, logger, connection_parameters, config)</td></tr><tr><td id="L203" class="nb">203</td><td>        <span class="node-super kind-keyword run" title="581x">super</span><span class="node-super kind-begin run" title="581x">(</span><span class="node-lvar kind-name run" title="581x">connection</span>, <span class="node-lvar kind-name run" title="581x">logger</span>, <span class="node-lvar kind-name run" title="581x">config</span><span class="node-super kind-end run" title="581x">)</span></td></tr><tr><td id="L204" class="nb">204</td><td></td></tr><tr><td id="L205" class="nb">205</td><td>        <span class="node-ivasgn kind-name run" title="581x">@connection_parameters</span> <span class="node-ivasgn kind-operator run" title="581x">=</span> <span class="node-lvar kind-name run" title="581x">connection_parameters</span></td></tr><tr><td id="L206" class="nb">206</td><td></td></tr><tr><td id="L207" class="nb">207</td><td>        # @local_tz is initialized as nil to avoid warnings when connect tries to use it</td></tr><tr><td id="L208" class="nb">208</td><td>        <span class="node-ivasgn kind-name run" title="581x">@local_tz</span> <span class="node-ivasgn kind-operator run" title="581x">=</span> <span class="node-nil kind-expression run" title="581x">nil</span></td></tr><tr><td id="L209" class="nb">209</td><td>        <span class="node-ivasgn kind-name run" title="581x">@max_identifier_length</span> <span class="node-ivasgn kind-operator run" title="581x">=</span> <span class="node-nil kind-expression run" title="581x">nil</span></td></tr><tr><td id="L210" class="nb">210</td><td></td></tr><tr><td id="L211" class="nb">211</td><td>        <span class="node-send kind-selector_begin run" title="581x">connect</span></td></tr><tr><td id="L212" class="nb">212</td><td>        <span class="node-send kind-selector_begin run" title="578x">add_pg_encoders</span></td></tr><tr><td id="L213" class="nb">213</td><td>        <span class="node-ivasgn kind-name run" title="578x">@statements</span> <span class="node-ivasgn kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">StatementPool</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span> <span class="node-ivar kind-name run" title="578x">@connection</span>,</td></tr><tr><td id="L214" class="nb">214</td><td>                                        <span class="node-self kind-expression run" title="578x">self</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">class</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">type_cast_config_to_integer</span>(<span class="node-lvar kind-name run" title="578x">config</span><span class="node-send kind-selector_begin run" title="578x">[</span><span class="node-sym kind-expression run" title="578x">:statement_limit</span><span class="node-send kind-selector_end run" title="578x">]</span>)</td></tr><tr><td id="L215" class="nb">215</td><td></td></tr><tr><td id="L216" class="nb">216</td><td>        <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="3"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy branch not covered"></i><span class="node-if kind-keyword run" title="578x">if</span> <span class="node-send kind-selector_begin run" title="578x">postgresql_version</span> <span class="node-send kind-selector_begin run" title="578x">&lt;</span> <span class="node-int kind-expression run" title="578x">90100</span></span></td></tr><tr><td id="L217" class="nb">217</td><td>          <span class="fork fork-branch fork-not-run " data-fork-id="3"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-send kind-selector_begin not-run" title="never run">raise</span> <span class="node-dstr kind-begin not-run" title="never run">"</span><span class="node-str kind-expression not-run" title="never run">Your version of PostgreSQL (</span><span class="node-begin kind-begin not-run" title="never run">#{</span><span class="node-send kind-selector_begin not-run" title="never run">postgresql_version</span><span class="node-begin kind-end not-run" title="never run">}</span><span class="node-str kind-expression not-run" title="never run">) is too old. Active Record supports PostgreSQL &gt;= 9.1.</span><span class="node-dstr kind-end not-run" title="never run">"</span></span></td></tr><tr><td id="L218" class="nb">218</td><td>        end</td></tr><tr><td id="L219" class="nb">219</td><td></td></tr><tr><td id="L220" class="nb">220</td><td>        <span class="node-send kind-selector_begin run" title="578x">add_pg_decoders</span></td></tr><tr><td id="L221" class="nb">221</td><td></td></tr><tr><td id="L222" class="nb">222</td><td>        <span class="node-ivasgn kind-name run" title="578x">@type_map</span> <span class="node-ivasgn kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">Type</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">HashLookupTypeMap</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L223" class="nb">223</td><td>        <span class="node-send kind-selector_begin run" title="578x">initialize_type_map</span></td></tr><tr><td id="L224" class="nb">224</td><td>        <span class="node-ivasgn kind-name run" title="578x">@local_tz</span> <span class="node-ivasgn kind-operator run" title="578x">=</span> <span class="node-send kind-selector_begin run" title="578x">execute</span>(<span class="node-str kind-expression run" title="578x">"SHOW TIME ZONE"</span>, <span class="node-str kind-expression run" title="578x">"SCHEMA"</span>)<span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">first</span><span class="node-send kind-selector_begin run" title="578x">[</span><span class="node-str kind-expression run" title="578x">"TimeZone"</span><span class="node-send kind-selector_end run" title="578x">]</span></td></tr><tr><td id="L225" class="nb">225</td><td>        <span class="node-ivasgn kind-name run" title="578x">@use_insert_returning</span> <span class="node-ivasgn kind-operator run" title="578x">=</span> <span class="fork fork-whole fork-run " data-fork-id="4"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="578x"></i><span class="node-ivar kind-name run" title="578x">@config</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">key?</span>(<span class="node-sym kind-expression run" title="578x">:insert_returning</span>) <span class="node-if kind-question run" title="578x">?</span> <span class="fork fork-branch fork-run " data-fork-id="4"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="12x"></i><span class="node-self kind-expression run" title="12x">self</span><span class="node-send kind-dot run" title="12x">.</span><span class="node-send kind-selector_begin run" title="12x">class</span><span class="node-send kind-dot run" title="12x">.</span><span class="node-send kind-selector_begin run" title="12x">type_cast_config_to_boolean</span>(<span class="node-ivar kind-name run" title="12x">@config</span><span class="node-send kind-selector_begin run" title="12x">[</span><span class="node-sym kind-expression run" title="12x">:insert_returning</span><span class="node-send kind-selector_end run" title="12x">]</span>)</span> <span class="node-true kind-colon run" title="566x">:</span> <span class="fork fork-branch fork-run " data-fork-id="4"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="566x"></i><span class="node-true kind-expression run" title="566x">true</span></span></span></td></tr><tr><td id="L226" class="nb">226</td><td>      end</td></tr><tr><td id="L227" class="nb">227</td><td></td></tr><tr><td id="L228" class="nb">228</td><td>      # Clears the prepared statements cache.</td></tr><tr><td id="L229" class="nb">229</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">clear_cache!</span></td></tr><tr><td id="L230" class="nb">230</td><td>        <span class="node-ivar kind-name run" title="3003x">@lock</span><span class="node-send kind-dot run" title="3003x">.</span><span class="node-send kind-selector_begin run" title="3003x">synchronize</span> do</td></tr><tr><td id="L231" class="nb">231</td><td>          <span class="node-ivar kind-name run" title="3003x">@statements</span><span class="node-send kind-dot run" title="3003x">.</span><span class="node-send kind-selector_begin run" title="3003x">clear</span></td></tr><tr><td id="L232" class="nb">232</td><td>        end</td></tr><tr><td id="L233" class="nb">233</td><td>      end</td></tr><tr><td id="L234" class="nb">234</td><td></td></tr><tr><td id="L235" class="nb">235</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">truncate</span>(table_name, name = <span class="node-nil kind-expression run" title="3x">nil</span>)</td></tr><tr><td id="L236" class="nb">236</td><td>        <span class="node-send kind-selector_begin run" title="3x">exec_query</span> <span class="node-dstr kind-begin run" title="3x">"</span><span class="node-str kind-expression run" title="3x">TRUNCATE TABLE </span><span class="node-begin kind-begin run" title="3x">#{</span><span class="node-send kind-selector_begin run" title="3x">quote_table_name</span>(<span class="node-lvar kind-name run" title="3x">table_name</span>)<span class="node-begin kind-end run" title="3x">}</span><span class="node-dstr kind-end run" title="3x">"</span>, <span class="node-lvar kind-name run" title="3x">name</span>, <span class="node-array kind-begin run" title="3x">[</span><span class="node-array kind-end run" title="3x">]</span></td></tr><tr><td id="L237" class="nb">237</td><td>      end</td></tr><tr><td id="L238" class="nb">238</td><td></td></tr><tr><td id="L239" class="nb">239</td><td>      # Is this connection alive and ready for queries?</td></tr><tr><td id="L240" class="nb">240</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">active?</span></td></tr><tr><td id="L241" class="nb">241</td><td>        <span class="node-ivar kind-name run" title="39365x">@lock</span><span class="node-send kind-dot run" title="39365x">.</span><span class="node-send kind-selector_begin run" title="39365x">synchronize</span> do</td></tr><tr><td id="L242" class="nb">242</td><td>          <span class="node-ivar kind-name run" title="39365x">@connection</span><span class="node-send kind-dot run" title="39365x">.</span><span class="node-send kind-selector_begin run" title="39365x">query</span> <span class="node-str kind-expression run" title="39365x">"SELECT 1"</span></td></tr><tr><td id="L243" class="nb">243</td><td>        end</td></tr><tr><td id="L244" class="nb">244</td><td>        <span class="node-true kind-expression run" title="39360x">true</span></td></tr><tr><td id="L245" class="nb">245</td><td>      <span class="node-resbody kind-keyword run" title="5x">rescue</span> <span class="node-const kind-name run" title="5x">PG</span><span class="node-const kind-double_colon run" title="5x">::</span><span class="node-const kind-name run" title="5x">Error</span></td></tr><tr><td id="L246" class="nb">246</td><td>        <span class="node-false kind-expression run" title="5x">false</span></td></tr><tr><td id="L247" class="nb">247</td><td>      end</td></tr><tr><td id="L248" class="nb">248</td><td></td></tr><tr><td id="L249" class="nb">249</td><td>      # Close then reopen the connection.</td></tr><tr><td id="L250" class="nb">250</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">reconnect!</span></td></tr><tr><td id="L251" class="nb">251</td><td>        <span class="node-ivar kind-name run" title="265x">@lock</span><span class="node-send kind-dot run" title="265x">.</span><span class="node-send kind-selector_begin run" title="265x">synchronize</span> do</td></tr><tr><td id="L252" class="nb">252</td><td>          <span class="node-zsuper kind-keyword run" title="265x">super</span></td></tr><tr><td id="L253" class="nb">253</td><td>          <span class="node-ivar kind-name run" title="265x">@connection</span><span class="node-send kind-dot run" title="265x">.</span><span class="node-send kind-selector_begin run" title="265x">reset</span></td></tr><tr><td id="L254" class="nb">254</td><td>          <span class="node-send kind-selector_begin run" title="265x">configure_connection</span></td></tr><tr><td id="L255" class="nb">255</td><td>        end</td></tr><tr><td id="L256" class="nb">256</td><td>      end</td></tr><tr><td id="L257" class="nb">257</td><td></td></tr><tr><td id="L258" class="nb">258</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">reset!</span></td></tr><tr><td id="L259" class="nb">259</td><td>        <span class="node-ivar kind-name run" title="110x">@lock</span><span class="node-send kind-dot run" title="110x">.</span><span class="node-send kind-selector_begin run" title="110x">synchronize</span> do</td></tr><tr><td id="L260" class="nb">260</td><td>          <span class="node-send kind-selector_begin run" title="110x">clear_cache!</span></td></tr><tr><td id="L261" class="nb">261</td><td>          <span class="node-send kind-selector_begin run" title="110x">reset_transaction</span></td></tr><tr><td id="L262" class="nb">262</td><td>          <span class="fork fork-whole fork-run " data-fork-id="5"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="110x"></i><span class="node-if kind-keyword run" title="110x">unless</span> <span class="node-ivar kind-name run" title="110x">@connection</span><span class="node-send kind-dot run" title="110x">.</span><span class="node-send kind-selector_begin run" title="110x">transaction_status</span> <span class="node-send kind-selector_begin run" title="110x">==</span> <span class="node-const kind-double_colon run" title="110x">::</span><span class="node-const kind-name run" title="110x">PG</span><span class="node-const kind-double_colon run" title="110x">::</span><span class="node-const kind-name run" title="110x">PQTRANS_IDLE</span></span></td></tr><tr><td id="L263" class="nb">263</td><td>            <span class="fork fork-branch fork-run " data-fork-id="5"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3x"></i><span class="node-ivar kind-name run" title="3x">@connection</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">query</span> <span class="node-str kind-expression run" title="3x">"ROLLBACK"</span></span></td></tr><tr><td id="L264" class="nb">264</td><td>          end</td></tr><tr><td id="L265" class="nb">265</td><td>          <span class="node-ivar kind-name run" title="110x">@connection</span><span class="node-send kind-dot run" title="110x">.</span><span class="node-send kind-selector_begin run" title="110x">query</span> <span class="node-str kind-expression run" title="110x">"DISCARD ALL"</span></td></tr><tr><td id="L266" class="nb">266</td><td>          <span class="node-send kind-selector_begin run" title="110x">configure_connection</span></td></tr><tr><td id="L267" class="nb">267</td><td>        end</td></tr><tr><td id="L268" class="nb">268</td><td>      end</td></tr><tr><td id="L269" class="nb">269</td><td></td></tr><tr><td id="L270" class="nb">270</td><td>      # Disconnects from the database if already connected. Otherwise, this</td></tr><tr><td id="L271" class="nb">271</td><td>      # method does nothing.</td></tr><tr><td id="L272" class="nb">272</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">disconnect!</span></td></tr><tr><td id="L273" class="nb">273</td><td>        <span class="node-ivar kind-name run" title="513x">@lock</span><span class="node-send kind-dot run" title="513x">.</span><span class="node-send kind-selector_begin run" title="513x">synchronize</span> do</td></tr><tr><td id="L274" class="nb">274</td><td>          <span class="node-zsuper kind-keyword run" title="513x">super</span></td></tr><tr><td id="L275" class="nb">275</td><td>          <span class="node-ivar kind-name run" title="513x">@connection</span><span class="node-send kind-dot run" title="513x">.</span><span class="node-send kind-selector_begin run" title="513x">close</span> <span class="node-resbody kind-keyword run" title="4x">rescue</span> <span class="node-nil kind-expression run" title="4x">nil</span></td></tr><tr><td id="L276" class="nb">276</td><td>        end</td></tr><tr><td id="L277" class="nb">277</td><td>      end</td></tr><tr><td id="L278" class="nb">278</td><td></td></tr><tr><td id="L279" class="nb">279</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">discard!</span> # :nodoc:</td></tr><tr><td id="L280" class="nb">280</td><td>        <span class="node-ivar kind-name run" title="4x">@connection</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">socket_io</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">reopen</span>(<span class="node-const kind-name run" title="4x">IO</span><span class="node-const kind-double_colon run" title="4x">::</span><span class="node-const kind-name run" title="4x">NULL</span>)</td></tr><tr><td id="L281" class="nb">281</td><td>        <span class="node-ivasgn kind-name run" title="4x">@connection</span> <span class="node-ivasgn kind-operator run" title="4x">=</span> <span class="node-nil kind-expression run" title="4x">nil</span></td></tr><tr><td id="L282" class="nb">282</td><td>      end</td></tr><tr><td id="L283" class="nb">283</td><td></td></tr><tr><td id="L284" class="nb">284</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">native_database_types</span> #:nodoc:</td></tr><tr><td id="L285" class="nb">285</td><td>        <span class="node-const kind-name run" title="34897x">NATIVE_DATABASE_TYPES</span></td></tr><tr><td id="L286" class="nb">286</td><td>      end</td></tr><tr><td id="L287" class="nb">287</td><td></td></tr><tr><td id="L288" class="nb">288</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">set_standard_conforming_strings</span></td></tr><tr><td id="L289" class="nb">289</td><td>        <span class="node-send kind-selector_begin run" title="953x">execute</span>(<span class="node-str kind-expression run" title="953x">"SET standard_conforming_strings = on"</span>, <span class="node-str kind-expression run" title="953x">"SCHEMA"</span>)</td></tr><tr><td id="L290" class="nb">290</td><td>      end</td></tr><tr><td id="L291" class="nb">291</td><td></td></tr><tr><td id="L292" class="nb">292</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_ddl_transactions?</span></td></tr><tr><td id="L293" class="nb">293</td><td>        <span class="node-true kind-expression run" title="135x">true</span></td></tr><tr><td id="L294" class="nb">294</td><td>      end</td></tr><tr><td id="L295" class="nb">295</td><td></td></tr><tr><td id="L296" class="nb">296</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_advisory_locks?</span></td></tr><tr><td id="L297" class="nb">297</td><td>        <span class="node-true kind-expression run" title="111x">true</span></td></tr><tr><td id="L298" class="nb">298</td><td>      end</td></tr><tr><td id="L299" class="nb">299</td><td></td></tr><tr><td id="L300" class="nb">300</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_explain?</span></td></tr><tr><td id="L301" class="nb">301</td><td>        <span class="node-true kind-expression run" title="6x">true</span></td></tr><tr><td id="L302" class="nb">302</td><td>      end</td></tr><tr><td id="L303" class="nb">303</td><td></td></tr><tr><td id="L304" class="nb">304</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_extensions?</span></td></tr><tr><td id="L305" class="nb">305</td><td>        <span class="node-true kind-expression run" title="253x">true</span></td></tr><tr><td id="L306" class="nb">306</td><td>      end</td></tr><tr><td id="L307" class="nb">307</td><td></td></tr><tr><td id="L308" class="nb">308</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_ranges?</span></td></tr><tr><td id="L309" class="nb">309</td><td>        # Range datatypes weren't introduced until PostgreSQL 9.2</td></tr><tr><td id="L310" class="nb">310</td><td>        <span class="node-send kind-selector_begin run" title="959x">postgresql_version</span> <span class="node-send kind-selector_begin run" title="959x">&gt;=</span> <span class="node-int kind-expression run" title="959x">90200</span></td></tr><tr><td id="L311" class="nb">311</td><td>      end</td></tr><tr><td id="L312" class="nb">312</td><td></td></tr><tr><td id="L313" class="nb">313</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_materialized_views?</span></td></tr><tr><td id="L314" class="nb">314</td><td>        <span class="node-send kind-selector_begin run" title="3x">postgresql_version</span> <span class="node-send kind-selector_begin run" title="3x">&gt;=</span> <span class="node-int kind-expression run" title="3x">90300</span></td></tr><tr><td id="L315" class="nb">315</td><td>      end</td></tr><tr><td id="L316" class="nb">316</td><td></td></tr><tr><td id="L317" class="nb">317</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">supports_pgcrypto_uuid?</span></td></tr><tr><td id="L318" class="nb">318</td><td>        <span class="node-send kind-selector_begin run" title="94x">postgresql_version</span> <span class="node-send kind-selector_begin run" title="94x">&gt;=</span> <span class="node-int kind-expression run" title="94x">90400</span></td></tr><tr><td id="L319" class="nb">319</td><td>      end</td></tr><tr><td id="L320" class="nb">320</td><td></td></tr><tr><td id="L321" class="nb">321</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">get_advisory_lock</span>(lock_id) # :nodoc:</td></tr><tr><td id="L322" class="nb">322</td><td>        <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="6"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="node-if kind-keyword run" title="120x">unless</span> <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="7"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy shortcut not covered"></i><span class="node-lvar kind-name run" title="120x">lock_id</span><span class="node-send kind-dot run" title="120x">.</span><span class="node-send kind-selector_begin run" title="120x">is_a?</span>(<span class="node-const kind-name run" title="120x">Integer</span>) <span class="node-and kind-operator run" title="120x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="7"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="120x"></i><span class="node-lvar kind-name run" title="120x">lock_id</span><span class="node-send kind-dot run" title="120x">.</span><span class="node-send kind-selector_begin run" title="120x">bit_length</span> <span class="node-send kind-selector_begin run" title="120x">&lt;=</span> <span class="node-int kind-expression run" title="120x">63</span></span></span></span></td></tr><tr><td id="L323" class="nb">323</td><td>          <span class="fork fork-branch fork-not-run " data-fork-id="6"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-send kind-selector_begin not-run" title="never run">raise</span>(<span class="node-const kind-name not-run" title="never run">ArgumentError</span>, <span class="node-str kind-expression not-run" title="never run">"PostgreSQL requires advisory lock ids to be a signed 64 bit integer"</span>)</span></td></tr><tr><td id="L324" class="nb">324</td><td>        end</td></tr><tr><td id="L325" class="nb">325</td><td>        <span class="node-send kind-selector_begin run" title="120x">query_value</span>(<span class="node-dstr kind-begin run" title="120x">"</span><span class="node-str kind-expression run" title="120x">SELECT pg_try_advisory_lock(</span><span class="node-begin kind-begin run" title="120x">#{</span><span class="node-lvar kind-name run" title="120x">lock_id</span><span class="node-begin kind-end run" title="120x">}</span><span class="node-str kind-expression run" title="120x">)</span><span class="node-dstr kind-end run" title="120x">"</span>)</td></tr><tr><td id="L326" class="nb">326</td><td>      end</td></tr><tr><td id="L327" class="nb">327</td><td></td></tr><tr><td id="L328" class="nb">328</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">release_advisory_lock</span>(lock_id) # :nodoc:</td></tr><tr><td id="L329" class="nb">329</td><td>        <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="8"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="node-if kind-keyword run" title="117x">unless</span> <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="9"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy shortcut not covered"></i><span class="node-lvar kind-name run" title="117x">lock_id</span><span class="node-send kind-dot run" title="117x">.</span><span class="node-send kind-selector_begin run" title="117x">is_a?</span>(<span class="node-const kind-name run" title="117x">Integer</span>) <span class="node-and kind-operator run" title="117x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="9"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="117x"></i><span class="node-lvar kind-name run" title="117x">lock_id</span><span class="node-send kind-dot run" title="117x">.</span><span class="node-send kind-selector_begin run" title="117x">bit_length</span> <span class="node-send kind-selector_begin run" title="117x">&lt;=</span> <span class="node-int kind-expression run" title="117x">63</span></span></span></span></td></tr><tr><td id="L330" class="nb">330</td><td>          <span class="fork fork-branch fork-not-run " data-fork-id="8"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-send kind-selector_begin not-run" title="never run">raise</span>(<span class="node-const kind-name not-run" title="never run">ArgumentError</span>, <span class="node-str kind-expression not-run" title="never run">"PostgreSQL requires advisory lock ids to be a signed 64 bit integer"</span>)</span></td></tr><tr><td id="L331" class="nb">331</td><td>        end</td></tr><tr><td id="L332" class="nb">332</td><td>        <span class="node-send kind-selector_begin run" title="117x">query_value</span>(<span class="node-dstr kind-begin run" title="117x">"</span><span class="node-str kind-expression run" title="117x">SELECT pg_advisory_unlock(</span><span class="node-begin kind-begin run" title="117x">#{</span><span class="node-lvar kind-name run" title="117x">lock_id</span><span class="node-begin kind-end run" title="117x">}</span><span class="node-str kind-expression run" title="117x">)</span><span class="node-dstr kind-end run" title="117x">"</span>)</td></tr><tr><td id="L333" class="nb">333</td><td>      end</td></tr><tr><td id="L334" class="nb">334</td><td></td></tr><tr><td id="L335" class="nb">335</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">enable_extension</span>(name)</td></tr><tr><td id="L336" class="nb">336</td><td>        <span class="node-send kind-selector_begin run" title="112x">exec_query</span>(<span class="node-dstr kind-begin run" title="112x">"</span><span class="node-str kind-expression run" title="112x">CREATE EXTENSION IF NOT EXISTS \"</span><span class="node-begin kind-begin run" title="112x">#{</span><span class="node-lvar kind-name run" title="112x">name</span><span class="node-begin kind-end run" title="112x">}</span><span class="node-str kind-expression run" title="112x">\"</span><span class="node-dstr kind-end run" title="112x">"</span>)<span class="node-send kind-dot run" title="112x">.</span><span class="node-send kind-selector_begin run" title="112x">tap</span> {</td></tr><tr><td id="L337" class="nb">337</td><td>          <span class="node-send kind-selector_begin run" title="112x">reload_type_map</span></td></tr><tr><td id="L338" class="nb">338</td><td>        }</td></tr><tr><td id="L339" class="nb">339</td><td>      end</td></tr><tr><td id="L340" class="nb">340</td><td></td></tr><tr><td id="L341" class="nb">341</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">disable_extension</span>(name)</td></tr><tr><td id="L342" class="nb">342</td><td>        <span class="node-send kind-selector_begin run" title="112x">exec_query</span>(<span class="node-dstr kind-begin run" title="112x">"</span><span class="node-str kind-expression run" title="112x">DROP EXTENSION IF EXISTS \"</span><span class="node-begin kind-begin run" title="112x">#{</span><span class="node-lvar kind-name run" title="112x">name</span><span class="node-begin kind-end run" title="112x">}</span><span class="node-str kind-expression run" title="112x">\" CASCADE</span><span class="node-dstr kind-end run" title="112x">"</span>)<span class="node-send kind-dot run" title="112x">.</span><span class="node-send kind-selector_begin run" title="112x">tap</span> {</td></tr><tr><td id="L343" class="nb">343</td><td>          <span class="node-send kind-selector_begin run" title="112x">reload_type_map</span></td></tr><tr><td id="L344" class="nb">344</td><td>        }</td></tr><tr><td id="L345" class="nb">345</td><td>      end</td></tr><tr><td id="L346" class="nb">346</td><td></td></tr><tr><td id="L347" class="nb">347</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">extension_enabled?</span>(name)</td></tr><tr><td id="L348" class="nb">348</td><td>        <span class="node-lvasgn kind-name run" title="265x">res</span> <span class="node-lvasgn kind-operator run" title="265x">=</span> <span class="node-send kind-selector_begin run" title="265x">exec_query</span>(<span class="node-dstr kind-begin run" title="265x">"</span><span class="node-str kind-expression run" title="265x">SELECT EXISTS(SELECT * FROM pg_available_extensions WHERE name = '</span><span class="node-begin kind-begin run" title="265x">#{</span><span class="node-lvar kind-name run" title="265x">name</span><span class="node-begin kind-end run" title="265x">}</span><span class="node-str kind-expression run" title="265x">' AND installed_version IS NOT NULL) as enabled</span><span class="node-dstr kind-end run" title="265x">"</span>, <span class="node-str kind-expression run" title="265x">"SCHEMA"</span>)</td></tr><tr><td id="L349" class="nb">349</td><td>        <span class="node-lvar kind-name run" title="265x">res</span><span class="node-send kind-dot run" title="265x">.</span><span class="node-send kind-selector_begin run" title="265x">cast_values</span><span class="node-send kind-dot run" title="265x">.</span><span class="node-send kind-selector_begin run" title="265x">first</span></td></tr><tr><td id="L350" class="nb">350</td><td>      end</td></tr><tr><td id="L351" class="nb">351</td><td></td></tr><tr><td id="L352" class="nb">352</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">extensions</span></td></tr><tr><td id="L353" class="nb">353</td><td>        <span class="node-send kind-selector_begin run" title="194x">exec_query</span>(<span class="node-str kind-expression run" title="194x">"SELECT extname FROM pg_extension"</span>, <span class="node-str kind-expression run" title="194x">"SCHEMA"</span>)<span class="node-send kind-dot run" title="194x">.</span><span class="node-send kind-selector_begin run" title="194x">cast_values</span></td></tr><tr><td id="L354" class="nb">354</td><td>      end</td></tr><tr><td id="L355" class="nb">355</td><td></td></tr><tr><td id="L356" class="nb">356</td><td>      # Returns the configured supported identifier length supported by PostgreSQL</td></tr><tr><td id="L357" class="nb">357</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">max_identifier_length</span></td></tr><tr><td id="L358" class="nb">358</td><td>        <span class="node-ivasgn kind-name run" title="68453x">@max_identifier_length</span> <span class="node-or_asgn kind-operator run" title="68453x">||=</span> <span class="node-send kind-selector_begin run" title="167x">query_value</span>(<span class="node-str kind-expression run" title="167x">"SHOW max_identifier_length"</span>, <span class="node-str kind-expression run" title="167x">"SCHEMA"</span>)<span class="node-send kind-dot run" title="167x">.</span><span class="node-send kind-selector_begin run" title="167x">to_i</span></td></tr><tr><td id="L359" class="nb">359</td><td>      end</td></tr><tr><td id="L360" class="nb">360</td><td>      <span class="node-alias kind-keyword run" title="3x">alias</span> <span class="node-sym kind-expression run" title="3x">table_alias_length</span> <span class="node-sym kind-expression run" title="3x">max_identifier_length</span></td></tr><tr><td id="L361" class="nb">361</td><td>      <span class="node-alias kind-keyword run" title="3x">alias</span> <span class="node-sym kind-expression run" title="3x">index_name_length</span> <span class="node-sym kind-expression run" title="3x">max_identifier_length</span></td></tr><tr><td id="L362" class="nb">362</td><td></td></tr><tr><td id="L363" class="nb">363</td><td>      # Set the authorized user for this session</td></tr><tr><td id="L364" class="nb">364</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">session_auth=</span>(user)</td></tr><tr><td id="L365" class="nb">365</td><td>        <span class="node-send kind-selector_begin run" title="56x">clear_cache!</span></td></tr><tr><td id="L366" class="nb">366</td><td>        <span class="node-send kind-selector_begin run" title="56x">execute</span>(<span class="node-dstr kind-begin run" title="56x">"</span><span class="node-str kind-expression run" title="56x">SET SESSION AUTHORIZATION </span><span class="node-begin kind-begin run" title="56x">#{</span><span class="node-lvar kind-name run" title="56x">user</span><span class="node-begin kind-end run" title="56x">}</span><span class="node-dstr kind-end run" title="56x">"</span>)</td></tr><tr><td id="L367" class="nb">367</td><td>      end</td></tr><tr><td id="L368" class="nb">368</td><td></td></tr><tr><td id="L369" class="nb">369</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">use_insert_returning?</span></td></tr><tr><td id="L370" class="nb">370</td><td>        <span class="node-ivar kind-name run" title="6813x">@use_insert_returning</span></td></tr><tr><td id="L371" class="nb">371</td><td>      end</td></tr><tr><td id="L372" class="nb">372</td><td></td></tr><tr><td id="L373" class="nb">373</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">column_name_for_operation</span>(operation, node) # :nodoc:</td></tr><tr><td id="L374" class="nb">374</td><td>        <span class="node-const kind-name run" title="2037x">OPERATION_ALIASES</span><span class="node-send kind-dot run" title="2037x">.</span><span class="node-send kind-selector_begin run" title="2037x">fetch</span>(<span class="node-lvar kind-name run" title="2037x">operation</span>) { <span class="node-lvar kind-name run" title="1975x">operation</span><span class="node-send kind-dot run" title="1975x">.</span><span class="node-send kind-selector_begin run" title="1975x">downcase</span> }</td></tr><tr><td id="L375" class="nb">375</td><td>      end</td></tr><tr><td id="L376" class="nb">376</td><td></td></tr><tr><td id="L377" class="nb">377</td><td>      <span class="node-casgn kind-name run" title="3x">OPERATION_ALIASES</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-hash kind-begin run" title="3x">{</span> # :nodoc:</td></tr><tr><td id="L378" class="nb">378</td><td>        <span class="node-str kind-expression run" title="3x">"maximum"</span> <span class="node-pair kind-operator run" title="3x">=&gt;</span> <span class="node-str kind-expression run" title="3x">"max"</span>,</td></tr><tr><td id="L379" class="nb">379</td><td>        <span class="node-str kind-expression run" title="3x">"minimum"</span> <span class="node-pair kind-operator run" title="3x">=&gt;</span> <span class="node-str kind-expression run" title="3x">"min"</span>,</td></tr><tr><td id="L380" class="nb">380</td><td>        <span class="node-str kind-expression run" title="3x">"average"</span> <span class="node-pair kind-operator run" title="3x">=&gt;</span> <span class="node-str kind-expression run" title="3x">"avg"</span>,</td></tr><tr><td id="L381" class="nb">381</td><td>      <span class="node-hash kind-end run" title="3x">}</span></td></tr><tr><td id="L382" class="nb">382</td><td></td></tr><tr><td id="L383" class="nb">383</td><td>      # Returns the version of the connected PostgreSQL server.</td></tr><tr><td id="L384" class="nb">384</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">postgresql_version</span></td></tr><tr><td id="L385" class="nb">385</td><td>        <span class="node-ivar kind-name run" title="1661x">@connection</span><span class="node-send kind-dot run" title="1661x">.</span><span class="node-send kind-selector_begin run" title="1661x">server_version</span></td></tr><tr><td id="L386" class="nb">386</td><td>      end</td></tr><tr><td id="L387" class="nb">387</td><td></td></tr><tr><td id="L388" class="nb">388</td><td>      <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">default_index_type?</span>(index) # :nodoc:</td></tr><tr><td id="L389" class="nb">389</td><td>        <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="10"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="left-hand side not covered"></i><span class="node-lvar kind-name run" title="1513x">index</span><span class="node-send kind-dot run" title="1513x">.</span><span class="node-send kind-selector_begin run" title="1513x">using</span> <span class="node-send kind-selector_begin run" title="1513x">==</span> <span class="node-sym kind-expression run" title="1513x">:btree</span> <span class="node-or kind-operator run" title="1513x">||</span> <span class="fork fork-branch fork-not-run " data-fork-id="10"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-zsuper kind-keyword not-run" title="never run">super</span></span></span></td></tr><tr><td id="L390" class="nb">390</td><td>      end</td></tr><tr><td id="L391" class="nb">391</td><td></td></tr><tr><td id="L392" class="nb">392</td><td>      <span class="node-send kind-selector_begin run" title="3x">private</span></td></tr><tr><td id="L393" class="nb">393</td><td>        # See https://www.postgresql.org/docs/current/static/errcodes-appendix.html</td></tr><tr><td id="L394" class="nb">394</td><td>        <span class="node-casgn kind-name run" title="3x">VALUE_LIMIT_VIOLATION</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"22001"</span></td></tr><tr><td id="L395" class="nb">395</td><td>        <span class="node-casgn kind-name run" title="3x">NUMERIC_VALUE_OUT_OF_RANGE</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"22003"</span></td></tr><tr><td id="L396" class="nb">396</td><td>        <span class="node-casgn kind-name run" title="3x">NOT_NULL_VIOLATION</span>    <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"23502"</span></td></tr><tr><td id="L397" class="nb">397</td><td>        <span class="node-casgn kind-name run" title="3x">FOREIGN_KEY_VIOLATION</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"23503"</span></td></tr><tr><td id="L398" class="nb">398</td><td>        <span class="node-casgn kind-name run" title="3x">UNIQUE_VIOLATION</span>      <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"23505"</span></td></tr><tr><td id="L399" class="nb">399</td><td>        <span class="node-casgn kind-name run" title="3x">SERIALIZATION_FAILURE</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"40001"</span></td></tr><tr><td id="L400" class="nb">400</td><td>        <span class="node-casgn kind-name run" title="3x">DEADLOCK_DETECTED</span>     <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"40P01"</span></td></tr><tr><td id="L401" class="nb">401</td><td>        <span class="node-casgn kind-name run" title="3x">LOCK_NOT_AVAILABLE</span>    <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"55P03"</span></td></tr><tr><td id="L402" class="nb">402</td><td>        <span class="node-casgn kind-name run" title="3x">QUERY_CANCELED</span>        <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"57014"</span></td></tr><tr><td id="L403" class="nb">403</td><td></td></tr><tr><td id="L404" class="nb">404</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">translate_exception</span>(exception, message)</td></tr><tr><td id="L405" class="nb">405</td><td>          <span class="fork fork-whole fork-run " data-fork-id="11"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2426x"></i><span class="fork fork-branch fork-run " data-fork-id="11"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="6x"></i><span class="node-return kind-keyword run" title="6x">return</span> <span class="node-lvar kind-name run" title="6x">exception</span></span> <span class="node-if kind-keyword run" title="2426x">unless</span> <span class="node-lvar kind-name run" title="2426x">exception</span><span class="node-send kind-dot run" title="2426x">.</span><span class="node-send kind-selector_begin run" title="2426x">respond_to?</span>(<span class="node-sym kind-expression run" title="2426x">:result</span>)</span></td></tr><tr><td id="L406" class="nb">406</td><td></td></tr><tr><td id="L407" class="nb">407</td><td>          <span class="fork fork-whole fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2420x"></i><span class="node-case kind-keyword run" title="2420x">case</span> <span class="node-lvar kind-name run" title="2420x">exception</span><span class="node-send kind-dot run" title="2420x">.</span><span class="node-send kind-selector_begin run" title="2420x">result</span><span class="node-send kind-dot run" title="2420x">.</span><span class="node-send kind-selector_begin run" title="2420x">try</span>(<span class="node-sym kind-expression run" title="2420x">:error_field</span>, <span class="node-const kind-name run" title="2420x">PG</span><span class="node-const kind-double_colon run" title="2420x">::</span><span class="node-const kind-name run" title="2420x">PG_DIAG_SQLSTATE</span>)</span></td></tr><tr><td id="L408" class="nb">408</td><td>          <span class="node-when kind-keyword run" title="2420x">when</span> <span class="node-const kind-name run" title="2420x">UNIQUE_VIOLATION</span></td></tr><tr><td id="L409" class="nb">409</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="5x"></i><span class="node-const kind-name run" title="5x">RecordNotUnique</span><span class="node-send kind-dot run" title="5x">.</span><span class="node-send kind-selector_begin run" title="5x">new</span>(<span class="node-lvar kind-name run" title="5x">message</span>)</span></td></tr><tr><td id="L410" class="nb">410</td><td>          <span class="node-when kind-keyword run" title="2415x">when</span> <span class="node-const kind-name run" title="2415x">FOREIGN_KEY_VIOLATION</span></td></tr><tr><td id="L411" class="nb">411</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4x"></i><span class="node-const kind-name run" title="4x">InvalidForeignKey</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">new</span>(<span class="node-lvar kind-name run" title="4x">message</span>)</span></td></tr><tr><td id="L412" class="nb">412</td><td>          <span class="node-when kind-keyword run" title="2411x">when</span> <span class="node-const kind-name run" title="2411x">VALUE_LIMIT_VIOLATION</span></td></tr><tr><td id="L413" class="nb">413</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="5x"></i><span class="node-const kind-name run" title="5x">ValueTooLong</span><span class="node-send kind-dot run" title="5x">.</span><span class="node-send kind-selector_begin run" title="5x">new</span>(<span class="node-lvar kind-name run" title="5x">message</span>)</span></td></tr><tr><td id="L414" class="nb">414</td><td>          <span class="node-when kind-keyword run" title="2406x">when</span> <span class="node-const kind-name run" title="2406x">NUMERIC_VALUE_OUT_OF_RANGE</span></td></tr><tr><td id="L415" class="nb">415</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3x"></i><span class="node-const kind-name run" title="3x">RangeError</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">new</span>(<span class="node-lvar kind-name run" title="3x">message</span>)</span></td></tr><tr><td id="L416" class="nb">416</td><td>          <span class="node-when kind-keyword run" title="2403x">when</span> <span class="node-const kind-name run" title="2403x">NOT_NULL_VIOLATION</span></td></tr><tr><td id="L417" class="nb">417</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="18x"></i><span class="node-const kind-name run" title="18x">NotNullViolation</span><span class="node-send kind-dot run" title="18x">.</span><span class="node-send kind-selector_begin run" title="18x">new</span>(<span class="node-lvar kind-name run" title="18x">message</span>)</span></td></tr><tr><td id="L418" class="nb">418</td><td>          <span class="node-when kind-keyword run" title="2385x">when</span> <span class="node-const kind-name run" title="2385x">SERIALIZATION_FAILURE</span></td></tr><tr><td id="L419" class="nb">419</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1x"></i><span class="node-const kind-name run" title="1x">SerializationFailure</span><span class="node-send kind-dot run" title="1x">.</span><span class="node-send kind-selector_begin run" title="1x">new</span>(<span class="node-lvar kind-name run" title="1x">message</span>)</span></td></tr><tr><td id="L420" class="nb">420</td><td>          <span class="node-when kind-keyword run" title="2384x">when</span> <span class="node-const kind-name run" title="2384x">DEADLOCK_DETECTED</span></td></tr><tr><td id="L421" class="nb">421</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1x"></i><span class="node-const kind-name run" title="1x">Deadlocked</span><span class="node-send kind-dot run" title="1x">.</span><span class="node-send kind-selector_begin run" title="1x">new</span>(<span class="node-lvar kind-name run" title="1x">message</span>)</span></td></tr><tr><td id="L422" class="nb">422</td><td>          <span class="node-when kind-keyword run" title="2383x">when</span> <span class="node-const kind-name run" title="2383x">LOCK_NOT_AVAILABLE</span></td></tr><tr><td id="L423" class="nb">423</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1x"></i><span class="node-const kind-name run" title="1x">LockWaitTimeout</span><span class="node-send kind-dot run" title="1x">.</span><span class="node-send kind-selector_begin run" title="1x">new</span>(<span class="node-lvar kind-name run" title="1x">message</span>)</span></td></tr><tr><td id="L424" class="nb">424</td><td>          <span class="node-when kind-keyword run" title="2382x">when</span> <span class="node-const kind-name run" title="2382x">QUERY_CANCELED</span></td></tr><tr><td id="L425" class="nb">425</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2x"></i><span class="node-const kind-name run" title="2x">QueryCanceled</span><span class="node-send kind-dot run" title="2x">.</span><span class="node-send kind-selector_begin run" title="2x">new</span>(<span class="node-lvar kind-name run" title="2x">message</span>)</span></td></tr><tr><td id="L426" class="nb">426</td><td>          <span class="node-zsuper kind-else run" title="2380x">else</span></td></tr><tr><td id="L427" class="nb">427</td><td>            <span class="fork fork-branch fork-run " data-fork-id="12"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2380x"></i><span class="node-zsuper kind-keyword run" title="2380x">super</span></span></td></tr><tr><td id="L428" class="nb">428</td><td>          end</td></tr><tr><td id="L429" class="nb">429</td><td>        end</td></tr><tr><td id="L430" class="nb">430</td><td></td></tr><tr><td id="L431" class="nb">431</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">get_oid_type</span>(oid, fmod, column_name, sql_type = <span class="node-str kind-expression run" title="225454x">""</span><span class="node-send kind-dot run" title="225454x">.</span><span class="node-send kind-selector_begin run" title="225454x">freeze</span>)</td></tr><tr><td id="L432" class="nb">432</td><td>          <span class="fork fork-whole fork-run " data-fork-id="13"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="292515x"></i><span class="node-if kind-keyword run" title="292515x">if</span> <span class="node-send kind-selector_begin run" title="292515x">!</span><span class="node-send kind-selector_begin run" title="292515x">type_map</span><span class="node-send kind-dot run" title="292515x">.</span><span class="node-send kind-selector_begin run" title="292515x">key?</span>(<span class="node-lvar kind-name run" title="292515x">oid</span>)</span></td></tr><tr><td id="L433" class="nb">433</td><td>            <span class="fork fork-branch fork-run " data-fork-id="13"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="152x"></i><span class="node-send kind-selector_begin run" title="152x">load_additional_types</span>(<span class="node-array kind-begin run" title="152x">[</span><span class="node-lvar kind-name run" title="152x">oid</span><span class="node-array kind-end run" title="152x">]</span>)</span></td></tr><tr><td id="L434" class="nb">434</td><td>          end</td></tr><tr><td id="L435" class="nb">435</td><td></td></tr><tr><td id="L436" class="nb">436</td><td>          <span class="node-send kind-selector_begin run" title="292515x">type_map</span><span class="node-send kind-dot run" title="292515x">.</span><span class="node-send kind-selector_begin run" title="292515x">fetch</span>(<span class="node-lvar kind-name run" title="292515x">oid</span>, <span class="node-lvar kind-name run" title="292515x">fmod</span>, <span class="node-lvar kind-name run" title="292515x">sql_type</span>) {</td></tr><tr><td id="L437" class="nb">437</td><td>            <span class="node-send kind-selector_begin run" title="15x">warn</span> <span class="node-dstr kind-begin run" title="15x">"</span><span class="node-str kind-expression run" title="15x">unknown OID </span><span class="node-begin kind-begin run" title="15x">#{</span><span class="node-lvar kind-name run" title="15x">oid</span><span class="node-begin kind-end run" title="15x">}</span><span class="node-str kind-expression run" title="15x">: failed to recognize type of '</span><span class="node-begin kind-begin run" title="15x">#{</span><span class="node-lvar kind-name run" title="15x">column_name</span><span class="node-begin kind-end run" title="15x">}</span><span class="node-str kind-expression run" title="15x">'. It will be treated as String.</span><span class="node-dstr kind-end run" title="15x">"</span></td></tr><tr><td id="L438" class="nb">438</td><td>            <span class="node-const kind-name run" title="15x">Type</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">default_value</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">tap</span> do |cast_type|</td></tr><tr><td id="L439" class="nb">439</td><td>              <span class="node-send kind-selector_begin run" title="15x">type_map</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">register_type</span>(<span class="node-lvar kind-name run" title="15x">oid</span>, <span class="node-lvar kind-name run" title="15x">cast_type</span>)</td></tr><tr><td id="L440" class="nb">440</td><td>            end</td></tr><tr><td id="L441" class="nb">441</td><td>          }</td></tr><tr><td id="L442" class="nb">442</td><td>        end</td></tr><tr><td id="L443" class="nb">443</td><td></td></tr><tr><td id="L444" class="nb">444</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">initialize_type_map</span>(m = <span class="node-send kind-selector_begin run" title="804x">type_map</span>)</td></tr><tr><td id="L445" class="nb">445</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"int2"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Integer</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">limit</span><span class="node-pair kind-operator run" title="804x">:</span> <span class="node-int kind-expression run" title="804x">2</span>)</td></tr><tr><td id="L446" class="nb">446</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"int4"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Integer</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">limit</span><span class="node-pair kind-operator run" title="804x">:</span> <span class="node-int kind-expression run" title="804x">4</span>)</td></tr><tr><td id="L447" class="nb">447</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"int8"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Integer</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">limit</span><span class="node-pair kind-operator run" title="804x">:</span> <span class="node-int kind-expression run" title="804x">8</span>)</td></tr><tr><td id="L448" class="nb">448</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"oid"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Oid</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L449" class="nb">449</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"float4"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Float</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L450" class="nb">450</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">alias_type</span> <span class="node-str kind-expression run" title="804x">"float8"</span>, <span class="node-str kind-expression run" title="804x">"float4"</span></td></tr><tr><td id="L451" class="nb">451</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"text"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Text</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L452" class="nb">452</td><td>          <span class="node-send kind-selector_begin run" title="804x">register_class_with_limit</span> <span class="node-lvar kind-name run" title="804x">m</span>, <span class="node-str kind-expression run" title="804x">"varchar"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">String</span></td></tr><tr><td id="L453" class="nb">453</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">alias_type</span> <span class="node-str kind-expression run" title="804x">"char"</span>, <span class="node-str kind-expression run" title="804x">"varchar"</span></td></tr><tr><td id="L454" class="nb">454</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">alias_type</span> <span class="node-str kind-expression run" title="804x">"name"</span>, <span class="node-str kind-expression run" title="804x">"varchar"</span></td></tr><tr><td id="L455" class="nb">455</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">alias_type</span> <span class="node-str kind-expression run" title="804x">"bpchar"</span>, <span class="node-str kind-expression run" title="804x">"varchar"</span></td></tr><tr><td id="L456" class="nb">456</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"bool"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Boolean</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L457" class="nb">457</td><td>          <span class="node-send kind-selector_begin run" title="804x">register_class_with_limit</span> <span class="node-lvar kind-name run" title="804x">m</span>, <span class="node-str kind-expression run" title="804x">"bit"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Bit</span></td></tr><tr><td id="L458" class="nb">458</td><td>          <span class="node-send kind-selector_begin run" title="804x">register_class_with_limit</span> <span class="node-lvar kind-name run" title="804x">m</span>, <span class="node-str kind-expression run" title="804x">"varbit"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">BitVarying</span></td></tr><tr><td id="L459" class="nb">459</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">alias_type</span> <span class="node-str kind-expression run" title="804x">"timestamptz"</span>, <span class="node-str kind-expression run" title="804x">"timestamp"</span></td></tr><tr><td id="L460" class="nb">460</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"date"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Date</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L461" class="nb">461</td><td></td></tr><tr><td id="L462" class="nb">462</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"money"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Money</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L463" class="nb">463</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"bytea"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Bytea</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L464" class="nb">464</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"point"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Point</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L465" class="nb">465</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"hstore"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Hstore</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L466" class="nb">466</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"json"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Json</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L467" class="nb">467</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"jsonb"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Jsonb</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L468" class="nb">468</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"cidr"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Cidr</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L469" class="nb">469</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"inet"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Inet</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L470" class="nb">470</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"uuid"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Uuid</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L471" class="nb">471</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"xml"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Xml</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span></td></tr><tr><td id="L472" class="nb">472</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"tsvector"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:tsvector</span>)</td></tr><tr><td id="L473" class="nb">473</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"macaddr"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:macaddr</span>)</td></tr><tr><td id="L474" class="nb">474</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"citext"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:citext</span>)</td></tr><tr><td id="L475" class="nb">475</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"ltree"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:ltree</span>)</td></tr><tr><td id="L476" class="nb">476</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"line"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:line</span>)</td></tr><tr><td id="L477" class="nb">477</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"lseg"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:lseg</span>)</td></tr><tr><td id="L478" class="nb">478</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"box"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:box</span>)</td></tr><tr><td id="L479" class="nb">479</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"path"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:path</span>)</td></tr><tr><td id="L480" class="nb">480</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"polygon"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:polygon</span>)</td></tr><tr><td id="L481" class="nb">481</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"circle"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">SpecializedString</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">new</span>(<span class="node-sym kind-expression run" title="804x">:circle</span>)</td></tr><tr><td id="L482" class="nb">482</td><td></td></tr><tr><td id="L483" class="nb">483</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"interval"</span> do |_, _, sql_type|</td></tr><tr><td id="L484" class="nb">484</td><td>            <span class="node-lvasgn kind-name run" title="10x">precision</span> <span class="node-lvasgn kind-operator run" title="10x">=</span> <span class="node-send kind-selector_begin run" title="10x">extract_precision</span>(<span class="node-lvar kind-name run" title="10x">sql_type</span>)</td></tr><tr><td id="L485" class="nb">485</td><td>            <span class="node-const kind-name run" title="10x">OID</span><span class="node-const kind-double_colon run" title="10x">::</span><span class="node-const kind-name run" title="10x">SpecializedString</span><span class="node-send kind-dot run" title="10x">.</span><span class="node-send kind-selector_begin run" title="10x">new</span>(<span class="node-sym kind-expression run" title="10x">:interval</span>, <span class="node-sym kind-expression run" title="10x">precision</span><span class="node-pair kind-operator run" title="10x">:</span> <span class="node-lvar kind-name run" title="10x">precision</span>)</td></tr><tr><td id="L486" class="nb">486</td><td>          end</td></tr><tr><td id="L487" class="nb">487</td><td></td></tr><tr><td id="L488" class="nb">488</td><td>          <span class="node-send kind-selector_begin run" title="804x">register_class_with_precision</span> <span class="node-lvar kind-name run" title="804x">m</span>, <span class="node-str kind-expression run" title="804x">"time"</span>, <span class="node-const kind-name run" title="804x">Type</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">Time</span></td></tr><tr><td id="L489" class="nb">489</td><td>          <span class="node-send kind-selector_begin run" title="804x">register_class_with_precision</span> <span class="node-lvar kind-name run" title="804x">m</span>, <span class="node-str kind-expression run" title="804x">"timestamp"</span>, <span class="node-const kind-name run" title="804x">OID</span><span class="node-const kind-double_colon run" title="804x">::</span><span class="node-const kind-name run" title="804x">DateTime</span></td></tr><tr><td id="L490" class="nb">490</td><td></td></tr><tr><td id="L491" class="nb">491</td><td>          <span class="node-lvar kind-name run" title="804x">m</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">register_type</span> <span class="node-str kind-expression run" title="804x">"numeric"</span> do |_, fmod, sql_type|</td></tr><tr><td id="L492" class="nb">492</td><td>            <span class="node-lvasgn kind-name run" title="589x">precision</span> <span class="node-lvasgn kind-operator run" title="589x">=</span> <span class="node-send kind-selector_begin run" title="589x">extract_precision</span>(<span class="node-lvar kind-name run" title="589x">sql_type</span>)</td></tr><tr><td id="L493" class="nb">493</td><td>            <span class="node-lvasgn kind-name run" title="589x">scale</span> <span class="node-lvasgn kind-operator run" title="589x">=</span> <span class="node-send kind-selector_begin run" title="589x">extract_scale</span>(<span class="node-lvar kind-name run" title="589x">sql_type</span>)</td></tr><tr><td id="L494" class="nb">494</td><td></td></tr><tr><td id="L495" class="nb">495</td><td>            # The type for the numeric depends on the width of the field,</td></tr><tr><td id="L496" class="nb">496</td><td>            # so we'll do something special here.</td></tr><tr><td id="L497" class="nb">497</td><td>            #</td></tr><tr><td id="L498" class="nb">498</td><td>            # When dealing with decimal columns:</td></tr><tr><td id="L499" class="nb">499</td><td>            #</td></tr><tr><td id="L500" class="nb">500</td><td>            # places after decimal  = fmod - 4 &amp; 0xffff</td></tr><tr><td id="L501" class="nb">501</td><td>            # places before decimal = (fmod - 4) &gt;&gt; 16 &amp; 0xffff</td></tr><tr><td id="L502" class="nb">502</td><td>            <span class="fork fork-whole fork-run " data-fork-id="14"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="589x"></i><span class="node-if kind-keyword run" title="589x">if</span> <span class="fork fork-whole fork-run " data-fork-id="15"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="589x"></i><span class="node-lvar kind-name run" title="589x">fmod</span> <span class="node-and kind-operator run" title="589x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="15"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="522x"></i>(<span class="node-lvar kind-name run" title="522x">fmod</span> <span class="node-send kind-selector_begin run" title="522x">-</span> <span class="node-int kind-expression run" title="522x">4</span> <span class="node-send kind-selector_begin run" title="522x">&amp;</span> <span class="node-int kind-expression run" title="522x">0xffff</span>)<span class="node-send kind-dot run" title="522x">.</span><span class="node-send kind-selector_begin run" title="522x">zero?</span></span></span></span></td></tr><tr><td id="L503" class="nb">503</td><td>              # FIXME: Remove this class, and the second argument to</td></tr><tr><td id="L504" class="nb">504</td><td>              # lookups on PG</td></tr><tr><td id="L505" class="nb">505</td><td>              <span class="fork fork-branch fork-run " data-fork-id="14"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="39x"></i><span class="node-const kind-name run" title="39x">Type</span><span class="node-const kind-double_colon run" title="39x">::</span><span class="node-const kind-name run" title="39x">DecimalWithoutScale</span><span class="node-send kind-dot run" title="39x">.</span><span class="node-send kind-selector_begin run" title="39x">new</span>(<span class="node-sym kind-expression run" title="39x">precision</span><span class="node-pair kind-operator run" title="39x">:</span> <span class="node-lvar kind-name run" title="39x">precision</span>)</span></td></tr><tr><td id="L506" class="nb">506</td><td>            <span class="node-send kind-else run" title="550x">else</span></td></tr><tr><td id="L507" class="nb">507</td><td>              <span class="fork fork-branch fork-run " data-fork-id="14"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="550x"></i><span class="node-const kind-name run" title="550x">OID</span><span class="node-const kind-double_colon run" title="550x">::</span><span class="node-const kind-name run" title="550x">Decimal</span><span class="node-send kind-dot run" title="550x">.</span><span class="node-send kind-selector_begin run" title="550x">new</span>(<span class="node-sym kind-expression run" title="550x">precision</span><span class="node-pair kind-operator run" title="550x">:</span> <span class="node-lvar kind-name run" title="550x">precision</span>, <span class="node-sym kind-expression run" title="550x">scale</span><span class="node-pair kind-operator run" title="550x">:</span> <span class="node-lvar kind-name run" title="550x">scale</span>)</span></td></tr><tr><td id="L508" class="nb">508</td><td>            end</td></tr><tr><td id="L509" class="nb">509</td><td>          end</td></tr><tr><td id="L510" class="nb">510</td><td></td></tr><tr><td id="L511" class="nb">511</td><td>          <span class="node-send kind-selector_begin run" title="804x">load_additional_types</span></td></tr><tr><td id="L512" class="nb">512</td><td>        end</td></tr><tr><td id="L513" class="nb">513</td><td></td></tr><tr><td id="L514" class="nb">514</td><td>        # Extracts the value from a PostgreSQL column default definition.</td></tr><tr><td id="L515" class="nb">515</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">extract_value_from_default</span>(default)</td></tr><tr><td id="L516" class="nb">516</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1 when clause not covered"></i><span class="node-case kind-keyword run" title="67061x">case</span> <span class="node-lvar kind-name run" title="67061x">default</span></span></td></tr><tr><td id="L517" class="nb">517</td><td>            # Quoted types</td></tr><tr><td id="L518" class="nb">518</td><td>          <span class="node-when kind-keyword run" title="67061x">when</span> <span class="node-regexp kind-begin run" title="67061x">/</span><span class="node-str kind-expression run" title="67061x">\A[\(B]?'(.*)'.*::"?([\w. ]+)"?(?:\[\])?\z</span><span class="node-regexp kind-end run" title="67061x">/</span><span class="node-regopt kind-expression run" title="67061x">m</span></td></tr><tr><td id="L519" class="nb">519</td><td>            # The default 'now'::date is CURRENT_DATE</td></tr><tr><td id="L520" class="nb">520</td><td>            <span class="fork fork-whole fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1125x"></i><span class="fork fork-branch fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1125x"></i><span class="node-if kind-keyword run" title="1125x">if</span> <span class="fork fork-whole fork-run " data-fork-id="18"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1125x"></i>$1 <span class="node-send kind-selector_begin run" title="1125x">==</span> <span class="node-str kind-expression run" title="1125x">"now"</span><span class="node-send kind-dot run" title="1125x">.</span><span class="node-send kind-selector_begin run" title="1125x">freeze</span> <span class="node-and kind-operator run" title="1125x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="18"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="39x"></i>$2 <span class="node-send kind-selector_begin run" title="39x">==</span> <span class="node-str kind-expression run" title="39x">"date"</span><span class="node-send kind-dot run" title="39x">.</span><span class="node-send kind-selector_begin run" title="39x">freeze</span></span></span></span></span></td></tr><tr><td id="L521" class="nb">521</td><td>              <span class="fork fork-branch fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="39x"></i><span class="node-nil kind-expression run" title="39x">nil</span></span></td></tr><tr><td id="L522" class="nb">522</td><td>            <span class="node-send kind-else run" title="1086x">else</span></td></tr><tr><td id="L523" class="nb">523</td><td>              <span class="fork fork-branch fork-run " data-fork-id="17"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="1086x"></i>$1<span class="node-send kind-dot run" title="1086x">.</span><span class="node-send kind-selector_begin run" title="1086x">gsub</span>(<span class="node-str kind-expression run" title="1086x">"''"</span><span class="node-send kind-dot run" title="1086x">.</span><span class="node-send kind-selector_begin run" title="1086x">freeze</span>, <span class="node-str kind-expression run" title="1086x">"'"</span><span class="node-send kind-dot run" title="1086x">.</span><span class="node-send kind-selector_begin run" title="1086x">freeze</span>)</span></td></tr><tr><td id="L524" class="nb">524</td><td>            end</td></tr><tr><td id="L525" class="nb">525</td><td>            # Boolean types</td></tr><tr><td id="L526" class="nb">526</td><td>          <span class="node-when kind-keyword run" title="65936x">when</span> <span class="node-str kind-expression run" title="65936x">"true"</span><span class="node-send kind-dot run" title="65936x">.</span><span class="node-send kind-selector_begin run" title="65936x">freeze</span>, <span class="node-str kind-expression run" title="65296x">"false"</span><span class="node-send kind-dot run" title="65296x">.</span><span class="node-send kind-selector_begin run" title="65296x">freeze</span></td></tr><tr><td id="L527" class="nb">527</td><td>            <span class="fork fork-branch fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="895x"></i><span class="node-lvar kind-name run" title="895x">default</span></span></td></tr><tr><td id="L528" class="nb">528</td><td>            # Numeric types</td></tr><tr><td id="L529" class="nb">529</td><td>          <span class="node-when kind-keyword run" title="65041x">when</span> <span class="node-regexp kind-begin run" title="65041x">/</span><span class="node-str kind-expression run" title="65041x">\A\(?(-?\d+(\.\d*)?)\)?(::bigint)?\z</span><span class="node-regexp kind-end run" title="65041x">/</span><span class="node-regopt kind-expression run" title="65041x"></span></td></tr><tr><td id="L530" class="nb">530</td><td>            <span class="fork fork-branch fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="8399x"></i>$1</span></td></tr><tr><td id="L531" class="nb">531</td><td>            # Object identifier types</td></tr><tr><td id="L532" class="nb">532</td><td>          <span class="node-when kind-keyword run" title="56642x">when</span> <span class="node-regexp kind-begin run" title="56642x">/</span><span class="node-str kind-expression run" title="56642x">\A-?\d+\z</span><span class="node-regexp kind-end run" title="56642x">/</span><span class="node-regopt kind-expression run" title="56642x"></span></td></tr><tr><td id="L533" class="nb">533</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i>$1</span></td></tr><tr><td id="L534" class="nb">534</td><td>          <span class="node-nil kind-else run" title="56642x">else</span></td></tr><tr><td id="L535" class="nb">535</td><td>            # Anything else is blank, some user type, or some function</td></tr><tr><td id="L536" class="nb">536</td><td>            # and we can't know the value of that, so return nil.</td></tr><tr><td id="L537" class="nb">537</td><td>            <span class="fork fork-branch fork-run " data-fork-id="16"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="56642x"></i><span class="node-nil kind-expression run" title="56642x">nil</span></span></td></tr><tr><td id="L538" class="nb">538</td><td>          end</td></tr><tr><td id="L539" class="nb">539</td><td>        end</td></tr><tr><td id="L540" class="nb">540</td><td></td></tr><tr><td id="L541" class="nb">541</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">extract_default_function</span>(default_value, default)</td></tr><tr><td id="L542" class="nb">542</td><td>          <span class="fork fork-whole fork-run " data-fork-id="19"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="67061x"></i><span class="fork fork-branch fork-run " data-fork-id="19"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="11460x"></i><span class="node-lvar kind-name run" title="11460x">default</span></span> <span class="node-if kind-keyword run" title="67061x">if</span> <span class="node-send kind-selector_begin run" title="67061x">has_default_function?</span>(<span class="node-lvar kind-name run" title="67061x">default_value</span>, <span class="node-lvar kind-name run" title="67061x">default</span>)</span></td></tr><tr><td id="L543" class="nb">543</td><td>        end</td></tr><tr><td id="L544" class="nb">544</td><td></td></tr><tr><td id="L545" class="nb">545</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">has_default_function?</span>(default_value, default)</td></tr><tr><td id="L546" class="nb">546</td><td>          <span class="fork fork-whole fork-run " data-fork-id="20"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="67061x"></i><span class="node-send kind-selector_begin run" title="67061x">!</span><span class="node-lvar kind-name run" title="67061x">default_value</span> <span class="node-and kind-operator run" title="67061x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="20"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="56681x"></i><span class="node-regexp kind-begin run" title="56681x">%r{</span><span class="node-str kind-expression run" title="56681x">\w+\(.*\)|\(.*\)::\w+|CURRENT_DATE|CURRENT_TIMESTAMP</span><span class="node-regexp kind-end run" title="56681x">}</span><span class="node-regopt kind-expression run" title="56681x"></span><span class="node-send kind-dot run" title="56681x">.</span><span class="node-send kind-selector_begin run" title="56681x">match?</span>(<span class="node-lvar kind-name run" title="56681x">default</span>)</span></span></td></tr><tr><td id="L547" class="nb">547</td><td>        end</td></tr><tr><td id="L548" class="nb">548</td><td></td></tr><tr><td id="L549" class="nb">549</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">load_additional_types</span>(oids = <span class="node-nil kind-expression run" title="804x">nil</span>)</td></tr><tr><td id="L550" class="nb">550</td><td>          <span class="node-lvasgn kind-name run" title="956x">initializer</span> <span class="node-lvasgn kind-operator run" title="956x">=</span> <span class="node-const kind-name run" title="956x">OID</span><span class="node-const kind-double_colon run" title="956x">::</span><span class="node-const kind-name run" title="956x">TypeMapInitializer</span><span class="node-send kind-dot run" title="956x">.</span><span class="node-send kind-selector_begin run" title="956x">new</span>(<span class="node-send kind-selector_begin run" title="956x">type_map</span>)</td></tr><tr><td id="L551" class="nb">551</td><td></td></tr><tr><td id="L552" class="nb">552</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="node-if kind-keyword run" title="956x">if</span> <span class="node-send kind-selector_begin run" title="956x">supports_ranges?</span></span></td></tr><tr><td id="L553" class="nb">553</td><td>            <span class="fork fork-branch fork-run " data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="956x"></i><span class="node-lvasgn kind-name run" title="956x">query</span> <span class="node-lvasgn kind-operator run" title="956x">=</span> <span class="node-dstr kind-expression run" title="956x">&lt;&lt;-SQL</span></span></td></tr><tr><td id="L554" class="nb">554</td><td><span class="node-str kind-expression run" title="956x">              SELECT t.oid, t.typname, t.typelem, t.typdelim, t.typinput, r.rngsubtype, t.typtype, t.typbasetype</span></td></tr><tr><td id="L555" class="nb">555</td><td><span class="node-str kind-expression run" title="956x">              FROM pg_type as t</span></td></tr><tr><td id="L556" class="nb">556</td><td><span class="node-str kind-expression run" title="956x">              LEFT JOIN pg_range as r ON oid = rngtypid</span></td></tr><tr><td id="L557" class="nb">557</td><td><span class="node-dstr kind-heredoc_end run" title="956x">            SQL</span></td></tr><tr><td id="L558" class="nb">558</td><td>          <span class="node-lvasgn kind-else not-run" title="never run">else</span></td></tr><tr><td id="L559" class="nb">559</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="21"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-lvasgn kind-name not-run" title="never run">query</span> <span class="node-lvasgn kind-operator not-run" title="never run">=</span> <span class="node-dstr kind-expression not-run" title="never run">&lt;&lt;-SQL</span></span></td></tr><tr><td id="L560" class="nb">560</td><td><span class="node-str kind-expression not-run" title="never run">              SELECT t.oid, t.typname, t.typelem, t.typdelim, t.typinput, t.typtype, t.typbasetype</span></td></tr><tr><td id="L561" class="nb">561</td><td><span class="node-str kind-expression not-run" title="never run">              FROM pg_type as t</span></td></tr><tr><td id="L562" class="nb">562</td><td><span class="node-dstr kind-heredoc_end not-run" title="never run">            SQL</span></td></tr><tr><td id="L563" class="nb">563</td><td>          end</td></tr><tr><td id="L564" class="nb">564</td><td></td></tr><tr><td id="L565" class="nb">565</td><td>          <span class="fork fork-whole fork-run " data-fork-id="22"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="956x"></i><span class="node-if kind-keyword run" title="956x">if</span> <span class="node-lvar kind-name run" title="956x">oids</span></span></td></tr><tr><td id="L566" class="nb">566</td><td>            <span class="fork fork-branch fork-run " data-fork-id="22"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="152x"></i><span class="node-lvasgn kind-name run" title="152x">query</span> <span class="node-op_asgn kind-operator run" title="152x">+=</span> <span class="node-str kind-expression run" title="152x">"WHERE t.oid::integer IN (%s)"</span> <span class="node-send kind-selector_begin run" title="152x">%</span> <span class="node-lvar kind-name run" title="152x">oids</span><span class="node-send kind-dot run" title="152x">.</span><span class="node-send kind-selector_begin run" title="152x">join</span>(<span class="node-str kind-expression run" title="152x">", "</span>)</span></td></tr><tr><td id="L567" class="nb">567</td><td>          <span class="node-op_asgn kind-else run" title="804x">else</span></td></tr><tr><td id="L568" class="nb">568</td><td>            <span class="fork fork-branch fork-run " data-fork-id="22"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="804x"></i><span class="node-lvasgn kind-name run" title="804x">query</span> <span class="node-op_asgn kind-operator run" title="804x">+=</span> <span class="node-lvar kind-name run" title="804x">initializer</span><span class="node-send kind-dot run" title="804x">.</span><span class="node-send kind-selector_begin run" title="804x">query_conditions_for_initial_load</span></span></td></tr><tr><td id="L569" class="nb">569</td><td>          end</td></tr><tr><td id="L570" class="nb">570</td><td></td></tr><tr><td id="L571" class="nb">571</td><td>          <span class="node-send kind-selector_begin run" title="956x">execute_and_clear</span>(<span class="node-lvar kind-name run" title="956x">query</span>, <span class="node-str kind-expression run" title="956x">"SCHEMA"</span>, <span class="node-array kind-begin run" title="956x">[</span><span class="node-array kind-end run" title="956x">]</span>) do |records|</td></tr><tr><td id="L572" class="nb">572</td><td>            <span class="node-lvar kind-name run" title="956x">initializer</span><span class="node-send kind-dot run" title="956x">.</span><span class="node-send kind-selector_begin run" title="956x">run</span>(<span class="node-lvar kind-name run" title="956x">records</span>)</td></tr><tr><td id="L573" class="nb">573</td><td>          end</td></tr><tr><td id="L574" class="nb">574</td><td>        end</td></tr><tr><td id="L575" class="nb">575</td><td></td></tr><tr><td id="L576" class="nb">576</td><td>        <span class="node-casgn kind-name run" title="3x">FEATURE_NOT_SUPPORTED</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"0A000"</span> #:nodoc:</td></tr><tr><td id="L577" class="nb">577</td><td></td></tr><tr><td id="L578" class="nb">578</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">execute_and_clear</span>(sql, name, binds, prepare: <span class="node-false kind-expression run" title="9708x">false</span>)</td></tr><tr><td id="L579" class="nb">579</td><td>          <span class="fork fork-whole fork-run " data-fork-id="23"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="46215x"></i><span class="node-if kind-keyword run" title="46215x">if</span> <span class="node-send kind-selector_begin run" title="46215x">without_prepared_statement?</span>(<span class="node-lvar kind-name run" title="46215x">binds</span>)</span></td></tr><tr><td id="L580" class="nb">580</td><td>            <span class="fork fork-branch fork-run " data-fork-id="23"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="17298x"></i><span class="node-lvasgn kind-name run" title="17298x">result</span> <span class="node-lvasgn kind-operator run" title="17298x">=</span> <span class="node-send kind-selector_begin run" title="17328x">exec_no_cache</span>(<span class="node-lvar kind-name run" title="17328x">sql</span>, <span class="node-lvar kind-name run" title="17328x">name</span>, <span class="node-array kind-begin run" title="17328x">[</span><span class="node-array kind-end run" title="17328x">]</span>)</span></td></tr><tr><td id="L581" class="nb">581</td><td>          <span class="fork fork-whole fork-run " data-fork-id="24"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="28887x"></i><span class="fork fork-branch fork-run " data-fork-id="23"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="28887x"></i><span class="node-if kind-else run" title="28887x"><span class="node-if kind-keyword run" title="28887x">elsif</span></span> <span class="node-send kind-selector_begin run" title="28887x">!</span><span class="node-lvar kind-name run" title="28887x">prepare</span></span></span></td></tr><tr><td id="L582" class="nb">582</td><td>            <span class="fork fork-branch fork-run " data-fork-id="24"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="14408x"></i><span class="node-lvasgn kind-name run" title="14408x">result</span> <span class="node-lvasgn kind-operator run" title="14408x">=</span> <span class="node-send kind-selector_begin run" title="14435x">exec_no_cache</span>(<span class="node-lvar kind-name run" title="14435x">sql</span>, <span class="node-lvar kind-name run" title="14435x">name</span>, <span class="node-lvar kind-name run" title="14435x">binds</span>)</span></td></tr><tr><td id="L583" class="nb">583</td><td>          <span class="node-lvasgn kind-else run" title="14427x">else</span></td></tr><tr><td id="L584" class="nb">584</td><td>            <span class="fork fork-branch fork-run " data-fork-id="24"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="14427x"></i><span class="node-lvasgn kind-name run" title="14427x">result</span> <span class="node-lvasgn kind-operator run" title="14427x">=</span> <span class="node-send kind-selector_begin run" title="14452x">exec_cache</span>(<span class="node-lvar kind-name run" title="14452x">sql</span>, <span class="node-lvar kind-name run" title="14452x">name</span>, <span class="node-lvar kind-name run" title="14452x">binds</span>)</span></td></tr><tr><td id="L585" class="nb">585</td><td>          end</td></tr><tr><td id="L586" class="nb">586</td><td>          <span class="node-lvasgn kind-name run" title="46133x">ret</span> <span class="node-lvasgn kind-operator run" title="46133x">=</span> <span class="node-yield kind-keyword run" title="46133x">yield</span> <span class="node-lvar kind-name run" title="46133x">result</span></td></tr><tr><td id="L587" class="nb">587</td><td>          <span class="node-lvar kind-name run" title="46133x">result</span><span class="node-send kind-dot run" title="46133x">.</span><span class="node-send kind-selector_begin run" title="46133x">clear</span></td></tr><tr><td id="L588" class="nb">588</td><td>          <span class="node-lvar kind-name run" title="46133x">ret</span></td></tr><tr><td id="L589" class="nb">589</td><td>        end</td></tr><tr><td id="L590" class="nb">590</td><td></td></tr><tr><td id="L591" class="nb">591</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">exec_no_cache</span>(sql, name, binds)</td></tr><tr><td id="L592" class="nb">592</td><td>          <span class="node-lvasgn kind-name run" title="31760x">type_casted_binds</span> <span class="node-lvasgn kind-operator run" title="31760x">=</span> <span class="node-send kind-selector_begin run" title="31763x">type_casted_binds</span>(<span class="node-lvar kind-name run" title="31763x">binds</span>)</td></tr><tr><td id="L593" class="nb">593</td><td>          <span class="node-send kind-selector_begin run" title="31760x">log</span>(<span class="node-lvar kind-name run" title="31760x">sql</span>, <span class="node-lvar kind-name run" title="31760x">name</span>, <span class="node-lvar kind-name run" title="31760x">binds</span>, <span class="node-lvar kind-name run" title="31760x">type_casted_binds</span>) do</td></tr><tr><td id="L594" class="nb">594</td><td>            <span class="node-const kind-name run" title="31760x">ActiveSupport</span><span class="node-const kind-double_colon run" title="31760x">::</span><span class="node-const kind-name run" title="31760x">Dependencies</span><span class="node-send kind-dot run" title="31760x">.</span><span class="node-send kind-selector_begin run" title="31760x">interlock</span><span class="node-send kind-dot run" title="31760x">.</span><span class="node-send kind-selector_begin run" title="31760x">permit_concurrent_loads</span> do</td></tr><tr><td id="L595" class="nb">595</td><td>              <span class="node-ivar kind-name run" title="31760x">@connection</span><span class="node-send kind-dot run" title="31760x">.</span><span class="node-send kind-selector_begin run" title="31760x">async_exec</span>(<span class="node-lvar kind-name run" title="31760x">sql</span>, <span class="node-lvar kind-name run" title="31760x">type_casted_binds</span>)</td></tr><tr><td id="L596" class="nb">596</td><td>            end</td></tr><tr><td id="L597" class="nb">597</td><td>          end</td></tr><tr><td id="L598" class="nb">598</td><td>        end</td></tr><tr><td id="L599" class="nb">599</td><td></td></tr><tr><td id="L600" class="nb">600</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">exec_cache</span>(sql, name, binds)</td></tr><tr><td id="L601" class="nb">601</td><td>          <span class="node-lvasgn kind-name run" title="14442x">stmt_key</span> <span class="node-lvasgn kind-operator run" title="14442x">=</span> <span class="node-send kind-selector_begin run" title="14452x">prepare_statement</span>(<span class="node-lvar kind-name run" title="14452x">sql</span>)</td></tr><tr><td id="L602" class="nb">602</td><td>          <span class="node-lvasgn kind-name run" title="14439x">type_casted_binds</span> <span class="node-lvasgn kind-operator run" title="14439x">=</span> <span class="node-send kind-selector_begin run" title="14442x">type_casted_binds</span>(<span class="node-lvar kind-name run" title="14442x">binds</span>)</td></tr><tr><td id="L603" class="nb">603</td><td></td></tr><tr><td id="L604" class="nb">604</td><td>          <span class="node-send kind-selector_begin run" title="14439x">log</span>(<span class="node-lvar kind-name run" title="14439x">sql</span>, <span class="node-lvar kind-name run" title="14439x">name</span>, <span class="node-lvar kind-name run" title="14439x">binds</span>, <span class="node-lvar kind-name run" title="14439x">type_casted_binds</span>, <span class="node-lvar kind-name run" title="14439x">stmt_key</span>) do</td></tr><tr><td id="L605" class="nb">605</td><td>            <span class="node-const kind-name run" title="14439x">ActiveSupport</span><span class="node-const kind-double_colon run" title="14439x">::</span><span class="node-const kind-name run" title="14439x">Dependencies</span><span class="node-send kind-dot run" title="14439x">.</span><span class="node-send kind-selector_begin run" title="14439x">interlock</span><span class="node-send kind-dot run" title="14439x">.</span><span class="node-send kind-selector_begin run" title="14439x">permit_concurrent_loads</span> do</td></tr><tr><td id="L606" class="nb">606</td><td>              <span class="node-ivar kind-name run" title="14439x">@connection</span><span class="node-send kind-dot run" title="14439x">.</span><span class="node-send kind-selector_begin run" title="14439x">exec_prepared</span>(<span class="node-lvar kind-name run" title="14439x">stmt_key</span>, <span class="node-lvar kind-name run" title="14439x">type_casted_binds</span>)</td></tr><tr><td id="L607" class="nb">607</td><td>            end</td></tr><tr><td id="L608" class="nb">608</td><td>          end</td></tr><tr><td id="L609" class="nb">609</td><td>        <span class="node-resbody kind-keyword run" title="20x">rescue</span> <span class="node-const kind-name run" title="25x">ActiveRecord</span><span class="node-const kind-double_colon run" title="25x">::</span><span class="node-const kind-name run" title="25x">StatementInvalid</span> <span class="node-resbody kind-assoc run" title="20x">=&gt;</span> <span class="node-lvasgn kind-name run" title="20x">e</span></td></tr><tr><td id="L610" class="nb">610</td><td>          <span class="fork fork-whole fork-run " data-fork-id="25"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="20x"></i><span class="fork fork-branch fork-run " data-fork-id="25"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="16x"></i><span class="node-send kind-selector_begin run" title="16x">raise</span></span> <span class="node-if kind-keyword run" title="20x">unless</span> <span class="node-send kind-selector_begin run" title="20x">is_cached_plan_failure?</span>(<span class="node-lvar kind-name run" title="20x">e</span>)</span></td></tr><tr><td id="L611" class="nb">611</td><td></td></tr><tr><td id="L612" class="nb">612</td><td>          # Nothing we can do if we are in a transaction because all commands</td></tr><tr><td id="L613" class="nb">613</td><td>          # will raise InFailedSQLTransaction</td></tr><tr><td id="L614" class="nb">614</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="26"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="node-if kind-keyword run" title="4x">if</span> <span class="node-send kind-selector_begin run" title="4x">in_transaction?</span></span></td></tr><tr><td id="L615" class="nb">615</td><td>            <span class="fork fork-branch fork-run " data-fork-id="26"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4x"></i><span class="node-send kind-selector_begin run" title="4x">raise</span> <span class="node-const kind-name run" title="4x">ActiveRecord</span><span class="node-const kind-double_colon run" title="4x">::</span><span class="node-const kind-name run" title="4x">PreparedStatementCacheExpired</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">new</span>(<span class="node-lvar kind-name run" title="4x">e</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">cause</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">message</span>)</span></td></tr><tr><td id="L616" class="nb">616</td><td>          <span class="node-begin kind-else not-run" title="never run">else</span></td></tr><tr><td id="L617" class="nb">617</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="26"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-ivar kind-name not-run" title="never run">@lock</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">synchronize</span> do</span></td></tr><tr><td id="L618" class="nb">618</td><td>              # outside of transactions we can simply flush this query and retry</td></tr><tr><td id="L619" class="nb">619</td><td>              <span class="node-ivar kind-name not-run" title="never run">@statements</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">delete</span> <span class="node-send kind-selector_begin not-run" title="never run">sql_key</span>(<span class="node-lvar kind-name not-run" title="never run">sql</span>)</td></tr><tr><td id="L620" class="nb">620</td><td>            end</td></tr><tr><td id="L621" class="nb">621</td><td>            <span class="node-retry kind-keyword not-run" title="never run">retry</span></td></tr><tr><td id="L622" class="nb">622</td><td>          end</td></tr><tr><td id="L623" class="nb">623</td><td>        end</td></tr><tr><td id="L624" class="nb">624</td><td></td></tr><tr><td id="L625" class="nb">625</td><td>        # Annoyingly, the code for prepared statements whose return value may</td></tr><tr><td id="L626" class="nb">626</td><td>        # have changed is FEATURE_NOT_SUPPORTED.</td></tr><tr><td id="L627" class="nb">627</td><td>        #</td></tr><tr><td id="L628" class="nb">628</td><td>        # This covers various different error types so we need to do additional</td></tr><tr><td id="L629" class="nb">629</td><td>        # work to classify the exception definitively as a</td></tr><tr><td id="L630" class="nb">630</td><td>        # ActiveRecord::PreparedStatementCacheExpired</td></tr><tr><td id="L631" class="nb">631</td><td>        #</td></tr><tr><td id="L632" class="nb">632</td><td>        # Check here for more details:</td></tr><tr><td id="L633" class="nb">633</td><td>        # https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/cache/plancache.c#l573</td></tr><tr><td id="L634" class="nb">634</td><td>        <span class="node-casgn kind-name run" title="3x">CACHED_PLAN_HEURISTIC</span> <span class="node-casgn kind-operator run" title="3x">=</span> <span class="node-str kind-expression run" title="3x">"cached plan must not change result type"</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">freeze</span></td></tr><tr><td id="L635" class="nb">635</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">is_cached_plan_failure?</span>(e)</td></tr><tr><td id="L636" class="nb">636</td><td>          <span class="node-lvasgn kind-name run" title="20x">pgerror</span> <span class="node-lvasgn kind-operator run" title="20x">=</span> <span class="node-lvar kind-name run" title="20x">e</span><span class="node-send kind-dot run" title="20x">.</span><span class="node-send kind-selector_begin run" title="20x">cause</span></td></tr><tr><td id="L637" class="nb">637</td><td>          <span class="node-lvasgn kind-name run" title="20x">code</span> <span class="node-lvasgn kind-operator run" title="20x">=</span> <span class="node-lvar kind-name run" title="20x">pgerror</span><span class="node-send kind-dot run" title="20x">.</span><span class="node-send kind-selector_begin run" title="20x">result</span><span class="node-send kind-dot run" title="20x">.</span><span class="node-send kind-selector_begin run" title="20x">result_error_field</span>(<span class="node-const kind-name run" title="20x">PG</span><span class="node-const kind-double_colon run" title="20x">::</span><span class="node-const kind-name run" title="20x">PG_DIAG_SQLSTATE</span>)</td></tr><tr><td id="L638" class="nb">638</td><td>          <span class="fork fork-whole fork-run " data-fork-id="27"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="20x"></i><span class="node-lvar kind-name run" title="20x">code</span> <span class="node-send kind-selector_begin run" title="20x">==</span> <span class="node-const kind-name run" title="20x">FEATURE_NOT_SUPPORTED</span> <span class="node-and kind-operator run" title="20x">&amp;&amp;</span> <span class="fork fork-branch fork-run " data-fork-id="27"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="4x"></i><span class="node-lvar kind-name run" title="4x">pgerror</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">message</span><span class="node-send kind-dot run" title="4x">.</span><span class="node-send kind-selector_begin run" title="4x">include?</span>(<span class="node-const kind-name run" title="4x">CACHED_PLAN_HEURISTIC</span>)</span></span></td></tr><tr><td id="L639" class="nb">639</td><td>        <span class="node-resbody kind-keyword not-run" title="never run">rescue</span></td></tr><tr><td id="L640" class="nb">640</td><td>          <span class="node-false kind-expression not-run" title="never run">false</span></td></tr><tr><td id="L641" class="nb">641</td><td>        end</td></tr><tr><td id="L642" class="nb">642</td><td></td></tr><tr><td id="L643" class="nb">643</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">in_transaction?</span></td></tr><tr><td id="L644" class="nb">644</td><td>          <span class="node-send kind-selector_begin run" title="4x">open_transactions</span> <span class="node-send kind-selector_begin run" title="4x">&gt;</span> <span class="node-int kind-expression run" title="4x">0</span></td></tr><tr><td id="L645" class="nb">645</td><td>        end</td></tr><tr><td id="L646" class="nb">646</td><td></td></tr><tr><td id="L647" class="nb">647</td><td>        # Returns the statement identifier for the client side cache</td></tr><tr><td id="L648" class="nb">648</td><td>        # of statements</td></tr><tr><td id="L649" class="nb">649</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">sql_key</span>(sql)</td></tr><tr><td id="L650" class="nb">650</td><td>          <span class="node-dstr kind-begin run" title="14452x">"</span><span class="node-begin kind-begin run" title="14452x">#{</span><span class="node-send kind-selector_begin run" title="14452x">schema_search_path</span><span class="node-begin kind-end run" title="14452x">}</span><span class="node-str kind-expression run" title="14452x">-</span><span class="node-begin kind-begin run" title="14452x">#{</span><span class="node-lvar kind-name run" title="14452x">sql</span><span class="node-begin kind-end run" title="14452x">}</span><span class="node-dstr kind-end run" title="14452x">"</span></td></tr><tr><td id="L651" class="nb">651</td><td>        end</td></tr><tr><td id="L652" class="nb">652</td><td></td></tr><tr><td id="L653" class="nb">653</td><td>        # Prepare the statement if it hasn't been prepared, return</td></tr><tr><td id="L654" class="nb">654</td><td>        # the statement key.</td></tr><tr><td id="L655" class="nb">655</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">prepare_statement</span>(sql)</td></tr><tr><td id="L656" class="nb">656</td><td>          <span class="node-ivar kind-name run" title="14452x">@lock</span><span class="node-send kind-dot run" title="14452x">.</span><span class="node-send kind-selector_begin run" title="14452x">synchronize</span> do</td></tr><tr><td id="L657" class="nb">657</td><td>            <span class="node-lvasgn kind-name run" title="14452x">sql_key</span> <span class="node-lvasgn kind-operator run" title="14452x">=</span> <span class="node-send kind-selector_begin run" title="14452x">sql_key</span>(<span class="node-lvar kind-name run" title="14452x">sql</span>)</td></tr><tr><td id="L658" class="nb">658</td><td>            <span class="fork fork-whole fork-run " data-fork-id="28"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="14452x"></i><span class="node-if kind-keyword run" title="14452x">unless</span> <span class="node-ivar kind-name run" title="14452x">@statements</span><span class="node-send kind-dot run" title="14452x">.</span><span class="node-send kind-selector_begin run" title="14452x">key?</span> <span class="node-lvar kind-name run" title="14452x">sql_key</span></span></td></tr><tr><td id="L659" class="nb">659</td><td>              <span class="fork fork-branch fork-run " data-fork-id="28"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2846x"></i><span class="node-lvasgn kind-name run" title="2846x">nextkey</span> <span class="node-lvasgn kind-operator run" title="2846x">=</span> <span class="node-ivar kind-name run" title="2846x">@statements</span><span class="node-send kind-dot run" title="2846x">.</span><span class="node-send kind-selector_begin run" title="2846x">next_key</span></span></td></tr><tr><td id="L660" class="nb">660</td><td>              <span class="node-kwbegin kind-begin run" title="2846x">begin</span></td></tr><tr><td id="L661" class="nb">661</td><td>                <span class="node-ivar kind-name run" title="2846x">@connection</span><span class="node-send kind-dot run" title="2846x">.</span><span class="node-send kind-selector_begin run" title="2846x">prepare</span> <span class="node-lvar kind-name run" title="2846x">nextkey</span>, <span class="node-lvar kind-name run" title="2846x">sql</span></td></tr><tr><td id="L662" class="nb">662</td><td>              <span class="node-resbody kind-keyword run" title="10x">rescue</span> <span class="node-resbody kind-assoc run" title="10x">=&gt;</span> <span class="node-lvasgn kind-name run" title="10x">e</span></td></tr><tr><td id="L663" class="nb">663</td><td>                <span class="node-send kind-selector_begin run" title="10x">raise</span> <span class="node-send kind-selector_begin run" title="10x">translate_exception_class</span>(<span class="node-lvar kind-name run" title="10x">e</span>, <span class="node-lvar kind-name run" title="10x">sql</span>)</td></tr><tr><td id="L664" class="nb">664</td><td>              <span class="node-kwbegin kind-end run" title="2846x">end</span></td></tr><tr><td id="L665" class="nb">665</td><td>              # Clear the queue</td></tr><tr><td id="L666" class="nb">666</td><td>              <span class="node-ivar kind-name run" title="2836x">@connection</span><span class="node-send kind-dot run" title="2836x">.</span><span class="node-send kind-selector_begin run" title="2836x">get_last_result</span></td></tr><tr><td id="L667" class="nb">667</td><td>              <span class="node-ivar kind-name run" title="2836x">@statements</span><span class="node-send kind-selector_begin run" title="2836x">[</span><span class="node-lvar kind-name run" title="2836x">sql_key</span><span class="node-send kind-selector_end run" title="2836x">]</span> <span class="node-send kind-operator run" title="2836x">=</span> <span class="node-lvar kind-name run" title="2836x">nextkey</span></td></tr><tr><td id="L668" class="nb">668</td><td>            end</td></tr><tr><td id="L669" class="nb">669</td><td>            <span class="node-ivar kind-name run" title="14442x">@statements</span><span class="node-send kind-selector_begin run" title="14442x">[</span><span class="node-lvar kind-name run" title="14442x">sql_key</span><span class="node-send kind-selector_end run" title="14442x">]</span></td></tr><tr><td id="L670" class="nb">670</td><td>          end</td></tr><tr><td id="L671" class="nb">671</td><td>        end</td></tr><tr><td id="L672" class="nb">672</td><td></td></tr><tr><td id="L673" class="nb">673</td><td>        # Connects to a PostgreSQL server and sets up the adapter depending on the</td></tr><tr><td id="L674" class="nb">674</td><td>        # connected server's characteristics.</td></tr><tr><td id="L675" class="nb">675</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">connect</span></td></tr><tr><td id="L676" class="nb">676</td><td>          <span class="node-ivasgn kind-name run" title="578x">@connection</span> <span class="node-ivasgn kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="581x">PG</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">connect</span>(<span class="node-ivar kind-name run" title="581x">@connection_parameters</span>)</td></tr><tr><td id="L677" class="nb">677</td><td>          <span class="node-send kind-selector_begin run" title="578x">configure_connection</span></td></tr><tr><td id="L678" class="nb">678</td><td>        <span class="node-resbody kind-keyword run" title="3x">rescue</span> <span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">PG</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Error</span> <span class="node-resbody kind-assoc run" title="3x">=&gt;</span> <span class="node-lvasgn kind-name run" title="3x">error</span></td></tr><tr><td id="L679" class="nb">679</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="29"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="node-if kind-keyword run" title="3x">if</span> <span class="node-lvar kind-name run" title="3x">error</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">message</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">include?</span>(<span class="node-str kind-expression run" title="3x">"does not exist"</span>)</span></td></tr><tr><td id="L680" class="nb">680</td><td>            <span class="fork fork-branch fork-run " data-fork-id="29"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3x"></i><span class="node-send kind-selector_begin run" title="3x">raise</span> <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">NoDatabaseError</span></span></td></tr><tr><td id="L681" class="nb">681</td><td>          <span class="node-send kind-else not-run" title="never run">else</span></td></tr><tr><td id="L682" class="nb">682</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="29"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-send kind-selector_begin not-run" title="never run">raise</span></span></td></tr><tr><td id="L683" class="nb">683</td><td>          end</td></tr><tr><td id="L684" class="nb">684</td><td>        end</td></tr><tr><td id="L685" class="nb">685</td><td></td></tr><tr><td id="L686" class="nb">686</td><td>        # Configures the encoding, verbosity, schema search path, and time zone of the connection.</td></tr><tr><td id="L687" class="nb">687</td><td>        # This is called by #connect and should not be called manually.</td></tr><tr><td id="L688" class="nb">688</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">configure_connection</span></td></tr><tr><td id="L689" class="nb">689</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="30"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy branch not covered"></i><span class="node-if kind-keyword run" title="953x">if</span> <span class="node-ivar kind-name run" title="953x">@config</span><span class="node-send kind-selector_begin run" title="953x">[</span><span class="node-sym kind-expression run" title="953x">:encoding</span><span class="node-send kind-selector_end run" title="953x">]</span></span></td></tr><tr><td id="L690" class="nb">690</td><td>            <span class="fork fork-branch fork-not-run " data-fork-id="30"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-ivar kind-name not-run" title="never run">@connection</span><span class="node-send kind-dot not-run" title="never run">.</span><span class="node-send kind-selector_begin not-run" title="never run">set_client_encoding</span>(<span class="node-ivar kind-name not-run" title="never run">@config</span><span class="node-send kind-selector_begin not-run" title="never run">[</span><span class="node-sym kind-expression not-run" title="never run">:encoding</span><span class="node-send kind-selector_end not-run" title="never run">]</span>)</span></td></tr><tr><td id="L691" class="nb">691</td><td>          end</td></tr><tr><td id="L692" class="nb">692</td><td>          <span class="node-self kind-expression run" title="953x">self</span><span class="node-send kind-dot run" title="953x">.</span><span class="node-send kind-selector_begin run" title="953x">client_min_messages</span> <span class="node-send kind-operator run" title="953x">=</span> <span class="fork fork-whole fork-run " data-fork-id="31"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="953x"></i><span class="node-ivar kind-name run" title="953x">@config</span><span class="node-send kind-selector_begin run" title="953x">[</span><span class="node-sym kind-expression run" title="953x">:min_messages</span><span class="node-send kind-selector_end run" title="953x">]</span> <span class="node-or kind-operator run" title="953x">||</span> <span class="fork fork-branch fork-run " data-fork-id="31"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="13x"></i><span class="node-str kind-expression run" title="13x">"warning"</span></span></span></td></tr><tr><td id="L693" class="nb">693</td><td>          <span class="node-self kind-expression run" title="953x">self</span><span class="node-send kind-dot run" title="953x">.</span><span class="node-send kind-selector_begin run" title="953x">schema_search_path</span> <span class="node-send kind-operator run" title="953x">=</span> <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="32"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy shortcut not covered"></i><span class="node-ivar kind-name run" title="953x">@config</span><span class="node-send kind-selector_begin run" title="953x">[</span><span class="node-sym kind-expression run" title="953x">:schema_search_path</span><span class="node-send kind-selector_end run" title="953x">]</span> <span class="node-or kind-operator run" title="953x">||</span> <span class="fork fork-branch fork-run " data-fork-id="32"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="953x"></i><span class="node-ivar kind-name run" title="953x">@config</span><span class="node-send kind-selector_begin run" title="953x">[</span><span class="node-sym kind-expression run" title="953x">:schema_order</span><span class="node-send kind-selector_end run" title="953x">]</span></span></span></td></tr><tr><td id="L694" class="nb">694</td><td></td></tr><tr><td id="L695" class="nb">695</td><td>          # Use standard-conforming strings so we don't have to do the E'...' dance.</td></tr><tr><td id="L696" class="nb">696</td><td>          <span class="node-send kind-selector_begin run" title="953x">set_standard_conforming_strings</span></td></tr><tr><td id="L697" class="nb">697</td><td></td></tr><tr><td id="L698" class="nb">698</td><td>          <span class="node-lvasgn kind-name run" title="953x">variables</span> <span class="node-lvasgn kind-operator run" title="953x">=</span> <span class="node-ivar kind-name run" title="953x">@config</span><span class="node-send kind-dot run" title="953x">.</span><span class="node-send kind-selector_begin run" title="953x">fetch</span>(<span class="node-sym kind-expression run" title="953x">:variables</span>, <span class="node-hash kind-begin run" title="953x">{</span><span class="node-hash kind-end run" title="953x">}</span>)<span class="node-send kind-dot run" title="953x">.</span><span class="node-send kind-selector_begin run" title="953x">stringify_keys</span></td></tr><tr><td id="L699" class="nb">699</td><td></td></tr><tr><td id="L700" class="nb">700</td><td>          # If using Active Record's time zone support configure the connection to return</td></tr><tr><td id="L701" class="nb">701</td><td>          # TIMESTAMP WITH ZONE types in UTC.</td></tr><tr><td id="L702" class="nb">702</td><td>          <span class="fork fork-whole fork-run " data-fork-id="33"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="953x"></i><span class="node-if kind-keyword run" title="953x">unless</span> <span class="node-lvar kind-name run" title="953x">variables</span><span class="node-send kind-selector_begin run" title="953x">[</span><span class="node-str kind-expression run" title="953x">"timezone"</span><span class="node-send kind-selector_end run" title="953x">]</span></span></td></tr><tr><td id="L703" class="nb">703</td><td>            <span class="fork fork-whole fork-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="950x"></i><span class="fork fork-branch fork-run " data-fork-id="33"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="950x"></i><span class="node-if kind-keyword run" title="950x">if</span> <span class="node-const kind-name run" title="950x">ActiveRecord</span><span class="node-const kind-double_colon run" title="950x">::</span><span class="node-const kind-name run" title="950x">Base</span><span class="node-send kind-dot run" title="950x">.</span><span class="node-send kind-selector_begin run" title="950x">default_timezone</span> <span class="node-send kind-selector_begin run" title="950x">==</span> <span class="node-sym kind-expression run" title="950x">:utc</span></span></span></td></tr><tr><td id="L704" class="nb">704</td><td>              <span class="fork fork-branch fork-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="948x"></i><span class="node-lvar kind-name run" title="948x">variables</span><span class="node-send kind-selector_begin run" title="948x">[</span><span class="node-str kind-expression run" title="948x">"timezone"</span><span class="node-send kind-selector_end run" title="948x">]</span> <span class="node-send kind-operator run" title="948x">=</span> <span class="node-str kind-expression run" title="948x">"UTC"</span></span></td></tr><tr><td id="L705" class="nb">705</td><td>            <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="35"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="implicit falsy branch not covered"></i><span class="fork fork-branch fork-not-run " data-fork-id="34"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-if kind-else run" title="2x"><span class="node-if kind-keyword run" title="2x">elsif</span></span> <span class="node-ivar kind-name run" title="2x">@local_tz</span></span></span></td></tr><tr><td id="L706" class="nb">706</td><td><span class="fork fork-branch fork-not-run " data-fork-id="35"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i></span>              <span class="fork fork-branch fork-run " data-fork-id="35"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="2x"></i><span class="node-lvar kind-name run" title="2x">variables</span><span class="node-send kind-selector_begin run" title="2x">[</span><span class="node-str kind-expression run" title="2x">"timezone"</span><span class="node-send kind-selector_end run" title="2x">]</span> <span class="node-send kind-operator run" title="2x">=</span> <span class="node-ivar kind-name run" title="2x">@local_tz</span></span></td></tr><tr><td id="L707" class="nb">707</td><td>            end</td></tr><tr><td id="L708" class="nb">708</td><td>          end</td></tr><tr><td id="L709" class="nb">709</td><td></td></tr><tr><td id="L710" class="nb">710</td><td>          # SET statements from :variables config hash</td></tr><tr><td id="L711" class="nb">711</td><td>          # https://www.postgresql.org/docs/current/static/sql-set.html</td></tr><tr><td id="L712" class="nb">712</td><td>          <span class="node-lvar kind-name run" title="953x">variables</span><span class="node-send kind-dot run" title="953x">.</span><span class="node-send kind-selector_begin run" title="953x">map</span> do |k, v|</td></tr><tr><td id="L713" class="nb">713</td><td>            <span class="fork fork-whole fork-run " data-fork-id="36"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="965x"></i><span class="node-if kind-keyword run" title="965x">if</span> <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="37"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="truthy shortcut not covered"></i><span class="node-lvar kind-name run" title="965x">v</span> <span class="node-send kind-selector_begin run" title="965x">==</span> <span class="node-str kind-expression run" title="965x">":default"</span> <span class="node-or kind-operator run" title="965x">||</span> <span class="fork fork-branch fork-run " data-fork-id="37"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="965x"></i><span class="node-lvar kind-name run" title="965x">v</span> <span class="node-send kind-selector_begin run" title="965x">==</span> <span class="node-sym kind-expression run" title="965x">:default</span></span></span></span></td></tr><tr><td id="L714" class="nb">714</td><td>              # Sets the value to the global or compile default</td></tr><tr><td id="L715" class="nb">715</td><td>              <span class="fork fork-branch fork-run " data-fork-id="36"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3x"></i><span class="node-send kind-selector_begin run" title="3x">execute</span>(<span class="node-dstr kind-begin run" title="3x">"</span><span class="node-str kind-expression run" title="3x">SET SESSION </span><span class="node-begin kind-begin run" title="3x">#{</span><span class="node-lvar kind-name run" title="3x">k</span><span class="node-begin kind-end run" title="3x">}</span><span class="node-str kind-expression run" title="3x"> TO DEFAULT</span><span class="node-dstr kind-end run" title="3x">"</span>, <span class="node-str kind-expression run" title="3x">"SCHEMA"</span>)</span></td></tr><tr><td id="L716" class="nb">716</td><td>            <span class="fork fork-whole fork-run " data-fork-id="38"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="962x"></i><span class="fork fork-branch fork-run " data-fork-id="36"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="962x"></i><span class="node-if kind-else run" title="962x"><span class="node-if kind-keyword run" title="962x">elsif</span></span> <span class="node-send kind-selector_begin run" title="962x">!</span><span class="node-lvar kind-name run" title="962x">v</span><span class="node-send kind-dot run" title="962x">.</span><span class="node-send kind-selector_begin run" title="962x">nil?</span></span></span></td></tr><tr><td id="L717" class="nb">717</td><td><span class="fork fork-branch fork-run " data-fork-id="38"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="3x"></i></span>              <span class="fork fork-branch fork-run " data-fork-id="38"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="959x"></i><span class="node-send kind-selector_begin run" title="959x">execute</span>(<span class="node-dstr kind-begin run" title="959x">"</span><span class="node-str kind-expression run" title="959x">SET SESSION </span><span class="node-begin kind-begin run" title="959x">#{</span><span class="node-lvar kind-name run" title="959x">k</span><span class="node-begin kind-end run" title="959x">}</span><span class="node-str kind-expression run" title="959x"> TO </span><span class="node-begin kind-begin run" title="959x">#{</span><span class="node-send kind-selector_begin run" title="959x">quote</span>(<span class="node-lvar kind-name run" title="959x">v</span>)<span class="node-begin kind-end run" title="959x">}</span><span class="node-dstr kind-end run" title="959x">"</span>, <span class="node-str kind-expression run" title="959x">"SCHEMA"</span>)</span></td></tr><tr><td id="L718" class="nb">718</td><td>            end</td></tr><tr><td id="L719" class="nb">719</td><td>          end</td></tr><tr><td id="L720" class="nb">720</td><td>        end</td></tr><tr><td id="L721" class="nb">721</td><td></td></tr><tr><td id="L722" class="nb">722</td><td>        # Returns the list of a table's column names, data types, and default values.</td></tr><tr><td id="L723" class="nb">723</td><td>        #</td></tr><tr><td id="L724" class="nb">724</td><td>        # The underlying query is roughly:</td></tr><tr><td id="L725" class="nb">725</td><td>        #  SELECT column.name, column.type, default.value, column.comment</td></tr><tr><td id="L726" class="nb">726</td><td>        #    FROM column LEFT JOIN default</td></tr><tr><td id="L727" class="nb">727</td><td>        #      ON column.table_id = default.table_id</td></tr><tr><td id="L728" class="nb">728</td><td>        #     AND column.num = default.column_num</td></tr><tr><td id="L729" class="nb">729</td><td>        #   WHERE column.table_id = get_table_id('table_name')</td></tr><tr><td id="L730" class="nb">730</td><td>        #     AND column.num &gt; 0</td></tr><tr><td id="L731" class="nb">731</td><td>        #     AND NOT column.is_dropped</td></tr><tr><td id="L732" class="nb">732</td><td>        #   ORDER BY column.num</td></tr><tr><td id="L733" class="nb">733</td><td>        #</td></tr><tr><td id="L734" class="nb">734</td><td>        # If the table name is not prefixed with a schema, the database will</td></tr><tr><td id="L735" class="nb">735</td><td>        # take the first match from the schema search path.</td></tr><tr><td id="L736" class="nb">736</td><td>        #</td></tr><tr><td id="L737" class="nb">737</td><td>        # Query implementation notes:</td></tr><tr><td id="L738" class="nb">738</td><td>        #  - format_type includes the column size constraint, e.g. varchar(50)</td></tr><tr><td id="L739" class="nb">739</td><td>        #  - ::regclass is a function that gives the id for a table name</td></tr><tr><td id="L740" class="nb">740</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">column_definitions</span>(table_name)</td></tr><tr><td id="L741" class="nb">741</td><td>          <span class="node-send kind-selector_begin run" title="12346x">query</span>(<span class="node-dstr kind-expression run" title="12346x">&lt;&lt;-end_sql</span>, <span class="node-str kind-expression run" title="12346x">"SCHEMA"</span>)</td></tr><tr><td id="L742" class="nb">742</td><td><span class="node-str kind-expression run" title="12346x">              SELECT a.attname, format_type(a.atttypid, a.atttypmod),</span></td></tr><tr><td id="L743" class="nb">743</td><td><span class="node-str kind-expression run" title="12346x">                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod,</span></td></tr><tr><td id="L744" class="nb">744</td><td><span class="node-str kind-expression run" title="12346x">                     c.collname, col_description(a.attrelid, a.attnum) AS comment</span></td></tr><tr><td id="L745" class="nb">745</td><td><span class="node-str kind-expression run" title="12346x">                FROM pg_attribute a</span></td></tr><tr><td id="L746" class="nb">746</td><td><span class="node-str kind-expression run" title="12346x">                LEFT JOIN pg_attrdef d ON a.attrelid = d.adrelid AND a.attnum = d.adnum</span></td></tr><tr><td id="L747" class="nb">747</td><td><span class="node-str kind-expression run" title="12346x">                LEFT JOIN pg_type t ON a.atttypid = t.oid</span></td></tr><tr><td id="L748" class="nb">748</td><td><span class="node-str kind-expression run" title="12346x">                LEFT JOIN pg_collation c ON a.attcollation = c.oid AND a.attcollation &lt;&gt; t.typcollation</span></td></tr><tr><td id="L749" class="nb">749</td><td><span class="node-str kind-expression run" title="12346x">               WHERE a.attrelid = </span><span class="node-begin kind-begin run" title="12346x">#{</span><span class="node-send kind-selector_begin run" title="12346x">quote</span>(<span class="node-send kind-selector_begin run" title="12346x">quote_table_name</span>(<span class="node-lvar kind-name run" title="12346x">table_name</span>))<span class="node-begin kind-end run" title="12346x">}</span><span class="node-str kind-expression run" title="12346x">::regclass</span></td></tr><tr><td id="L750" class="nb">750</td><td><span class="node-str kind-expression run" title="12346x">                 AND a.attnum &gt; 0 AND NOT a.attisdropped</span></td></tr><tr><td id="L751" class="nb">751</td><td><span class="node-str kind-expression run" title="12346x">               ORDER BY a.attnum</span></td></tr><tr><td id="L752" class="nb">752</td><td><span class="node-dstr kind-heredoc_end run" title="12346x">          end_sql</span></td></tr><tr><td id="L753" class="nb">753</td><td>        end</td></tr><tr><td id="L754" class="nb">754</td><td></td></tr><tr><td id="L755" class="nb">755</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">extract_table_ref_from_insert_sql</span>(sql)</td></tr><tr><td id="L756" class="nb">756</td><td>          <span class="node-lvar kind-name run" title="28x">sql</span><span class="node-send kind-selector_begin run" title="28x">[</span><span class="node-regexp kind-begin run" title="28x">/</span><span class="node-str kind-expression run" title="28x">into\s("[A-Za-z0-9_."\[\]\s]+"|[A-Za-z0-9_."\[\]]+)\s*</span><span class="node-regexp kind-end run" title="28x">/</span><span class="node-regopt kind-expression run" title="28x">im</span><span class="node-send kind-selector_end run" title="28x">]</span></td></tr><tr><td id="L757" class="nb">757</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="39"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="implicit falsy branch not covered"></i><span class="fork fork-branch fork-run " data-fork-id="39"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="28x"></i>$1<span class="node-send kind-dot run" title="28x">.</span><span class="node-send kind-selector_begin run" title="28x">strip</span></span> <span class="node-if kind-keyword run" title="28x">if</span> $1</span></td></tr><tr><td id="L758" class="nb">758</td><td>        end</td></tr><tr><td id="L759" class="nb">759</td><td></td></tr><tr><td id="L760" class="nb">760</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">arel_visitor</span></td></tr><tr><td id="L761" class="nb">761</td><td>          <span class="node-const kind-name run" title="581x">Arel</span><span class="node-const kind-double_colon run" title="581x">::</span><span class="node-const kind-name run" title="581x">Visitors</span><span class="node-const kind-double_colon run" title="581x">::</span><span class="node-const kind-name run" title="581x">PostgreSQL</span><span class="node-send kind-dot run" title="581x">.</span><span class="node-send kind-selector_begin run" title="581x">new</span>(<span class="node-self kind-expression run" title="581x">self</span>)</td></tr><tr><td id="L762" class="nb">762</td><td>        end</td></tr><tr><td id="L763" class="nb">763</td><td></td></tr><tr><td id="L764" class="nb">764</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">can_perform_case_insensitive_comparison_for?</span>(column)</td></tr><tr><td id="L765" class="nb">765</td><td>          <span class="node-ivasgn kind-name run" title="29x">@case_insensitive_cache</span> <span class="node-or_asgn kind-operator run" title="29x">||=</span> <span class="node-hash kind-begin run" title="4x">{</span><span class="node-hash kind-end run" title="4x">}</span></td></tr><tr><td id="L766" class="nb">766</td><td>          <span class="node-ivar kind-name run" title="29x">@case_insensitive_cache</span><span class="node-send kind-selector_begin run" title="29x">[</span><span class="node-lvar kind-name run" title="29x">column</span><span class="node-send kind-dot run" title="29x">.</span><span class="node-send kind-selector_begin run" title="29x">sql_type</span><span class="node-send kind-selector_end run" title="29x">]</span> <span class="node-or_asgn kind-operator run" title="29x">||=</span> <span class="node-kwbegin kind-begin run" title="15x">begin</span></td></tr><tr><td id="L767" class="nb">767</td><td>            <span class="node-lvasgn kind-name run" title="15x">sql</span> <span class="node-lvasgn kind-operator run" title="15x">=</span> <span class="node-dstr kind-expression run" title="15x">&lt;&lt;-end_sql</span></td></tr><tr><td id="L768" class="nb">768</td><td><span class="node-str kind-expression run" title="15x">              SELECT exists(</span></td></tr><tr><td id="L769" class="nb">769</td><td><span class="node-str kind-expression run" title="15x">                SELECT * FROM pg_proc</span></td></tr><tr><td id="L770" class="nb">770</td><td><span class="node-str kind-expression run" title="15x">                WHERE proname = 'lower'</span></td></tr><tr><td id="L771" class="nb">771</td><td><span class="node-str kind-expression run" title="15x">                  AND proargtypes = ARRAY[</span><span class="node-begin kind-begin run" title="15x">#{</span><span class="node-send kind-selector_begin run" title="15x">quote</span> <span class="node-lvar kind-name run" title="15x">column</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">sql_type</span><span class="node-begin kind-end run" title="15x">}</span><span class="node-str kind-expression run" title="15x">::regtype]::oidvector</span></td></tr><tr><td id="L772" class="nb">772</td><td><span class="node-str kind-expression run" title="15x">              ) OR exists(</span></td></tr><tr><td id="L773" class="nb">773</td><td><span class="node-str kind-expression run" title="15x">                SELECT * FROM pg_proc</span></td></tr><tr><td id="L774" class="nb">774</td><td><span class="node-str kind-expression run" title="15x">                INNER JOIN pg_cast</span></td></tr><tr><td id="L775" class="nb">775</td><td><span class="node-str kind-expression run" title="15x">                  ON ARRAY[casttarget]::oidvector = proargtypes</span></td></tr><tr><td id="L776" class="nb">776</td><td><span class="node-str kind-expression run" title="15x">                WHERE proname = 'lower'</span></td></tr><tr><td id="L777" class="nb">777</td><td><span class="node-str kind-expression run" title="15x">                  AND castsource = </span><span class="node-begin kind-begin run" title="15x">#{</span><span class="node-send kind-selector_begin run" title="15x">quote</span> <span class="node-lvar kind-name run" title="15x">column</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">sql_type</span><span class="node-begin kind-end run" title="15x">}</span><span class="node-str kind-expression run" title="15x">::regtype</span></td></tr><tr><td id="L778" class="nb">778</td><td><span class="node-str kind-expression run" title="15x">              )</span></td></tr><tr><td id="L779" class="nb">779</td><td><span class="node-dstr kind-heredoc_end run" title="15x">            end_sql</span></td></tr><tr><td id="L780" class="nb">780</td><td>            <span class="node-send kind-selector_begin run" title="15x">execute_and_clear</span>(<span class="node-lvar kind-name run" title="15x">sql</span>, <span class="node-str kind-expression run" title="15x">"SCHEMA"</span>, <span class="node-array kind-begin run" title="15x">[</span><span class="node-array kind-end run" title="15x">]</span>) do |result|</td></tr><tr><td id="L781" class="nb">781</td><td>              <span class="node-lvar kind-name run" title="15x">result</span><span class="node-send kind-dot run" title="15x">.</span><span class="node-send kind-selector_begin run" title="15x">getvalue</span>(<span class="node-int kind-expression run" title="15x">0</span>, <span class="node-int kind-expression run" title="15x">0</span>)</td></tr><tr><td id="L782" class="nb">782</td><td>            end</td></tr><tr><td id="L783" class="nb">783</td><td>          <span class="node-kwbegin kind-end run" title="15x">end</span></td></tr><tr><td id="L784" class="nb">784</td><td>        end</td></tr><tr><td id="L785" class="nb">785</td><td></td></tr><tr><td id="L786" class="nb">786</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">add_pg_encoders</span></td></tr><tr><td id="L787" class="nb">787</td><td>          <span class="node-lvasgn kind-name run" title="578x">map</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TypeMapByClass</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L788" class="nb">788</td><td>          <span class="node-lvar kind-name run" title="578x">map</span><span class="node-send kind-selector_begin run" title="578x">[</span><span class="node-const kind-name run" title="578x">Integer</span><span class="node-send kind-selector_end run" title="578x">]</span> <span class="node-send kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextEncoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Integer</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L789" class="nb">789</td><td>          <span class="node-lvar kind-name run" title="578x">map</span><span class="node-send kind-selector_begin run" title="578x">[</span><span class="node-const kind-name run" title="578x">TrueClass</span><span class="node-send kind-selector_end run" title="578x">]</span> <span class="node-send kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextEncoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Boolean</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L790" class="nb">790</td><td>          <span class="node-lvar kind-name run" title="578x">map</span><span class="node-send kind-selector_begin run" title="578x">[</span><span class="node-const kind-name run" title="578x">FalseClass</span><span class="node-send kind-selector_end run" title="578x">]</span> <span class="node-send kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextEncoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Boolean</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L791" class="nb">791</td><td>          <span class="node-ivar kind-name run" title="578x">@connection</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">type_map_for_queries</span> <span class="node-send kind-operator run" title="578x">=</span> <span class="node-lvar kind-name run" title="578x">map</span></td></tr><tr><td id="L792" class="nb">792</td><td>        end</td></tr><tr><td id="L793" class="nb">793</td><td></td></tr><tr><td id="L794" class="nb">794</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">add_pg_decoders</span></td></tr><tr><td id="L795" class="nb">795</td><td>          <span class="node-lvasgn kind-name run" title="578x">coders_by_name</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-hash kind-begin run" title="578x">{</span></td></tr><tr><td id="L796" class="nb">796</td><td>            <span class="node-str kind-expression run" title="578x">"int2"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Integer</span>,</td></tr><tr><td id="L797" class="nb">797</td><td>            <span class="node-str kind-expression run" title="578x">"int4"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Integer</span>,</td></tr><tr><td id="L798" class="nb">798</td><td>            <span class="node-str kind-expression run" title="578x">"int8"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Integer</span>,</td></tr><tr><td id="L799" class="nb">799</td><td>            <span class="node-str kind-expression run" title="578x">"oid"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Integer</span>,</td></tr><tr><td id="L800" class="nb">800</td><td>            <span class="node-str kind-expression run" title="578x">"float4"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Float</span>,</td></tr><tr><td id="L801" class="nb">801</td><td>            <span class="node-str kind-expression run" title="578x">"float8"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Float</span>,</td></tr><tr><td id="L802" class="nb">802</td><td>            <span class="node-str kind-expression run" title="578x">"bool"</span> <span class="node-pair kind-operator run" title="578x">=&gt;</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TextDecoder</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">Boolean</span>,</td></tr><tr><td id="L803" class="nb">803</td><td>          <span class="node-hash kind-end run" title="578x">}</span></td></tr><tr><td id="L804" class="nb">804</td><td>          <span class="node-lvasgn kind-name run" title="578x">known_coder_types</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-lvar kind-name run" title="578x">coders_by_name</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">keys</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">map</span> { |n| <span class="node-send kind-selector_begin run" title="4046x">quote</span>(<span class="node-lvar kind-name run" title="4046x">n</span>) }</td></tr><tr><td id="L805" class="nb">805</td><td>          <span class="node-lvasgn kind-name run" title="578x">query</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-dstr kind-expression run" title="578x">&lt;&lt;-SQL</span> <span class="node-send kind-selector_begin run" title="578x">%</span> <span class="node-lvar kind-name run" title="578x">known_coder_types</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">join</span>(<span class="node-str kind-expression run" title="578x">", "</span>)</td></tr><tr><td id="L806" class="nb">806</td><td><span class="node-str kind-expression run" title="578x">            SELECT t.oid, t.typname</span></td></tr><tr><td id="L807" class="nb">807</td><td><span class="node-str kind-expression run" title="578x">            FROM pg_type as t</span></td></tr><tr><td id="L808" class="nb">808</td><td><span class="node-str kind-expression run" title="578x">            WHERE t.typname IN (%s)</span></td></tr><tr><td id="L809" class="nb">809</td><td><span class="node-dstr kind-heredoc_end run" title="578x">          SQL</span></td></tr><tr><td id="L810" class="nb">810</td><td>          <span class="node-lvasgn kind-name run" title="578x">coders</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-send kind-selector_begin run" title="578x">execute_and_clear</span>(<span class="node-lvar kind-name run" title="578x">query</span>, <span class="node-str kind-expression run" title="578x">"SCHEMA"</span>, <span class="node-array kind-begin run" title="578x">[</span><span class="node-array kind-end run" title="578x">]</span>) do |result|</td></tr><tr><td id="L811" class="nb">811</td><td>            <span class="node-lvar kind-name run" title="578x">result</span></td></tr><tr><td id="L812" class="nb">812</td><td>              <span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">map</span> { |row| <span class="node-send kind-selector_begin run" title="4046x">construct_coder</span>(<span class="node-lvar kind-name run" title="4046x">row</span>, <span class="node-lvar kind-name run" title="4046x">coders_by_name</span><span class="node-send kind-selector_begin run" title="4046x">[</span><span class="node-lvar kind-name run" title="4046x">row</span><span class="node-send kind-selector_begin run" title="4046x">[</span><span class="node-str kind-expression run" title="4046x">"typname"</span><span class="node-send kind-selector_end run" title="4046x">]</span><span class="node-send kind-selector_end run" title="4046x">]</span>) }</td></tr><tr><td id="L813" class="nb">813</td><td>              <span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">compact</span></td></tr><tr><td id="L814" class="nb">814</td><td>          end</td></tr><tr><td id="L815" class="nb">815</td><td></td></tr><tr><td id="L816" class="nb">816</td><td>          <span class="node-lvasgn kind-name run" title="578x">map</span> <span class="node-lvasgn kind-operator run" title="578x">=</span> <span class="node-const kind-name run" title="578x">PG</span><span class="node-const kind-double_colon run" title="578x">::</span><span class="node-const kind-name run" title="578x">TypeMapByOid</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">new</span></td></tr><tr><td id="L817" class="nb">817</td><td>          <span class="node-lvar kind-name run" title="578x">coders</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">each</span> { |coder| <span class="node-lvar kind-name run" title="4046x">map</span><span class="node-send kind-dot run" title="4046x">.</span><span class="node-send kind-selector_begin run" title="4046x">add_coder</span>(<span class="node-lvar kind-name run" title="4046x">coder</span>) }</td></tr><tr><td id="L818" class="nb">818</td><td>          <span class="node-ivar kind-name run" title="578x">@connection</span><span class="node-send kind-dot run" title="578x">.</span><span class="node-send kind-selector_begin run" title="578x">type_map_for_results</span> <span class="node-send kind-operator run" title="578x">=</span> <span class="node-lvar kind-name run" title="578x">map</span></td></tr><tr><td id="L819" class="nb">819</td><td>        end</td></tr><tr><td id="L820" class="nb">820</td><td></td></tr><tr><td id="L821" class="nb">821</td><td>        <span class="node-def kind-keyword run" title="3x">def</span> <span class="node-def kind-name run" title="3x">construct_coder</span>(row, coder_class)</td></tr><tr><td id="L822" class="nb">822</td><td>          <span class="fork fork-whole fork-not-run fork-with-uncovered-branches" data-fork-id="40"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="falsy branch not covered"></i><span class="fork fork-branch fork-not-run " data-fork-id="40"><i class="fork-icon fa fa-code-fork" aria-hidden="true" title="never run"></i><span class="node-return kind-keyword not-run" title="never run">return</span></span> <span class="node-if kind-keyword run" title="4046x">unless</span> <span class="node-lvar kind-name run" title="4046x">coder_class</span></span></td></tr><tr><td id="L823" class="nb">823</td><td>          <span class="node-lvar kind-name run" title="4046x">coder_class</span><span class="node-send kind-dot run" title="4046x">.</span><span class="node-send kind-selector_begin run" title="4046x">new</span>(<span class="node-sym kind-expression run" title="4046x">oid</span><span class="node-pair kind-operator run" title="4046x">:</span> <span class="node-lvar kind-name run" title="4046x">row</span><span class="node-send kind-selector_begin run" title="4046x">[</span><span class="node-str kind-expression run" title="4046x">"oid"</span><span class="node-send kind-selector_end run" title="4046x">]</span><span class="node-send kind-dot run" title="4046x">.</span><span class="node-send kind-selector_begin run" title="4046x">to_i</span>, <span class="node-sym kind-expression run" title="4046x">name</span><span class="node-pair kind-operator run" title="4046x">:</span> <span class="node-lvar kind-name run" title="4046x">row</span><span class="node-send kind-selector_begin run" title="4046x">[</span><span class="node-str kind-expression run" title="4046x">"typname"</span><span class="node-send kind-selector_end run" title="4046x">]</span>)</td></tr><tr><td id="L824" class="nb">824</td><td>        end</td></tr><tr><td id="L825" class="nb">825</td><td></td></tr><tr><td id="L826" class="nb">826</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">add_modifier</span>(<span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">array</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-true kind-expression run" title="3x">true</span> <span class="node-hash kind-end run" title="3x">}</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Array</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L827" class="nb">827</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">add_modifier</span>(<span class="node-hash kind-begin run" title="3x">{</span> <span class="node-sym kind-expression run" title="3x">range</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-true kind-expression run" title="3x">true</span> <span class="node-hash kind-end run" title="3x">}</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Range</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L828" class="nb">828</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:bit</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Bit</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L829" class="nb">829</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:bit_varying</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">BitVarying</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L830" class="nb">830</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:binary</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Bytea</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L831" class="nb">831</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:cidr</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Cidr</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L832" class="nb">832</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:datetime</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">DateTime</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L833" class="nb">833</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:decimal</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Decimal</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L834" class="nb">834</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:enum</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Enum</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L835" class="nb">835</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:hstore</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Hstore</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L836" class="nb">836</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:inet</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Inet</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L837" class="nb">837</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:jsonb</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Jsonb</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L838" class="nb">838</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:money</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Money</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L839" class="nb">839</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:point</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Point</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L840" class="nb">840</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:legacy_point</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">LegacyPoint</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L841" class="nb">841</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:uuid</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Uuid</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L842" class="nb">842</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:vector</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Vector</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L843" class="nb">843</td><td>        <span class="node-const kind-name run" title="3x">ActiveRecord</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Type</span><span class="node-send kind-dot run" title="3x">.</span><span class="node-send kind-selector_begin run" title="3x">register</span>(<span class="node-sym kind-expression run" title="3x">:xml</span>, <span class="node-const kind-name run" title="3x">OID</span><span class="node-const kind-double_colon run" title="3x">::</span><span class="node-const kind-name run" title="3x">Xml</span>, <span class="node-sym kind-expression run" title="3x">adapter</span><span class="node-pair kind-operator run" title="3x">:</span> <span class="node-sym kind-expression run" title="3x">:postgresql</span>)</td></tr><tr><td id="L844" class="nb">844</td><td>    end</td></tr><tr><td id="L845" class="nb">845</td><td>  end</td></tr><tr><td id="L846" class="nb">846</td><td>end</td></tr></table></main>
    <script>
      $(function() {
        $('.stats .branch').click(function() {
          $('body').toggleClass('show-forks')
        });
      });
    </script>
  </body>
</html>
